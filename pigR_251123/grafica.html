<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6 Introduzione alla grafica scientifica con R | pigR: R, per pigri</title>
  <meta name="description" content="Un’introduzione all’uso di R per studenti pigri o frettolosi." />
  <meta name="generator" content="bookdown 0.36 and GitBook 2.6.7" />

  <meta property="og:title" content="6 Introduzione alla grafica scientifica con R | pigR: R, per pigri" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Un’introduzione all’uso di R per studenti pigri o frettolosi." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6 Introduzione alla grafica scientifica con R | pigR: R, per pigri" />
  
  <meta name="twitter:description" content="Un’introduzione all’uso di R per studenti pigri o frettolosi." />
  

<meta name="author" content="E. Parente, Scuola SAFE, Università degli Studi della Basilicata" />


<meta name="date" content="2023-11-25" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="dentroefuoriR.html"/>
<link rel="next" href="statdesc.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Cos’è pigR?</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#di-cosa-hai-bisogno-per-leggere-e-capire-questo-libro."><i class="fa fa-check"></i>Di cosa hai bisogno per leggere (e capire) questo libro.</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#chi-siamo-noi-noi-noi"><i class="fa fa-check"></i>Chi siamo noi (noi, noi)?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#se-ti-piace"><i class="fa fa-check"></i>Se ti piace…</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#caveat"><i class="fa fa-check"></i>Caveat</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#cookies"><i class="fa fa-check"></i>Cookies</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#la-foto-di-copertina."><i class="fa fa-check"></i>La foto di copertina.</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduzione</a>
<ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#cosa-cè-da-imparare-in-questo-capitolo."><i class="fa fa-check"></i><b>1.1</b> Cosa c’è da imparare in questo capitolo.</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#convenzioni-e-guida-alla-lettura-e-alluso-del-codice."><i class="fa fa-check"></i><b>1.2</b> Convenzioni e guida alla lettura e all’uso del codice.</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#tutti-vogliono-imparare-a-usare-r."><i class="fa fa-check"></i><b>1.3</b> Tutti vogliono imparare a usare R.</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="intro.html"><a href="intro.html#provare-per-credere-app-gui-ide-e-altre-diavolerie."><i class="fa fa-check"></i><b>1.3.1</b> Provare per credere: App, GUI, IDE e altre diavolerie.</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#laltra-faccia-della-medaglia-troppa-fatica."><i class="fa fa-check"></i><b>1.4</b> L’altra faccia della medaglia: troppa fatica.</a></li>
<li class="chapter" data-level="1.5" data-path="intro.html"><a href="intro.html#r-per-pigri."><i class="fa fa-check"></i><b>1.5</b> R, per pigri.</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="inter.html"><a href="inter.html"><i class="fa fa-check"></i><b>2</b> Interfacce e ambienti</a>
<ul>
<li class="chapter" data-level="2.1" data-path="inter.html"><a href="inter.html#cosa-cè-da-imparare-in-questo-capitolo.-1"><i class="fa fa-check"></i><b>2.1</b> Cosa c’è da imparare in questo capitolo.</a></li>
<li class="chapter" data-level="2.2" data-path="inter.html"><a href="inter.html#rstudio."><i class="fa fa-check"></i><b>2.2</b> RStudio.</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="inter.html"><a href="inter.html#linterfaccia-principale-di-rstudio."><i class="fa fa-check"></i><b>2.2.1</b> L’interfaccia principale di RStudio.</a></li>
<li class="chapter" data-level="2.2.2" data-path="inter.html"><a href="inter.html#il-pannello-source."><i class="fa fa-check"></i><b>2.2.2</b> Il pannello Source.</a></li>
<li class="chapter" data-level="2.2.3" data-path="inter.html"><a href="inter.html#il-pannello-console."><i class="fa fa-check"></i><b>2.2.3</b> Il pannello Console.</a></li>
<li class="chapter" data-level="2.2.4" data-path="inter.html"><a href="inter.html#il-pannello-environment."><i class="fa fa-check"></i><b>2.2.4</b> Il pannello Environment.</a></li>
<li class="chapter" data-level="2.2.5" data-path="inter.html"><a href="inter.html#il-tab-environment."><i class="fa fa-check"></i><b>2.2.5</b> Il tab Environment.</a></li>
<li class="chapter" data-level="2.2.6" data-path="inter.html"><a href="inter.html#il-tab-history."><i class="fa fa-check"></i><b>2.2.6</b> Il tab History.</a></li>
<li class="chapter" data-level="2.2.7" data-path="inter.html"><a href="inter.html#il-pannello-plots."><i class="fa fa-check"></i><b>2.2.7</b> Il pannello Plots.</a></li>
<li class="chapter" data-level="2.2.8" data-path="inter.html"><a href="inter.html#il-tab-plots."><i class="fa fa-check"></i><b>2.2.8</b> Il tab Plots.</a></li>
<li class="chapter" data-level="2.2.9" data-path="inter.html"><a href="inter.html#il-tab-files."><i class="fa fa-check"></i><b>2.2.9</b> Il tab Files.</a></li>
<li class="chapter" data-level="2.2.10" data-path="inter.html"><a href="inter.html#tabpackages"><i class="fa fa-check"></i><b>2.2.10</b> Il tab Packages.</a></li>
<li class="chapter" data-level="2.2.11" data-path="inter.html"><a href="inter.html#il-tab-help."><i class="fa fa-check"></i><b>2.2.11</b> Il tab Help.</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="inter.html"><a href="inter.html#esercizi."><i class="fa fa-check"></i><b>2.3</b> Esercizi.</a></li>
<li class="chapter" data-level="2.4" data-path="inter.html"><a href="inter.html#altrerisinter"><i class="fa fa-check"></i><b>2.4</b> Altre risorse.</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="inter.html"><a href="inter.html#risorse-in-italiano."><i class="fa fa-check"></i><b>2.4.1</b> Risorse in italiano.</a></li>
<li class="chapter" data-level="2.4.2" data-path="inter.html"><a href="inter.html#risorse-in-inglese."><i class="fa fa-check"></i><b>2.4.2</b> Risorse in inglese.</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="aiuto.html"><a href="aiuto.html"><i class="fa fa-check"></i><b>3</b> Chiedere aiuto</a>
<ul>
<li class="chapter" data-level="3.1" data-path="aiuto.html"><a href="aiuto.html#cosa-cè-da-imparare-in-questo-capitolo.-2"><i class="fa fa-check"></i><b>3.1</b> Cosa c’è da imparare in questo capitolo.</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="aiuto.html"><a href="aiuto.html#premessa-1-nessuno-legge-i-manuali-figuriamoci-i-pigri"><i class="fa fa-check"></i><b>3.1.1</b> Premessa 1: nessuno legge i manuali (figuriamoci i pigRi)!</a></li>
<li class="chapter" data-level="3.1.2" data-path="aiuto.html"><a href="aiuto.html#gatti"><i class="fa fa-check"></i><b>3.1.2</b> Premessa 2: ci sono molti modi di pelare un gatto (e documentarlo).</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="aiuto.html"><a href="aiuto.html#laiuto-di-r."><i class="fa fa-check"></i><b>3.2</b> L’aiuto di R.</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="aiuto.html"><a href="aiuto.html#tabhelp"><i class="fa fa-check"></i><b>3.2.1</b> Il tab Help di RStudio.</a></li>
<li class="chapter" data-level="3.2.2" data-path="aiuto.html"><a href="aiuto.html#funzioni-per-chiedere-aiuto."><i class="fa fa-check"></i><b>3.2.2</b> <em>Funzioni per chiedere aiuto.</em></a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="aiuto.html"><a href="aiuto.html#strategieaiuto"><i class="fa fa-check"></i><b>3.3</b> Strategie per cercare aiuto (anche senza parere).</a></li>
<li class="chapter" data-level="3.4" data-path="aiuto.html"><a href="aiuto.html#esercizi.-1"><i class="fa fa-check"></i><b>3.4</b> Esercizi.</a></li>
<li class="chapter" data-level="3.5" data-path="aiuto.html"><a href="aiuto.html#altrerisaiuto"><i class="fa fa-check"></i><b>3.5</b> Altre risorse.</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="aiuto.html"><a href="aiuto.html#risorse-in-italiano.-1"><i class="fa fa-check"></i><b>3.5.1</b> Risorse in italiano.</a></li>
<li class="chapter" data-level="3.5.2" data-path="aiuto.html"><a href="aiuto.html#risorse-in-inglese.-1"><i class="fa fa-check"></i><b>3.5.2</b> Risorse in inglese.</a></li>
<li class="chapter" data-level="3.5.3" data-path="aiuto.html"><a href="aiuto.html#niente-video"><i class="fa fa-check"></i><b>3.5.3</b> Niente video?</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="datioggetti.html"><a href="datioggetti.html"><i class="fa fa-check"></i><b>4</b> Dati, oggetti, funzioni (e tutto il resto)</a>
<ul>
<li class="chapter" data-level="4.1" data-path="datioggetti.html"><a href="datioggetti.html#cosa-cè-da-imparare-in-questo-capitolo.-3"><i class="fa fa-check"></i><b>4.1</b> Cosa c’è da imparare in questo capitolo.</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="datioggetti.html"><a href="datioggetti.html#premessa-1-esperimenti-e-osservazioni."><i class="fa fa-check"></i><b>4.1.1</b> Premessa 1: esperimenti e osservazioni.</a></li>
<li class="chapter" data-level="4.1.2" data-path="datioggetti.html"><a href="datioggetti.html#premessa2"><i class="fa fa-check"></i><b>4.1.2</b> Premessa 2. Misure e dati, osservazioni e variabili, tabelle.</a></li>
<li class="chapter" data-level="4.1.3" data-path="datioggetti.html"><a href="datioggetti.html#anatab"><i class="fa fa-check"></i><b>4.1.3</b> Anatomia di una tabella.</a></li>
<li class="chapter" data-level="4.1.4" data-path="datioggetti.html"><a href="datioggetti.html#un-piccolo-esercizio."><i class="fa fa-check"></i><b>4.1.4</b> Un piccolo esercizio.</a></li>
<li class="chapter" data-level="4.1.5" data-path="datioggetti.html"><a href="datioggetti.html#tidyuntidydefinizione"><i class="fa fa-check"></i><b>4.1.5</b> Tidy vs. untidy (tabelle ordinate e disordinate).</a></li>
<li class="chapter" data-level="4.1.6" data-path="datioggetti.html"><a href="datioggetti.html#missingdata"><i class="fa fa-check"></i><b>4.1.6</b> Dati mancanti (missing data).</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="datioggetti.html"><a href="datioggetti.html#r-è-un-linguaggio-funzionale-che-supporta-la-programmazione-orientata-a-oggetti"><i class="fa fa-check"></i><b>4.2</b> R è un linguaggio funzionale che supporta la programmazione orientata a oggetti…</a></li>
<li class="chapter" data-level="4.3" data-path="datioggetti.html"><a href="datioggetti.html#ilnomedellecose"><i class="fa fa-check"></i><b>4.3</b> Il nome delle cose.</a></li>
<li class="chapter" data-level="4.4" data-path="datioggetti.html"><a href="datioggetti.html#strutturedati"><i class="fa fa-check"></i><b>4.4</b> Strutture di dati.</a></li>
<li class="chapter" data-level="4.5" data-path="datioggetti.html"><a href="datioggetti.html#vettoriatomici"><i class="fa fa-check"></i><b>4.5</b> Vettori atomici.</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="datioggetti.html"><a href="datioggetti.html#vettori1D"><i class="fa fa-check"></i><b>4.5.1</b> Vettori ad una dimensione.</a></li>
<li class="chapter" data-level="4.5.2" data-path="datioggetti.html"><a href="datioggetti.html#vettori-atomici-a-2-o-più-dimensioni-matrici-e-array."><i class="fa fa-check"></i><b>4.5.2</b> Vettori atomici a 2 o più dimensioni: matrici e array.</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="datioggetti.html"><a href="datioggetti.html#i-data-frame-e-le-liste."><i class="fa fa-check"></i><b>4.6</b> I data frame e le liste.</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="datioggetti.html"><a href="datioggetti.html#dataframebenemale"><i class="fa fa-check"></i><b>4.6.1</b> I data frame, nel bene e nel male.</a></li>
<li class="chapter" data-level="4.6.2" data-path="datioggetti.html"><a href="datioggetti.html#le-liste."><i class="fa fa-check"></i><b>4.6.2</b> Le liste.</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="datioggetti.html"><a href="datioggetti.html#altre-cose-strane-tabelle-di-conte-serie-temporali-date-e-ore."><i class="fa fa-check"></i><b>4.7</b> <em>Altre cose strane: tabelle di conte, serie temporali, date e ore.</em></a></li>
<li class="chapter" data-level="4.8" data-path="datioggetti.html"><a href="datioggetti.html#indsel"><i class="fa fa-check"></i><b>4.8</b> Indirizzare, selezionare.</a>
<ul>
<li class="chapter" data-level="4.8.1" data-path="datioggetti.html"><a href="datioggetti.html#indirizzare-per-posizione."><i class="fa fa-check"></i><b>4.8.1</b> Indirizzare per posizione.</a></li>
<li class="chapter" data-level="4.8.2" data-path="datioggetti.html"><a href="datioggetti.html#usare-i-nomi."><i class="fa fa-check"></i><b>4.8.2</b> Usare i nomi.</a></li>
<li class="chapter" data-level="4.8.3" data-path="datioggetti.html"><a href="datioggetti.html#usare-valori-logici."><i class="fa fa-check"></i><b>4.8.3</b> Usare valori logici.</a></li>
</ul></li>
<li class="chapter" data-level="4.9" data-path="datioggetti.html"><a href="datioggetti.html#attach-with-within."><i class="fa fa-check"></i><b>4.9</b> <code>attach()</code>, <code>with()</code>, <code>within()</code>.</a></li>
<li class="chapter" data-level="4.10" data-path="datioggetti.html"><a href="datioggetti.html#funzioni-built-in-e-funzioni-definite-dallutente."><i class="fa fa-check"></i><b>4.10</b> <em>Funzioni “built-in” e funzioni definite dall’utente.</em></a>
<ul>
<li class="chapter" data-level="4.10.1" data-path="datioggetti.html"><a href="datioggetti.html#operatorisemplici"><i class="fa fa-check"></i><b>4.10.1</b> Semplici funzioni matematiche, trigonometriche, statistiche, logiche, etc.</a></li>
<li class="chapter" data-level="4.10.2" data-path="datioggetti.html"><a href="datioggetti.html#operatori."><i class="fa fa-check"></i><b>4.10.2</b> Operatori.</a></li>
<li class="chapter" data-level="4.10.3" data-path="datioggetti.html"><a href="datioggetti.html#funzioni-built-in."><i class="fa fa-check"></i><b>4.10.3</b> Funzioni built-in.</a></li>
<li class="chapter" data-level="4.10.4" data-path="datioggetti.html"><a href="datioggetti.html#userdeffunc"><i class="fa fa-check"></i><b>4.10.4</b> Funzioni definite dall’utente.</a></li>
</ul></li>
<li class="chapter" data-level="4.11" data-path="datioggetti.html"><a href="datioggetti.html#programmare-con-stile."><i class="fa fa-check"></i><b>4.11</b> Programmare, con stile.</a></li>
<li class="chapter" data-level="4.12" data-path="datioggetti.html"><a href="datioggetti.html#un-ambiente-affollato."><i class="fa fa-check"></i><b>4.12</b> Un ambiente affollato.</a></li>
<li class="chapter" data-level="4.13" data-path="datioggetti.html"><a href="datioggetti.html#altrerisorsedati"><i class="fa fa-check"></i><b>4.13</b> Altre risorse.</a>
<ul>
<li class="chapter" data-level="4.13.1" data-path="datioggetti.html"><a href="datioggetti.html#risorse-in-italiano.-2"><i class="fa fa-check"></i><b>4.13.1</b> Risorse in italiano.</a></li>
<li class="chapter" data-level="4.13.2" data-path="datioggetti.html"><a href="datioggetti.html#risorse-in-inglese.-2"><i class="fa fa-check"></i><b>4.13.2</b> Risorse in inglese.</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="dentroefuoriR.html"><a href="dentroefuoriR.html"><i class="fa fa-check"></i><b>5</b> Dentro e fuori R</a>
<ul>
<li class="chapter" data-level="5.1" data-path="dentroefuoriR.html"><a href="dentroefuoriR.html#cosa-cè-da-imparare-in-questo-capitolo.-4"><i class="fa fa-check"></i><b>5.1</b> Cosa c’è da imparare in questo capitolo.</a></li>
<li class="chapter" data-level="5.2" data-path="dentroefuoriR.html"><a href="dentroefuoriR.html#ognicosaalsuoposto"><i class="fa fa-check"></i><b>5.2</b> Ogni cosa al suo posto: working directory, progetti, etc.</a></li>
<li class="chapter" data-level="5.3" data-path="dentroefuoriR.html"><a href="dentroefuoriR.html#facciamolasemplice"><i class="fa fa-check"></i><b>5.3</b> Facciamola semplice: il menu <code>Import Dataset</code>.</a></li>
<li class="chapter" data-level="5.4" data-path="dentroefuoriR.html"><a href="dentroefuoriR.html#usareadr"><i class="fa fa-check"></i><b>5.4</b> Gestire file di testo con <code>readr.</code></a></li>
<li class="chapter" data-level="5.5" data-path="dentroefuoriR.html"><a href="dentroefuoriR.html#tutti-i-comandi-o-quasi-per-importare-file-di-testo"><i class="fa fa-check"></i><b>5.5</b> Tutti i comandi (o quasi) per importare file di testo…</a></li>
<li class="chapter" data-level="5.6" data-path="dentroefuoriR.html"><a href="dentroefuoriR.html#altri-formati-di-dati."><i class="fa fa-check"></i><b>5.6</b> Altri formati di dati.</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="dentroefuoriR.html"><a href="dentroefuoriR.html#da-e-per-excel."><i class="fa fa-check"></i><b>5.6.1</b> Da e per Excel.</a></li>
<li class="chapter" data-level="5.6.2" data-path="dentroefuoriR.html"><a href="dentroefuoriR.html#altri-formati-foreign-e-hmisc-e-haven."><i class="fa fa-check"></i><b>5.6.2</b> Altri formati: <code>foreign</code> e <code>Hmisc</code> e <code>haven</code>.</a></li>
<li class="chapter" data-level="5.6.3" data-path="dentroefuoriR.html"><a href="dentroefuoriR.html#un-richiamo-file-.rdata-e-.rds"><i class="fa fa-check"></i><b>5.6.3</b> Un richiamo: file <code>.Rdata</code> e <code>.rds</code></a></li>
<li class="chapter" data-level="5.6.4" data-path="dentroefuoriR.html"><a href="dentroefuoriR.html#e-andato-tutto-bene"><i class="fa fa-check"></i><b>5.6.4</b> E’ andato tutto bene?</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="dentroefuoriR.html"><a href="dentroefuoriR.html#lavorare-con-i-nomi-dei-file-e-le-directory."><i class="fa fa-check"></i><b>5.7</b> Lavorare con i nomi dei file e le directory.</a></li>
<li class="chapter" data-level="5.8" data-path="dentroefuoriR.html"><a href="dentroefuoriR.html#app1sintassi"><i class="fa fa-check"></i><b>5.8</b> <strong>Appendice 1</strong>. <em>Un piccolo dettaglio sulla sintassi.</em></a></li>
<li class="chapter" data-level="5.9" data-path="dentroefuoriR.html"><a href="dentroefuoriR.html#app2finqui"><i class="fa fa-check"></i><b>5.9</b> <strong>Appendice 2</strong>. <em>Se sei arrivat* fin qui…</em></a></li>
<li class="chapter" data-level="5.10" data-path="dentroefuoriR.html"><a href="dentroefuoriR.html#altrerisdentrofuori"><i class="fa fa-check"></i><b>5.10</b> Altre risorse.</a>
<ul>
<li class="chapter" data-level="5.10.1" data-path="dentroefuoriR.html"><a href="dentroefuoriR.html#risorse-in-inglese.-3"><i class="fa fa-check"></i><b>5.10.1</b> Risorse in inglese.</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="grafica.html"><a href="grafica.html"><i class="fa fa-check"></i><b>6</b> Introduzione alla grafica scientifica con R</a>
<ul>
<li class="chapter" data-level="6.1" data-path="grafica.html"><a href="grafica.html#cosa-cè-da-imparare-in-questo-capitolo.-5"><i class="fa fa-check"></i><b>6.1</b> Cosa c’è da imparare in questo capitolo.</a></li>
<li class="chapter" data-level="6.2" data-path="grafica.html"><a href="grafica.html#igraficifattibene"><i class="fa fa-check"></i><b>6.2</b> I grafici, fatti bene.</a></li>
<li class="chapter" data-level="6.3" data-path="grafica.html"><a href="grafica.html#sistemigrafici"><i class="fa fa-check"></i><b>6.3</b> I sistemi grafici in R.</a></li>
<li class="chapter" data-level="6.4" data-path="grafica.html"><a href="grafica.html#visualizzare-o-salvare-i-grafici-i-device."><i class="fa fa-check"></i><b>6.4</b> Visualizzare o salvare i grafici: i device.</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="grafica.html"><a href="grafica.html#devicegrafici"><i class="fa fa-check"></i><b>6.4.1</b> Salvare i grafici: i file come device grafici.</a></li>
<li class="chapter" data-level="6.4.2" data-path="grafica.html"><a href="grafica.html#ggsave"><i class="fa fa-check"></i><b>6.4.2</b> Salvare i grafici di <code>ggplot2</code> con <code>ggsave</code>.</a></li>
<li class="chapter" data-level="6.4.3" data-path="grafica.html"><a href="grafica.html#le-dimensioni-del-device-e-le-opzioni-grafiche."><i class="fa fa-check"></i><b>6.4.3</b> <em>Le dimensioni del device e le opzioni grafiche.</em></a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="grafica.html"><a href="grafica.html#r-a-colori."><i class="fa fa-check"></i><b>6.5</b> R, a colori.</a></li>
<li class="chapter" data-level="6.6" data-path="grafica.html"><a href="grafica.html#graficaggplot2"><i class="fa fa-check"></i><b>6.6</b> La grammatica della grafica con ggplot2.</a></li>
<li class="chapter" data-level="6.7" data-path="grafica.html"><a href="grafica.html#grafqual"><i class="fa fa-check"></i><b>6.7</b> Grafici per variabili qualitative.</a>
<ul>
<li class="chapter" data-level="6.7.1" data-path="grafica.html"><a href="grafica.html#diagrammi-a-barre."><i class="fa fa-check"></i><b>6.7.1</b> Diagrammi a barre.</a></li>
<li class="chapter" data-level="6.7.2" data-path="grafica.html"><a href="grafica.html#fare-di-più-con-i-grafici-per-variabili-qualitative."><i class="fa fa-check"></i><b>6.7.2</b> <em>Fare di più con i grafici per variabili qualitative.</em></a></li>
</ul></li>
<li class="chapter" data-level="6.8" data-path="grafica.html"><a href="grafica.html#grafquant"><i class="fa fa-check"></i><b>6.8</b> Grafici per variabili quantitative.</a>
<ul>
<li class="chapter" data-level="6.8.1" data-path="grafica.html"><a href="grafica.html#istogrammi-e-altre-rappresentazioni-della-densità."><i class="fa fa-check"></i><b>6.8.1</b> Istogrammi e altre rappresentazioni della densità.</a></li>
<li class="chapter" data-level="6.8.2" data-path="grafica.html"><a href="grafica.html#boxplot"><i class="fa fa-check"></i><b>6.8.2</b> Boxplot.</a></li>
<li class="chapter" data-level="6.8.3" data-path="grafica.html"><a href="grafica.html#rappresentazioni-di-indicatori-di-tendenza-centrale-e-di-variabilità."><i class="fa fa-check"></i><b>6.8.3</b> Rappresentazioni di indicatori di tendenza centrale e di variabilità.</a></li>
<li class="chapter" data-level="6.8.4" data-path="grafica.html"><a href="grafica.html#scatterplots"><i class="fa fa-check"></i><b>6.8.4</b> Grafici a dispersione.</a></li>
<li class="chapter" data-level="6.8.5" data-path="grafica.html"><a href="grafica.html#personalizzare-i-grafici-con-ggplot2."><i class="fa fa-check"></i><b>6.8.5</b> <em>Personalizzare i grafici con ggplot2.</em></a></li>
<li class="chapter" data-level="6.8.6" data-path="grafica.html"><a href="grafica.html#estensionigg"><i class="fa fa-check"></i><b>6.8.6</b> <em>Estensioni per ggplot2.</em></a></li>
<li class="chapter" data-level="6.8.7" data-path="grafica.html"><a href="grafica.html#qplot"><i class="fa fa-check"></i><b>6.8.7</b> <em>Veloce veloce: qplot()</em></a></li>
</ul></li>
<li class="chapter" data-level="6.9" data-path="grafica.html"><a href="grafica.html#graficabase"><i class="fa fa-check"></i><b>6.9</b> <em>La grafica di base in R: un salvagente?</em></a></li>
<li class="chapter" data-level="6.10" data-path="grafica.html"><a href="grafica.html#altrerisgraf"><i class="fa fa-check"></i><b>6.10</b> Altre risorse.</a>
<ul>
<li class="chapter" data-level="6.10.1" data-path="grafica.html"><a href="grafica.html#risorse-in-inglese.-4"><i class="fa fa-check"></i><b>6.10.1</b> Risorse in inglese.</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="statdesc.html"><a href="statdesc.html"><i class="fa fa-check"></i><b>7</b> Esplorare con i numeri</a>
<ul>
<li class="chapter" data-level="7.1" data-path="statdesc.html"><a href="statdesc.html#cosa-cè-da-imparare-in-questo-capitolo.-6"><i class="fa fa-check"></i><b>7.1</b> Cosa c’è da imparare in questo capitolo.</a></li>
<li class="chapter" data-level="7.2" data-path="statdesc.html"><a href="statdesc.html#una-piccola-premessa-gruppi-livelli-sottoinsiemi."><i class="fa fa-check"></i><b>7.2</b> Una piccola premessa: gruppi, livelli, sottoinsiemi.</a></li>
<li class="chapter" data-level="7.3" data-path="statdesc.html"><a href="statdesc.html#statcontinui"><i class="fa fa-check"></i><b>7.3</b> Statistiche riassuntive per dati continui.</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="statdesc.html"><a href="statdesc.html#misuretendcentrale"><i class="fa fa-check"></i><b>7.3.1</b> Misure di tendenza centrale e di variabilità.</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="statdesc.html"><a href="statdesc.html#altre-funzioni-utili."><i class="fa fa-check"></i><b>7.4</b> <em>Altre funzioni utili.</em></a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="statdesc.html"><a href="statdesc.html#lavorare-sui-vettori."><i class="fa fa-check"></i><b>7.4.1</b> <em>Lavorare sui vettori.</em></a></li>
<li class="chapter" data-level="7.4.2" data-path="statdesc.html"><a href="statdesc.html#funzioni-che-producono-statistiche-riassuntive."><i class="fa fa-check"></i><b>7.4.2</b> <em>Funzioni che producono statistiche riassuntive.</em></a></li>
<li class="chapter" data-level="7.4.3" data-path="statdesc.html"><a href="statdesc.html#statsummarise"><i class="fa fa-check"></i><b>7.4.3</b> Statistiche, ordinate.</a></li>
<li class="chapter" data-level="7.4.4" data-path="statdesc.html"><a href="statdesc.html#statgruppi"><i class="fa fa-check"></i><b>7.4.4</b> Statistiche riassuntive per gruppi.</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="statdesc.html"><a href="statdesc.html#enormale"><i class="fa fa-check"></i><b>7.5</b> Ma è normale?</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="statdesc.html"><a href="statdesc.html#normal-probability-plot."><i class="fa fa-check"></i><b>7.5.1</b> Normal probability plot.</a></li>
<li class="chapter" data-level="7.5.2" data-path="statdesc.html"><a href="statdesc.html#testnorm"><i class="fa fa-check"></i><b>7.5.2</b> Test statistici per la normalità.</a></li>
<li class="chapter" data-level="7.5.3" data-path="statdesc.html"><a href="statdesc.html#comefaremeglio"><i class="fa fa-check"></i><b>7.5.3</b> <em>Come fare di meglio con i risultati dei test</em>.</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="statdesc.html"><a href="statdesc.html#intervalli-di-confidenza."><i class="fa fa-check"></i><b>7.6</b> Intervalli di confidenza.</a></li>
<li class="chapter" data-level="7.7" data-path="statdesc.html"><a href="statdesc.html#statdesccat"><i class="fa fa-check"></i><b>7.7</b> Riassumere i dati per le variabili categoriche.</a>
<ul>
<li class="chapter" data-level="7.7.1" data-path="statdesc.html"><a href="statdesc.html#tabelle-di-frequenza-e-contingenza."><i class="fa fa-check"></i><b>7.7.1</b> Tabelle di frequenza e contingenza.</a></li>
<li class="chapter" data-level="7.7.2" data-path="statdesc.html"><a href="statdesc.html#gmosaico"><i class="fa fa-check"></i><b>7.7.2</b> <em>Grafici a mosaico</em>.</a></li>
</ul></li>
<li class="chapter" data-level="7.8" data-path="statdesc.html"><a href="statdesc.html#veloceveloce"><i class="fa fa-check"></i><b>7.8</b> <em>Veloce veloce</em></a></li>
<li class="chapter" data-level="7.9" data-path="statdesc.html"><a href="statdesc.html#altrerisstatdesc"><i class="fa fa-check"></i><b>7.9</b> Altre risorse.</a>
<ul>
<li class="chapter" data-level="7.9.1" data-path="statdesc.html"><a href="statdesc.html#risorse-in-italiano.-3"><i class="fa fa-check"></i><b>7.9.1</b> Risorse in italiano.</a></li>
<li class="chapter" data-level="7.9.2" data-path="statdesc.html"><a href="statdesc.html#risorse-in-inglese.-5"><i class="fa fa-check"></i><b>7.9.2</b> Risorse in inglese.</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="reportR.html"><a href="reportR.html"><i class="fa fa-check"></i><b>8</b> Creare report e notebook con R.</a>
<ul>
<li class="chapter" data-level="8.1" data-path="reportR.html"><a href="reportR.html#cosa-cè-da-imparare-in-questo-capitolo.-7"><i class="fa fa-check"></i><b>8.1</b> Cosa c’è da imparare in questo capitolo.</a></li>
<li class="chapter" data-level="8.2" data-path="reportR.html"><a href="reportR.html#reportminimo"><i class="fa fa-check"></i><b>8.2</b> Il minimo indispensabile.</a></li>
<li class="chapter" data-level="8.3" data-path="reportR.html"><a href="reportR.html#gli-elementi-di-un-report-in-r-markdown."><i class="fa fa-check"></i><b>8.3</b> <em>Gli elementi di un report in R Markdown.</em></a></li>
<li class="chapter" data-level="8.4" data-path="reportR.html"><a href="reportR.html#altri-formati-di-documento-con-r-markdown."><i class="fa fa-check"></i><b>8.4</b> <em>Altri formati di documento con R Markdown.</em></a></li>
<li class="chapter" data-level="8.5" data-path="reportR.html"><a href="reportR.html#quarto."><i class="fa fa-check"></i><b>8.5</b> <em>Quarto.</em></a></li>
<li class="chapter" data-level="8.6" data-path="reportR.html"><a href="reportR.html#altrerisreport"><i class="fa fa-check"></i><b>8.6</b> Altre risorse.</a>
<ul>
<li class="chapter" data-level="8.6.1" data-path="reportR.html"><a href="reportR.html#risorse-in-italiano.-4"><i class="fa fa-check"></i><b>8.6.1</b> Risorse in italiano.</a></li>
<li class="chapter" data-level="8.6.2" data-path="reportR.html"><a href="reportR.html#risorse-in-inglese.-6"><i class="fa fa-check"></i><b>8.6.2</b> Risorse in inglese.</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="wrangling.html"><a href="wrangling.html"><i class="fa fa-check"></i><b>9</b> Lottare con i dati.</a>
<ul>
<li class="chapter" data-level="9.1" data-path="wrangling.html"><a href="wrangling.html#cosa-cè-da-imparare-in-questo-capitolo.-8"><i class="fa fa-check"></i><b>9.1</b> Cosa c’è da imparare in questo capitolo.</a></li>
<li class="chapter" data-level="9.2" data-path="wrangling.html"><a href="wrangling.html#rendere-tidy-i-dati."><i class="fa fa-check"></i><b>9.2</b> Rendere tidy i dati.</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="wrangling.html"><a href="wrangling.html#tidyresh"><i class="fa fa-check"></i><b>9.2.1</b> Riordinare con <code>tidyr</code> e <code>dplyr</code>: esempio minimo.</a></li>
<li class="chapter" data-level="9.2.2" data-path="wrangling.html"><a href="wrangling.html#funzioni-avanzate-con-tidyr."><i class="fa fa-check"></i><b>9.2.2</b> <em>Funzioni avanzate con <code>tidyr</code>.</em></a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="wrangling.html"><a href="wrangling.html#dplyr"><i class="fa fa-check"></i><b>9.3</b> il cavallo di battaglia del <code>data wrangling</code>: <code>dplyr</code>.</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="wrangling.html"><a href="wrangling.html#filterselect"><i class="fa fa-check"></i><b>9.3.1</b> Estrarre gruppi di righe o colonne.</a></li>
<li class="chapter" data-level="9.3.2" data-path="wrangling.html"><a href="wrangling.html#riordinare-i-dati."><i class="fa fa-check"></i><b>9.3.2</b> Riordinare i dati.</a></li>
<li class="chapter" data-level="9.3.3" data-path="wrangling.html"><a href="wrangling.html#muta"><i class="fa fa-check"></i><b>9.3.3</b> Trasformare con <code>mutate()</code>.</a></li>
<li class="chapter" data-level="9.3.4" data-path="wrangling.html"><a href="wrangling.html#summarise"><i class="fa fa-check"></i><b>9.3.4</b> Riassumere i dati con <code>summarise()</code>.</a></li>
<li class="chapter" data-level="9.3.5" data-path="wrangling.html"><a href="wrangling.html#join"><i class="fa fa-check"></i><b>9.3.5</b> Database e tabelle relazionali: unire tabelle con _join.</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="wrangling.html"><a href="wrangling.html#strutturecontrollo"><i class="fa fa-check"></i><b>9.4</b> Strutture di controllo.</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="wrangling.html"><a href="wrangling.html#loop"><i class="fa fa-check"></i><b>9.4.1</b> <em>Loop (o cicli) e cose simili.</em></a></li>
<li class="chapter" data-level="9.4.2" data-path="wrangling.html"><a href="wrangling.html#functional"><i class="fa fa-check"></i><b>9.4.2</b> <em>Un’alternativa (veloce e ordinata) ai loop: i “functional”.</em></a></li>
<li class="chapter" data-level="9.4.3" data-path="wrangling.html"><a href="wrangling.html#ifelsestat"><i class="fa fa-check"></i><b>9.4.3</b> <em>Esecuzione condizionale.</em></a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="wrangling.html"><a href="wrangling.html#Soluzione"><i class="fa fa-check"></i><b>9.5</b> La soluzione dell’esercizio.</a></li>
<li class="chapter" data-level="9.6" data-path="wrangling.html"><a href="wrangling.html#altreriswrangling"><i class="fa fa-check"></i><b>9.6</b> Altre risorse.</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="wrangling.html"><a href="wrangling.html#risorse-in-italiano.-5"><i class="fa fa-check"></i><b>9.6.1</b> Risorse in italiano.</a></li>
<li class="chapter" data-level="9.6.2" data-path="wrangling.html"><a href="wrangling.html#risorse-in-inglese.-7"><i class="fa fa-check"></i><b>9.6.2</b> Risorse in inglese.</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="citazioni-crediti-copyright-ringraziamenti..html"><a href="citazioni-crediti-copyright-ringraziamenti..html"><i class="fa fa-check"></i><b>10</b> Citazioni, crediti, copyright, ringraziamenti.</a>
<ul>
<li class="chapter" data-level="10.1" data-path="citazioni-crediti-copyright-ringraziamenti..html"><a href="citazioni-crediti-copyright-ringraziamenti..html#citazioni."><i class="fa fa-check"></i><b>10.1</b> Citazioni.</a></li>
<li class="chapter" data-level="" data-path="citazioni-crediti-copyright-ringraziamenti..html"><a href="citazioni-crediti-copyright-ringraziamenti..html#credits-e-copyright."><i class="fa fa-check"></i>Credits e copyright.</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">pigR: R, per pigri</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="grafica" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">6</span> Introduzione alla grafica scientifica con R<a href="grafica.html#grafica" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>v1.1 4/11/2023</p>
<div id="cosa-cè-da-imparare-in-questo-capitolo.-5" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> Cosa c’è da imparare in questo capitolo.<a href="grafica.html#cosa-cè-da-imparare-in-questo-capitolo.-5" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In qualsiasi libro introduttivo su R il capitolo sulla grafica è probabilmente il più importante. I grafici (scientifici e non) sono sicuramente il modo più efficace di rappresentare i dati, viste le capacità degli esseri umani di percepire pattern in maniera prevalentemente visuale. R ha, senza dubbio, capacità di rappresentazione grafica dei dati (scientifici e non) molto superiori a quelle di altri ambienti e linguaggi per la data science. In aggiunta a questo, l’output grafico di R si presta bene ad essere inserito in documenti, app e dashboard interattive.<br />
Puoi avere un’idea rapida di quello che può fare la grafica di base di R con il seguente comando:</p>
<pre><code>&gt;demo(graphics)</code></pre>
<p>Un’idea migliore può dartela questa bella <a href="https://www.r-graph-gallery.com">gallery</a> di grafici con R (preparati a sopportare un bel po’ di pubblicità).<br />
Proprio per questo, è bene che tu dedichi un po’ di tempo a questo capitolo.<br />
Nella sezione <a href="grafica.html#igraficifattibene">6.2</a> cercherò di dara qualche informazione di base sui principi della rappresentazione grafica dei dati. Leggere questa sezione potrebbe risparmiarti molti mal di testa in futuro<a href="#fn124" class="footnote-ref" id="fnref124"><sup>124</sup></a>.<br />
Nella sezione <a href="grafica.html#sistemigrafici">6.3</a> proverò a confrontare i diversi sistemi grafici disponibili in R: come sempre, con l’installazione base di R puoi fare molto (se non tutto) e molti pacchetti basano la loro grafica esclusivamente sulla grafica di base (<a href="grafica.html#graficabase">6.9</a>). D’altra parte, la <a href="https://vita.had.co.nz/papers/layered-grammar.pdf">grammatica della grafica</a>, implementata da <a href="https://ggplot2.tidyverse.org">ggplot2</a>, è sicuramente più semplice da imparare e si inserisce in maniera elegante nei flussi di lavoro <code>tidy</code> (ordinati). Per questa ragione, quasi tutto il capitolo sarà concentrato sulla grafica con <a href="https://ggplot2.tidyverse.org">ggplot2</a>. Spenderò poi qualche parola sul salvataggio dei grafici in R, semplicissimo per la grafica generata da <code>ggplot2</code>, e appena un po’ più complicato (perché richiede il reindirizzamento dell’output dal display a un device o tipo di file, vedi sezione <a href="grafica.html#devicegrafici">6.4.1</a>) con la grafica di base.<br />
Infine, mi concentrerò sulla grafica (o meglio sulla visualizzazione di dati) con <code>ggplot2</code>, illustrando i principali tipi di grafici per variabili qualitative e/o quantitative (e tutte le loro possibili combinazioni).<br />
Può sembrare strano, ma qualche cosina sulla grafica base R è necessario impararla (sezione <a href="grafica.html#graficabase">6.9</a>): molti pacchetti importanti usano la grafica di base e personalizzare l’output richiede qualche conoscenza di questo sistema.<br />
La capacità di produrre visualizzazioni dei dati efficaci, eleganti e convincenti è essenziale per qualsiasi scienziat* o analista dei dati. Per questo sarebbe bene leggere con attenzione tutto il capitolo. In alternativa, puoi dare una lettura veloce alla sezione <a href="grafica.html#igraficifattibene">6.2</a>, alla sezione <a href="grafica.html#graficaggplot2">6.6</a> sui principi dell’uso di <code>ggplot2</code>, e concentrarti su quelli fra i paragrafi successivi che illustrano i tipi di grafico che sono più importanti per te. Potrai tornare sugli altri argomenti quando serve. Come sempre, i paragrafi di approfondimento hanno un titolo in <em>corsivo</em>.</p>
</div>
<div id="igraficifattibene" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">6.2</span> I grafici, fatti bene.<a href="grafica.html#igraficifattibene" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>La rappresentazione visuale dei dati è fondamentale il moltissimi campi e la cattiva rappresentazione dei dati è forse una delle basi principali delle diffidenza che molti nutrono per la statistica. L’ignoranza degli aspetti anche più elementari della visualizzazione dei dati da parte della stragrande maggioranza del pubblico è sicuramente un’altra ragione. Giornalisti (della carta stampata, del web e della televisione) ne fanno un largo (ab)uso e alcune infografiche sono talmente assurde da diventare dei veri e propri meme: questo <a href="https://www.scienzainrete.it/articolo/che-razza-di-infografica/marco-capovilla/2017-05-14">articolo</a> del blog Scienza in rete ne dà una rappresentazione, come dire, plastica. Non è detto, purtroppo, che gli scienziati facciano una lavoro migliore e, nella mia vita di ricercatore (e, purtroppo, di reviewer di articoli scientifici) ho visto cose che voi umani…
Produrre delle buone visualizzazioni di dati (che forse è un modo migliore di dire rispetto a grafici scientifici, che sembra troppo limitato alle pubblicazioni scientifiche) è una cosa che si impara (purtroppo non nell’università della strada), e si impara studiando. Nella sezione <a href="grafica.html#altrerisgraf">6.10</a> troverai qualche suggerimento<a href="#fn125" class="footnote-ref" id="fnref125"><sup>125</sup></a>. A questo dovremmo forse aggiungere il fatto che, come scienziati abbiamo forse qualche responsabilità in più: i grafici che generiamo dovrebbero rappresentare la realtà nella maniera più fedele e oggettiva possibile, e al tempo stesso, rispondere alle esigenze di informare, motivare e convincere, che sono proprie di qualsiasi forma di comunicazione. Se poi riusciamo anche a produrre grafici belli da vedere<a href="#fn126" class="footnote-ref" id="fnref126"><sup>126</sup></a> è meglio, mi pare.
Una trattazione estesa della tecnica e dell’arte della visualizzazione (scientifica) dei dati è decisamente al di là dello scopo di questo “libro”. Alcune cose però vanno dette.<br />
Innanzitutto, è impossibile astrarre completamente dai pregi e dai difetti del nostro sistema di percezione. Gli esseri umani processano buona parte dell’informazione che raggiunge i sensi attraverso la vista e, tipicamente, perché questa informazione “resti” nella nostra memoria sono necessari diversi passaggi<a href="#fn127" class="footnote-ref" id="fnref127"><sup>127</sup></a>: lo stimolo visivo viene inizialmente processato dalla <a href="https://www.serenis.it/articoli/la-memoria-iconica-e-come-funziona/">memoria iconica</a>, per poi passare nella memoria a breve (che include la memoria di lavoro visiva) e infine in quella a lungo termine. Mentre i primi passaggi sono largamente inconsci, il passaggio nella memoria a lungo termine richiede un processo di creazione di relazioni con quella che è la nostra conoscenza del mondo. Stimoli visivi poco contrastati o poco intensi potrebbero essere difficili da processare e la memoria a breve termine sembra essere in qualche modo limitata: il numero di elementi diversi che possono essere conservati prima del passaggio alla memoria a lungo termine è compreso fra 4 e 9.<a href="#fn128" class="footnote-ref" id="fnref128"><sup>128</sup></a>.<br />
Insomma, ritenere le informazioni che giungono al nostro sistema visivo richiede “lavoro” e ci sono dei limiti a quello che il nostro sistema di percezione può fare in un tempo limitato. Mentre se state leggendo un libro o un articolo scientifico potete dedicare quanto tempo volete ad un singolo grafico (o a una foto), se state guardando un video o una presentazione avete generalmente un tempo limitato. Pensate al fastidio che provate quando, dal fondo di un’aula o di una sala congressi affollata, guardate ad una presentazione con grafici troppo complessi, sfocati, poco contrastati o troppo ricchi di informazione, che magari restano sullo schermo 30 secondi. Difficilmente riuscirete a seguire ciò che chi parla vuole comunicare e entrambi avrete perso il vostro tempo.<br />
Inoltre, lo scopo della visualizzazione scientifica dei dati è fornire informazioni in modo corretto e questo, tipicamente, richiede dei confronti quantitativi. La gerarchia (da migliore a peggiore) della nostra capacità di fare confronti fra valori è<a href="#fn129" class="footnote-ref" id="fnref129"><sup>129</sup></a>:</p>
<ol style="list-style-type: decimal">
<li><p>posizione su una scala comune (per esempio quando si guarda alla posizione di diversi punti in un dot plot o linee in un rug plot, ma anche, per estensione, di punti in un grafico cartesiano)</p></li>
<li><p>posizione su scale non comuni (per esempio quando si confronta la posizione di punti su due grafici con assi cartesiani diversi presenti nella stessa figura)</p></li>
<li><p>lunghezza (quando per esempio si vuole confrontare la lunghezza dei box fra diversi box and whisker plot)</p></li>
<li><p>angoli o pendenze (per esempio in un grafico a coordinate angolari)</p></li>
<li><p>aree (per esempio quando si vuole confrontare la dimensione di punti in un bubble plot) e intensità di colore (usata per esempio per mappare una variabile quantitativa al colore di un punto)</p></li>
<li><p>colori diversi (usati, male, in moltissime situazioni e spesso senza tener presente il fatto che molti non hanno una percezione corretta dei colori)</p></li>
</ol>
<p>E’ abbastanza ovvio che dovremmo attribuire le variabili più importanti alle posizioni gerarchiche più alte di questa scala. In molti grafici più complessi è necessario far percepire con chiarezza delle relazioni non quantitative, come relazioni di similarità (in un icon plot), inclusione (per esempio in una ellissi bivariata di densità), prossimità (in uno dei tantissimi grafici multivariati che servono a percepire la presenza di cluster nei dati), presenza di connessioni (per esempio in un dendrogramma o in un albero di decisioni o in un network), appartenenza allo stesso gruppo, etc.<br />
Se non conosci i tipi di grafici che ho nominato nel paragrafo precedente, non preoccuparti, li incontrerai presto.<br />
Progettare bene una visualizzazione scientifica non è quindi una cosa per niente banale: molto spesso ci si lascia guidare dall’istinto o dalle consuetudini di un determinato campo (nel mio, che mi occupo di ecologia microbica, sono abbastranza frequenti le visualizzazioni monstre, che richiederebbero parecchi minuti per cominciare, forse, a capirle, e che vengono mostrate per pochi secondi durante una presentazione).<br />
Se ti interessa approfondire questi argomenti dai (uno o più di) uno sguardo ai molti bei libri che richiamo nella sezione <a href="grafica.html#altrerisgraf">6.10</a>. Fortunatamente, i default della grafica di base e di <code>ggplot2</code> in R sono “intelligenti” e ti impediranno (a meno che tu non ti impegni veramente tanto) di fare molte sciocchezze che sono invece frequentissime nei grafici generati con Microsoft Excel e molti altri fogli di calcolo.</p>
</div>
<div id="sistemigrafici" class="section level2 hasAnchor" number="6.3">
<h2><span class="header-section-number">6.3</span> I sistemi grafici in R.<a href="grafica.html#sistemigrafici" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>R ha tre sistemi grafici principali:</p>
<ul>
<li><p><strong>base</strong>: è il sistema di default, e viene installato insieme a R con i pacchetti <em>graphics</em> e <em>grDevices</em>; ha un numero limitato di comandi per generare grafici (barplot, boxplot, hist, pairs, plot, etc.) e una serie di comandi complementari per personalizzare il grafico aggiungendo punti, modificando assi, legende, etc. I grafici sono inviati a “devices”, come lo schermo (il device di default)<a href="#fn130" class="footnote-ref" id="fnref130"><sup>130</sup></a> o file.</p></li>
<li><p><strong>lattice</strong>: richiede l’istallazione del pacchetto corrispondente<a href="#fn131" class="footnote-ref" id="fnref131"><sup>131</sup></a>; il grafico viene creato da un unico comando (con un gran numero di parametri) e inviato a un device o a un file; è un sistema particolarmente adatto a grafici multivariati e alla creazione di sub-plot per gruppi di dati sulla base di variabili qualitative o quantitative (<a href="https://www.statmethods.net/advgraphs/trellis.html">trellis plots</a>).</p></li>
<li><p><strong>ggplot2</strong>: richiede l’istallazione del pacchetto corrispondente (o del <code>tidyverse</code>); i grafici vengono creati in “strati”, secondo il concetto della <a href="https://vita.had.co.nz/papers/layered-grammar.pdf">grammatica della grafica</a>; una volta creato, il grafico, se assegnato ad un nome, può essere modificato con l’aggiunta di nuovi “strati” e salvato in una varietà di formati con un comando specifico (<code>ggsave</code>)</p></li>
</ul>
<p>Un confronto per un grafico a dispersione fra i tre sistemi, con la configurazione e personalizzazione minima, è mostrato dalle tre figure successive per il data set <code>mpg</code>, che è a sua volta incluso in <code>ggplot2</code>.<br />
La Figura <a href="grafica.html#fig:mpgbase">6.1</a> mostra la relazione fra il consumo (<code>hwy</code>, in galloni per miglio) di carburante in autostrada e la cilindrata (<code>displ</code>, in litri) ottenuta con il comando generico <code>plot()</code> della grafica di base.</p>
<div class="sourceCode" id="cb590"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb590-1"><a href="grafica.html#cb590-1" tabindex="-1"></a><span class="co"># se necessario carica la library tidyverse dopo aver rimosso il segno # di commento</span></span>
<span id="cb590-2"><a href="grafica.html#cb590-2" tabindex="-1"></a><span class="co"># library(tidyverse)</span></span>
<span id="cb590-3"><a href="grafica.html#cb590-3" tabindex="-1"></a><span class="fu">data</span>(mpg)</span>
<span id="cb590-4"><a href="grafica.html#cb590-4" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> mpg<span class="sc">$</span>displ, <span class="at">y =</span> mpg<span class="sc">$</span>hwy)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:mpgbase"></span>
<img src="_main_files/figure-html/mpgbase-1.png" alt="Un grafico a dispersione ottenuto con la grafica di base di R." width="1050" />
<p class="caption">
Figura 6.1: Un grafico a dispersione ottenuto con la grafica di base di R.
</p>
</div>
<p>Qui vengono specificamente assegnati alle coordinate x e y due vettori, appartenenti allo stesso data set (in teoria possono essere 2 vettori numerici separati o addirittura due vettori in due data set diversi, ma della stessa lunghezza). Scale, etichette degli assi, simboli, titoli e sottotitoli, legende possono essere largamente personalizzati.<br />
Le funzioni della grafica di base permettono di creare rapidamente (con il minimo di comandi) molti grafici semplici, che possono essere ulteriormente personalizzati. Inoltre, gli oggetti prodotti da molte funzioni della statistica di base o aggiunte con i pacchetti possono essere direttamente utilizzati nella funzione generica <code>plot()</code> generando grafici dipendenti dal contesto. Personalmente, trovo la sintassi della grafica di base difficile da ricordare. In aggiunta a questo, la creazione del grafico può essere piuttosto verbosa (cioé richiede molti comandi) perché i grafici vengono creati aggiungendo ad un oggetto creato da un comando di base (per esempio <code>plot()</code>) una serie di altre cose create da altri comandi (<code>points()</code>, <code>legend()</code>, <code>lines()</code>).<br />
La Figura <a href="grafica.html#fig:mpglattice">6.2</a> mostra un <code>trellis plot</code> ottenuto con il comando <code>xyplot</code> di lattice. Qui la variabile qualitativa <code>class</code> è usata come variabile di gruppo. Fare la stessa cosa con la grafica di base è decisamente più complicato. Nota come in questo caso sto usando un’interfaccia <code>formula, data</code>, utilizzabile anche con <code>plot</code>. Le variabili dipendente e indipendente sono separate da una tilde <code>~</code> e la variabile di gruppo (quella che separa le singole osservazioni nei pannelli) è separata da una barra verticale <code>|</code> e il set di dati è indicato come <code>data = mpg</code>.</p>
<hr />
<div class="sourceCode" id="cb591"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb591-1"><a href="grafica.html#cb591-1" tabindex="-1"></a><span class="fu">library</span>(lattice)</span>
<span id="cb591-2"><a href="grafica.html#cb591-2" tabindex="-1"></a><span class="fu">xyplot</span>(hwy <span class="sc">~</span> displ <span class="sc">|</span> class, <span class="at">data =</span> mpg)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:mpglattice"></span>
<img src="_main_files/figure-html/mpglattice-1.png" alt="Un grafico a dispersione ottenuto con `lattice`." width="1050" />
<p class="caption">
Figura 6.2: Un grafico a dispersione ottenuto con <code>lattice</code>.
</p>
</div>
<hr />
<p>Anche <code>lattice</code> è usato in molti pacchetti importanti (come per esempio <a href="https://cran.r-project.org/web/packages/car/index.html"><code>car</code></a>).<br />
Come gli altri pacchetti del <code>tidyverse</code>, <a href="https://ggplot2.tidyverse.org"><code>ggplot2</code></a> è molto più intuitivo, anche se i comandi possono essere più “verbosi”. Le già ragguardevoli capacità di <code>ggplot2</code> sono estese da un gran numero di <a href="https://exts.ggplot2.tidyverse.org.">pacchetti aggiuntivi</a>.<br />
Infine, la figura <a href="grafica.html#fig:mpgggplot">6.3</a> mostra l’equivalente della figura <a href="grafica.html#fig:mpglattice">6.2</a> ottenuto con <code>ggplot2</code> (qui i pannelli sono generati dal comando <code>facet_wrap()</code>).</p>
<hr />
<div class="sourceCode" id="cb592"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb592-1"><a href="grafica.html#cb592-1" tabindex="-1"></a><span class="co"># library(ggplot2)</span></span>
<span id="cb592-2"><a href="grafica.html#cb592-2" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> mpg, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy)) <span class="sc">+</span></span>
<span id="cb592-3"><a href="grafica.html#cb592-3" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb592-4"><a href="grafica.html#cb592-4" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>class) </span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:mpgggplot"></span>
<img src="_main_files/figure-html/mpgggplot-1.png" alt="Un grafico a dispersione ottenuto con `ggplot2`." width="1050" />
<p class="caption">
Figura 6.3: Un grafico a dispersione ottenuto con <code>ggplot2</code>.
</p>
</div>
<hr />
<p>Infine, quando diventerai più espert*, dovresti provare a esplorare i sistemi grafici interattivi, come <a href="https://ggvis.rstudio.com">ggvis</a> e <a href="https://plotly.com/r/">plotly</a>.</p>
</div>
<div id="visualizzare-o-salvare-i-grafici-i-device." class="section level2 hasAnchor" number="6.4">
<h2><span class="header-section-number">6.4</span> Visualizzare o salvare i grafici: i device.<a href="grafica.html#visualizzare-o-salvare-i-grafici-i-device." class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In R i grafici vengono inviati a quelli che si chiamano <code>device</code>. Di default, il <code>device</code> è lo schermo e il comando che viene usato dietro le quinte è specifico per piattaforma.<br />
Prova a copiare e incollare in un nuovo script i seguenti comandi:</p>
<pre><code>library(tidyverse) # potrebbe non essere necessario, se hai già caricato tidyverse
plot(x = mpg$displ, y = mpg$hwy)</code></pre>
<p>In RStudio, di default, i grafici prodotti da qualsiasi tipo di grafica vengono inviati al tab <code>Plots</code> del pannello <code>Plot</code>, ed è proprio in questo tab che dovresti vedere apparire il grafico. Se tu eseguissi lo stesso tipo di comando nella GUI di R, il grafico verrebbe inviato a una finestra che può aprirsi in un ambiente diverso (X11 su Mac)<a href="#fn132" class="footnote-ref" id="fnref132"><sup>132</sup></a>.
Il <code>Plots</code> tab di RStudio offre diverse funzionalità utili (vedi capitolo <a href="inter.html#inter">2</a>), ma può causare alcuni problemi, legati al fatto che i grafici vengono ridimensionati in maniera dinamica (mentre magari potrebbe interessarti vedere il grafico così come potrebbe apparire se lo salvassi, vedi dopo, e lo aprissi in un’altra applicazione)<a href="#fn133" class="footnote-ref" id="fnref133"><sup>133</sup></a>.
Il risultato dei comandi precedenti è questo:</p>
<hr />
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:RStudioint"></span>
<img src="images/mpgplots.jpg" alt="L'interfaccia di RStudio per MacOS." width="90%" />
<p class="caption">
Figura 6.4: L’interfaccia di RStudio per MacOS.
</p>
</div>
<hr />
<p>Prova a fare quanto segue:</p>
<ul>
<li><p>ridimensiona il tab “Plots” posizionando il puntatore sulla barra orizzontale o su quella verticale che delimitano il pannello: dovrebbe apparire una doppia frecccia, clicca con il mouse e ridimensiona il grafico;</p></li>
<li><p>clicca sul pulsante per lo <code>Zoom</code> nella barra dei menu del tab <code>Plots</code> (quello con la lente di ingradimento): si apre una nuova finestra che puoi ridimensionare liberamente;</p></li>
<li><p>clicca sul pulsante <code>Export</code> nella barra dei menu del tab <code>Plots</code> (quello con l’icona della piccola immagine); clicca su una delle opzioni, per esempio quella <code>Save as image</code> e scegli una delle opzioni. Se crei un’immagine bitmap (.tif, .jpg, .png, vedi dopo), e la apri con una app per la visualizzazione o modifica delle immagini, vedrai che la risoluzione è quella dello schermo (nel mio caso 96 dpi), che è ampiamente insufficiente per molte applicazioni.</p></li>
</ul>
<div id="devicegrafici" class="section level3 hasAnchor" number="6.4.1">
<h3><span class="header-section-number">6.4.1</span> Salvare i grafici: i file come device grafici.<a href="grafica.html#devicegrafici" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Come hai appena visto, la risoluzione dei grafici creati nel <code>plot pane</code> è insufficiente per molte applicazioni: per un lavoro scientifico, tipicamente, è necessario sottomettere i grafici in formato vettoriale (.eps o .pdf) o sotto forma di immagini bitmap ad alta risoluzione (300 o 600 dpi). Per farlo, occorre salvare i grafici nel formato opportuno. La tabella <a href="grafica.html#tab:grafdevices">6.1</a> riporta un elenco dei device per i formati più frequentemente usati nella grafica scientifica, con qualche nota importante sulle proprietà di ciascun formato<a href="#fn134" class="footnote-ref" id="fnref134"><sup>134</sup></a>.</p>
<table class="table table-striped" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:grafdevices">Tabella 6.1: </span>I più comuni formati grafici e i relativi device.
</caption>
<thead>
<tr>
<th style="text-align:left;">
Device
</th>
<th style="text-align:left;">
Formato
</th>
<th style="text-align:left;">
Estensione
</th>
<th style="text-align:left;">
Tipologia
</th>
<th style="text-align:left;">
Antialias
</th>
<th style="text-align:left;">
Commenti
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
png
</td>
<td style="text-align:left;">
Portable Network Graphics
</td>
<td style="text-align:left;">
.png
</td>
<td style="text-align:left;">
bitmap
</td>
<td style="text-align:left;">
sì
</td>
<td style="text-align:left;">
adatto a siti web, supporta trasparenze
</td>
</tr>
<tr>
<td style="text-align:left;">
jpeg
</td>
<td style="text-align:left;">
Joint Photographic Experts Group
</td>
<td style="text-align:left;">
.jpeg, .jpg
</td>
<td style="text-align:left;">
bitmap
</td>
<td style="text-align:left;">
sì
</td>
<td style="text-align:left;">
permette una compressione (lossy)
</td>
</tr>
<tr>
<td style="text-align:left;">
bmp
</td>
<td style="text-align:left;">
Bitmap
</td>
<td style="text-align:left;">
.bmp
</td>
<td style="text-align:left;">
bitmap
</td>
<td style="text-align:left;">
sì
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
tiff
</td>
<td style="text-align:left;">
Tagged Image Format
</td>
<td style="text-align:left;">
.tif, .tiff
</td>
<td style="text-align:left;">
bitmap
</td>
<td style="text-align:left;">
sì
</td>
<td style="text-align:left;">
consente diversi tipi di compressione
</td>
</tr>
<tr>
<td style="text-align:left;">
pdf
</td>
<td style="text-align:left;">
Portable Document Format
</td>
<td style="text-align:left;">
.pdf
</td>
<td style="text-align:left;">
vettoriale
</td>
<td style="text-align:left;">
no
</td>
<td style="text-align:left;">
flessibile, leggibile su tutti i device
</td>
</tr>
<tr>
<td style="text-align:left;">
svg
</td>
<td style="text-align:left;">
Scalable Vector Graphics
</td>
<td style="text-align:left;">
.svg
</td>
<td style="text-align:left;">
vettoriale
</td>
<td style="text-align:left;">
sì
</td>
<td style="text-align:left;">
addatto all’uso online
</td>
</tr>
</tbody>
</table>
<p>I formati <strong>vettoriali</strong> producono immagini che, in teoria, possono essere ingrandite a piacere, senza perdita di risoluzione e senza determinare una “scalettatura” delle linee. I formati <strong>bitmap</strong> registrano le immagini come un insieme di punti: per questa ragione la dimensione e la risoluzione sono essenziali nel determinare la massima dimensione alla quale un’immagine può essere riprodotta a video o in stampa senza perdite significative di qualità. Ingrandire un’immagine bitmap a bassa risoluzione o di piccole dimensioni (in cm o pollici/ inches, pixel) risulta in significative perdite di qualità: i singoli pixel diventano chiaramente visibili e le linee possono apparire come scalettate. La scalettatura può essere in parte attenuata dall’antialiasing. Naturalmente il prezzo dell’aumento della risoluzione o della dimensione fisica è l’aumento della dimensione del file. Quest’ultima può essere in parte controllata con la compressione (per i formati che la consentono): la compressione determina una perdita di qualità generalmente irreversibile, specialmente per le compressioni “lossy” usate per esempio dal formato <code>.jpeg</code>.<br />
E allora, quale formato è meglio utilizzare?</p>
<ul>
<li><p>ogni volta che è possibile è meglio usare i formati vettoriali (<code>.pdf</code> per le applicazioni generali, <code>.svg</code> per le applicazioni su web). Tuttavia, non tutte le riviste scientifiche accettano grafici in formato <code>.pdf</code> e la resa di questo formato non è necessariamente uguale su tutti i sistemi</p></li>
<li><p>per le altre applicazioni è meglio usare un formato bitmap, con una risoluzione sufficiente allo scopo:</p>
<ul>
<li><p><code>.png</code> è un formato particolarmente adatto alle pagine web, che produce file di piccole dimensioni</p></li>
<li><p><code>.bmp</code> è un formato ingombrante ma piuttosto fedele</p></li>
<li><p><code>.jpeg</code> è sicuramente il formato preferibile per immagini leggere, specialmente se con gradienti di colore, ma ha una compressione lossy</p></li>
<li><p><code>.tiff</code> un formato molto fedele ma ingombrante, che però permette una compressione; non tutte le codicieh di questo formato funzionano su tutti i sistemi operativi.</p></li>
</ul></li>
</ul>
<p>In generale, le riviste scientifiche richiedono una risoluzione di almeno 300 dpi (dot per inches) di dimensioni tali da occupare una o due colonne della “pagina” (ormai sempre più spesso virtuale, visto che quasi tutte le riviste sono on line). Per alcune applicazioni, e specialmente quando si usano gradienti di colore, potrebbe essere necessario usare una risoluzione di 600 dpi. I file prodotti dal formato preferito dalle riviste (.tif) possono essere veramente enormi (&gt;10 Mb). Per applicazioni che richiedono una visualizzazione su schermo o su pagina e per le quali non si prevede che l’utente debba ingrandire l’immagine una risoluzione di 150-220 dpi può essere sufficiente. La risoluzione dello schermo (tipicamente 72 o 96 dpi) è sufficiente solo per una visualizzazione grafica delle immagini.<br />
La figura <a href="grafica.html#fig:mpgcolore">6.5</a>, realizzata con <code>ggplot2</code> con il dataset <code>mpg</code> può essere utilizzata come esempio per valutare l’effetto del tipo di formato o della compressione.</p>
<hr />
<div class="sourceCode" id="cb594"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb594-1"><a href="grafica.html#cb594-1" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(class <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;compact&quot;</span>, <span class="st">&quot;suv&quot;</span>, <span class="st">&quot;midsize&quot;</span>, <span class="st">&quot;subcompact&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb594-2"><a href="grafica.html#cb594-2" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cty, <span class="at">y =</span> hwy)) <span class="sc">+</span></span>
<span id="cb594-3"><a href="grafica.html#cb594-3" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> F) <span class="sc">+</span></span>
<span id="cb594-4"><a href="grafica.html#cb594-4" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">shape =</span> class, <span class="at">color =</span> displ), <span class="at">size =</span> <span class="fu">I</span>(<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb594-5"><a href="grafica.html#cb594-5" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Consumo di carburante per 32 modelli di auto&quot;</span>,</span>
<span id="cb594-6"><a href="grafica.html#cb594-6" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;anni 1999 - 2008&quot;</span>,</span>
<span id="cb594-7"><a href="grafica.html#cb594-7" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;miglia per gallone in città&quot;</span>,</span>
<span id="cb594-8"><a href="grafica.html#cb594-8" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;miglia per gallone in autostrada&quot;</span>,</span>
<span id="cb594-9"><a href="grafica.html#cb594-9" tabindex="-1"></a>       <span class="at">shape =</span> <span class="st">&quot;categoria&quot;</span>,</span>
<span id="cb594-10"><a href="grafica.html#cb594-10" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">&quot;cilindrata, L&quot;</span>,</span>
<span id="cb594-11"><a href="grafica.html#cb594-11" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">&quot;Fonte: EPA, https://fueleconomy.gov/&quot;</span></span>
<span id="cb594-12"><a href="grafica.html#cb594-12" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb594-13"><a href="grafica.html#cb594-13" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">16</span>,<span class="dv">17</span>,<span class="dv">15</span>,<span class="dv">18</span>)) <span class="sc">+</span></span>
<span id="cb594-14"><a href="grafica.html#cb594-14" tabindex="-1"></a>  <span class="fu">scale_colour_continuous</span>(<span class="at">type =</span> <span class="st">&quot;viridis&quot;</span>) <span class="sc">+</span></span>
<span id="cb594-15"><a href="grafica.html#cb594-15" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb594-16"><a href="grafica.html#cb594-16" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb594-17"><a href="grafica.html#cb594-17" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:mpgcolore"></span>
<img src="_main_files/figure-html/mpgcolore-1.png" alt="Un grafico a dispersione, con annotazioni, realizzato con `ggplot2`." width="1050" />
<p class="caption">
Figura 6.5: Un grafico a dispersione, con annotazioni, realizzato con <code>ggplot2</code>.
</p>
</div>
<hr />
<p>Nota come <code>I(2)</code> serva a assegnare uno degli elementi estetici ad un valore fisso (in questo caso la dimensione del simbolo) piuttosto che ad una delle variabili.<br />
Ora prova a copiare e incollare il seguente codice in un nuovo script e ad eseguirlo. Come risultato:</p>
<ul>
<li><p>prima creiamo il grafico e lo assegniamo ad un oggetto</p></li>
<li><p>poi mandiamo il grafico al device corrente</p></li>
<li><p>poi lo mandiamo ad un file .pdf (nella working directory), usando le opzioni di default</p></li>
</ul>
<pre><code># qual&#39;è il device attivo?
dev.cur()
# creiamo il plot e assegnamolo ad un oggetto
mpg_plot &lt;- mpg %&gt;% dplyr::filter(class %in% c(&quot;compact&quot;, &quot;suv&quot;, &quot;midsize&quot;, &quot;subcompact&quot;)) %&gt;%
  ggplot(mapping = aes(x = cty, y = hwy)) +
  geom_smooth(se = F) +
  geom_point(mapping = aes(shape = class, color = displ), size = I(2)) +
  labs(title = &quot;Consumo di carburante per 32 modelli di auto&quot;,
       subtitle = &quot;anni 1999 - 2008&quot;,
       x = &quot;miglia per gallone in città&quot;,
       y = &quot;miglia per gallone in autostrada&quot;,
       shape = &quot;categoria&quot;,
       color = &quot;cilindrata, L&quot;,
       caption = &quot;Fonte: EPA, https://fueleconomy.gov/&quot;
  ) +
  scale_shape_manual(values = c(16,17,15,18)) +
  scale_colour_continuous(type = &quot;viridis&quot;) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))
# inviamo il plot al device di default, il plot pane
mpg_plot
# ora inviamo ad un device pdf, con le opzioni di default
?pdf
# ATTENZIONE IL FILE PDF VIENE SALVATO CORRETTAMENTE SOLO SE VENGONO ESEGUITI 
# ENTRAMBI I COMANDI SUCCESSIVI
pdf(file = &quot;mpg_plot.pdf&quot;)
mpg_plot
# chiudiamo il device e restituisce l&#39;output al device di default (il plot pane)
dev.off()       

# ora apriamo un device png con le opzioni di default e una risoluzione di 72 dpi
?png
png(file = &quot;mpg_plot.png&quot;, width = 7, height = 5, res = 72, units = &quot;in&quot;)
# la lista dei device si ottiene con dev.list()
cat(&quot;the list of devices&quot;,&quot;\n&quot;, dev.list())
dev_list &lt;- dev.list() # è un vettore con nomi
dev_list
# salviamo il grafico come .png, 72 dpi, 7x5 pollici
mpg_plot
# chiudiamo il device (non è necessario)
dev.off()
# ora .jpeg a due diverse risoluzioni, stessa dimensione, con la compressione 
# di default (quality = 75)
jpeg(file = &quot;mpg_plot_150.jpg&quot;, res = 150, width = 7, height = 5, units = &quot;in&quot;)
mpg_plot
dev.off()
jpeg(file = &quot;mpg_plot_300.jpg&quot;, res = 300, width = 7, height = 5, units = &quot;in&quot;)
mpg_plot
dev.off()
# ora .tiff, non compresso, stessa dimensione
tiff(file = &quot;mpg_plot_300.tiff&quot;, res = 300, width = 7, height = 5, units = &quot;in&quot;)
mpg_plot
dev.off()</code></pre>
<p>Prova a verificare la dimensione dei diversi file, ad aprirli con la tua applicazione di default per la grafica e a zoommare: cosa succede ai colori? ai punti? alle linee?</p>
</div>
<div id="ggsave" class="section level3 hasAnchor" number="6.4.2">
<h3><span class="header-section-number">6.4.2</span> Salvare i grafici di <code>ggplot2</code> con <code>ggsave</code>.<a href="grafica.html#ggsave" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>I device funzionano con tutti i sistemi grafici, compreso <code>ggplot2</code>, che però mette a disposizione un sistema molto più semplice per salvare i grafici, il comando <code>ggsave()</code>.
Prova ad eseguire questi comandi in uno script o nella console (è necessario aver creato l’oggetto grafico <code>mpg_plot</code>).</p>
<pre><code># l&#39;aiuto su ggsave
?ggsave
ggsave(mpg_plot, filename = &quot;mpg_plot_150.tiff&quot;, dpi = 150)</code></pre>
<p><code>ggsave()</code> usa defualt intelligenti: determina il device dall’estensione del file e, se non si indica alcun oggetto da salvare, salva l’ultimo disponibile.</p>
</div>
<div id="le-dimensioni-del-device-e-le-opzioni-grafiche." class="section level3 hasAnchor" number="6.4.3">
<h3><span class="header-section-number">6.4.3</span> <em>Le dimensioni del device e le opzioni grafiche.</em><a href="grafica.html#le-dimensioni-del-device-e-le-opzioni-grafiche." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Il device deve avere spazio sufficiente ad “accogliere” il grafico e tutti i suoi elementi (titoli, titoli degli assi, legende). Mentre il <code>plot pane</code> di RStudio viene ridimensionato dinamicamente e può essere ingrandito a piacere dall’utente, lo stesso non vale per i device bitmap. Prova a vedere cosa succede con questi comandi:</p>
<pre><code>jpeg(file = &quot;mpg_plot_150_480.jpg&quot;, res = 150)
mpg_plot
dev.off()</code></pre>
<p>A causa della maggiore risoluzione gli elementi del grafico non “entrano” nello spazio disponibile (480x480 pixel).</p>
<p>Un altro aspetto interessante è la personalizzazione delle diverse aree del device usando i parametri grafici.<br />
Una trattazione estesa di questo argomento va decisamente al di là degli obiettivi di pigR<a href="#fn135" class="footnote-ref" id="fnref135"><sup>135</sup></a>. In breve:</p>
<ul>
<li><p>la dimensione del device può essere verificata usando <code>dev.size()</code><a href="#fn136" class="footnote-ref" id="fnref136"><sup>136</sup></a></p></li>
<li><p>il device è diviso in due aree principali:</p>
<ul>
<li><p>i margini, che ospitano gli assi e le loro etichette e i titoli e possono essere fissati, in pollici con il comando <code>par(mai = c(0.1,0.1,0.1,0.1))</code>; i 4 numeri sono, in senso orario i margini inferiore, sinistro, superiore e destro; <code>mar</code> permette di fissare i margini in linee (lo spazio che ospita una linea o una colonna di testo)</p></li>
<li><p>l’area del grafico, che può essere fissata, fra le altre cose fissando la dimensione per la larghezza e altezza in pollici: <code>par(pin = c(6.5,4.5))</code> dà un’area grafica di 6,5 x 4,5 pollici</p></li>
</ul></li>
</ul>
<p>In realtà, è possibile operare in maniera molto più fine e persino dividere il device in aree (anche di divese dimensioni). La figura <a href="grafica.html#fig:splittingdevices">6.6</a> fornisce un esempio di come il device possa essere diviso in due (1 riga, due colonne) per ospitare due grafici diversi.</p>
<hr />
<div class="sourceCode" id="cb598"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb598-1"><a href="grafica.html#cb598-1" tabindex="-1"></a><span class="co"># salva i parametri grafici correnti per poterli resettare facilmente</span></span>
<span id="cb598-2"><a href="grafica.html#cb598-2" tabindex="-1"></a>opar <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="at">no.readonly =</span> T)</span>
<span id="cb598-3"><a href="grafica.html#cb598-3" tabindex="-1"></a><span class="co"># dividi il device in una riga con due colonne e riempi per righe </span></span>
<span id="cb598-4"><a href="grafica.html#cb598-4" tabindex="-1"></a><span class="co"># (prima la prima colonna e poi la seconda)</span></span>
<span id="cb598-5"><a href="grafica.html#cb598-5" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb598-6"><a href="grafica.html#cb598-6" tabindex="-1"></a><span class="co"># un grafico a dispersione</span></span>
<span id="cb598-7"><a href="grafica.html#cb598-7" tabindex="-1"></a><span class="fu">plot</span>(hwy <span class="sc">~</span> cty, <span class="at">data =</span> mpg)</span>
<span id="cb598-8"><a href="grafica.html#cb598-8" tabindex="-1"></a><span class="co"># un grafico a barre</span></span>
<span id="cb598-9"><a href="grafica.html#cb598-9" tabindex="-1"></a><span class="fu">barplot</span>(<span class="fu">xtabs</span>(<span class="sc">~</span> class, <span class="at">data =</span> mpg), <span class="at">las =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:splittingdevices"></span>
<img src="_main_files/figure-html/splittingdevices-1.png" alt="Dividere i devices." width="1050" />
<p class="caption">
Figura 6.6: Dividere i devices.
</p>
</div>
<div class="sourceCode" id="cb599"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb599-1"><a href="grafica.html#cb599-1" tabindex="-1"></a><span class="co"># resetta il device</span></span>
<span id="cb599-2"><a href="grafica.html#cb599-2" tabindex="-1"></a><span class="fu">par</span>(opar)</span></code></pre></div>
<hr />
<p>Questo sistema permette una grande flessibilità nella divisione dell’area grafica ma richiede una buona conoscenza di tutti i parametri grafici. Ovviamente, come vedremo dopo, in R c’è sempre un sistema più semplice: il pacchetto <a href="https://cran.r-project.org/web/packages/cowplot/vignettes/introduction.html"><code>cowplot</code></a>, per esempio, permette di combinare gli oggetti grafici prodotti con <code>ggplot2</code> con grande semplicità.</p>
</div>
</div>
<div id="r-a-colori." class="section level2 hasAnchor" number="6.5">
<h2><span class="header-section-number">6.5</span> R, a colori.<a href="grafica.html#r-a-colori." class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>L’uso del colore è critico per ottenere buone visualizzazioni di dati (leggi la sezione <a href="grafica.html#igraficifattibene">6.2</a> per qualche dettaglio in più) ed R fornisce, tramite il pacchetto <code>grDevices</code> e molti pacchetti aggiuntivi, moltissimi strumenti per gestire al meglio i colori.<br />
I colori possono essere utilizzati per:</p>
<ul>
<li><p>distinguere diverse categorie: in questo caso sono adatti a variabili qualitative e i colori della palette usati in un grafico dovrebbero essere ottimizzati per distinguere al meglio le diverse categorie (che, idealmente, dovrebbero essere non più di 12, meglio se meno di 7);</p></li>
<li><p>rappresentare valori quantitativi; in questo caso si possono usare due tipi di scale cromatiche, con colori che formano un gradiente:</p>
<ul>
<li><p>sequenziali: adatti a valori uniformemente crescenti o decrescenti;</p></li>
<li><p>divergenti: adatti a valori che divergono a partire da un valore centrale, tipicamente lo 0, come per esempio i valori di diversi indici di correlazione (che variano fra -1 e + 1)</p></li>
</ul></li>
</ul>
<p>In R i colori possono essere indicati con i loro nomi o mediante codici esadecimali che rappresentano i tre valori della scala RGB (rosso, verde, blu, ciascuno dei quali può variare da 0, assente, a 255, massima intensità). Una ottima cheatsheet sull’uso dei colori in R è disponibile <a href="https://www.nceas.ucsb.edu/sites/default/files/2020-04/colorPaletteCheatsheet.pdf">qui</a>.<br />
Per visualizzare i nomi dei colori prova questi comandi nella console:</p>
<pre><code># i primi 20 e gli ultimi 20 colori (cambia il codice per visualizzare un 
# elenco diverso dei 657 colori disponibili)
colors()[c((1:20), (length(colors())-20):length(colors()))]
# ottieni i nomi dei colori della palette in uso
# (quella di default all&#39;avvio di R, può essere cambiata)
palette()
?palette
# per saperne di più sulle palette di grDevices
?rainbow</code></pre>
<p>La Figura <a href="grafica.html#fig:pie1">6.7</a> mostra 6 palette sotto forma di diagrammi a torta.</p>
<hr />
<div class="sourceCode" id="cb601"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb601-1"><a href="grafica.html#cb601-1" tabindex="-1"></a>opar <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="at">no.readonly =</span> T)</span>
<span id="cb601-2"><a href="grafica.html#cb601-2" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>))</span>
<span id="cb601-3"><a href="grafica.html#cb601-3" tabindex="-1"></a><span class="co"># la palette di default</span></span>
<span id="cb601-4"><a href="grafica.html#cb601-4" tabindex="-1"></a><span class="fu">pie</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">length</span>(<span class="fu">palette</span>())), <span class="at">col =</span> <span class="fu">palette</span>(), <span class="at">labels =</span> <span class="fu">palette</span>(),</span>
<span id="cb601-5"><a href="grafica.html#cb601-5" tabindex="-1"></a>    <span class="at">main =</span> <span class="st">&quot;la palette di default&quot;</span>)</span>
<span id="cb601-6"><a href="grafica.html#cb601-6" tabindex="-1"></a></span>
<span id="cb601-7"><a href="grafica.html#cb601-7" tabindex="-1"></a><span class="co"># una palette arcobaleno a 6 colori</span></span>
<span id="cb601-8"><a href="grafica.html#cb601-8" tabindex="-1"></a><span class="fu">palette</span>(<span class="fu">rainbow</span>(<span class="dv">6</span>))</span>
<span id="cb601-9"><a href="grafica.html#cb601-9" tabindex="-1"></a>lamiapalette <span class="ot">&lt;-</span> <span class="fu">palette</span>()</span>
<span id="cb601-10"><a href="grafica.html#cb601-10" tabindex="-1"></a><span class="fu">pie</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">length</span>(lamiapalette)), <span class="at">col =</span> <span class="fu">palette</span>(), <span class="at">labels =</span> lamiapalette,</span>
<span id="cb601-11"><a href="grafica.html#cb601-11" tabindex="-1"></a>    <span class="at">main =</span> <span class="st">&quot;una palette arcobaleno&quot;</span>)</span>
<span id="cb601-12"><a href="grafica.html#cb601-12" tabindex="-1"></a></span>
<span id="cb601-13"><a href="grafica.html#cb601-13" tabindex="-1"></a><span class="co"># una palette di 20 colori a gradiente di calore</span></span>
<span id="cb601-14"><a href="grafica.html#cb601-14" tabindex="-1"></a><span class="fu">palette</span>(<span class="fu">heat.colors</span>(<span class="dv">20</span>))</span>
<span id="cb601-15"><a href="grafica.html#cb601-15" tabindex="-1"></a>lamiapalette <span class="ot">&lt;-</span> <span class="fu">palette</span>()</span>
<span id="cb601-16"><a href="grafica.html#cb601-16" tabindex="-1"></a><span class="fu">pie</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">length</span>(lamiapalette)), <span class="at">col =</span> <span class="fu">palette</span>(), <span class="at">labels =</span> lamiapalette,</span>
<span id="cb601-17"><a href="grafica.html#cb601-17" tabindex="-1"></a>    <span class="at">main =</span> <span class="st">&quot;una palette a gradiente di calore&quot;</span>)</span>
<span id="cb601-18"><a href="grafica.html#cb601-18" tabindex="-1"></a></span>
<span id="cb601-19"><a href="grafica.html#cb601-19" tabindex="-1"></a><span class="co"># una palette toporgrafica di 20 colori</span></span>
<span id="cb601-20"><a href="grafica.html#cb601-20" tabindex="-1"></a><span class="fu">palette</span>(<span class="fu">topo.colors</span>(<span class="dv">20</span>))</span>
<span id="cb601-21"><a href="grafica.html#cb601-21" tabindex="-1"></a>lamiapalette <span class="ot">&lt;-</span> <span class="fu">palette</span>()</span>
<span id="cb601-22"><a href="grafica.html#cb601-22" tabindex="-1"></a><span class="fu">pie</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">length</span>(lamiapalette)), <span class="at">col =</span> <span class="fu">palette</span>(), <span class="at">labels =</span> lamiapalette,</span>
<span id="cb601-23"><a href="grafica.html#cb601-23" tabindex="-1"></a>    <span class="at">main =</span> <span class="st">&quot;una palette topografica&quot;</span>)</span>
<span id="cb601-24"><a href="grafica.html#cb601-24" tabindex="-1"></a></span>
<span id="cb601-25"><a href="grafica.html#cb601-25" tabindex="-1"></a><span class="co"># colori adatti per mappe</span></span>
<span id="cb601-26"><a href="grafica.html#cb601-26" tabindex="-1"></a><span class="fu">palette</span>(<span class="fu">terrain.colors</span>(<span class="dv">20</span>))</span>
<span id="cb601-27"><a href="grafica.html#cb601-27" tabindex="-1"></a>lamiapalette <span class="ot">&lt;-</span> <span class="fu">palette</span>()</span>
<span id="cb601-28"><a href="grafica.html#cb601-28" tabindex="-1"></a><span class="fu">pie</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">length</span>(lamiapalette)), <span class="at">col =</span> <span class="fu">palette</span>(), <span class="at">labels =</span> lamiapalette,</span>
<span id="cb601-29"><a href="grafica.html#cb601-29" tabindex="-1"></a>    <span class="at">main =</span> <span class="st">&quot;una palette &#39;terreno&#39;&quot;</span>)</span>
<span id="cb601-30"><a href="grafica.html#cb601-30" tabindex="-1"></a></span>
<span id="cb601-31"><a href="grafica.html#cb601-31" tabindex="-1"></a><span class="co"># una palette ciano-magenta, adatta a daltonici</span></span>
<span id="cb601-32"><a href="grafica.html#cb601-32" tabindex="-1"></a><span class="fu">palette</span>(<span class="fu">cm.colors</span>(<span class="dv">20</span>))</span>
<span id="cb601-33"><a href="grafica.html#cb601-33" tabindex="-1"></a>lamiapalette <span class="ot">&lt;-</span> <span class="fu">palette</span>()</span>
<span id="cb601-34"><a href="grafica.html#cb601-34" tabindex="-1"></a><span class="fu">pie</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">length</span>(lamiapalette)), <span class="at">col =</span> <span class="fu">palette</span>(), <span class="at">labels =</span> lamiapalette,</span>
<span id="cb601-35"><a href="grafica.html#cb601-35" tabindex="-1"></a>    <span class="at">main =</span> <span class="st">&quot;una palette cyano-magenta&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:pie1"></span>
<img src="_main_files/figure-html/pie1-1.png" alt="Sei palette di R rappresentate come diagrammi a torta." width="1050" />
<p class="caption">
Figura 6.7: Sei palette di R rappresentate come diagrammi a torta.
</p>
</div>
<div class="sourceCode" id="cb602"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb602-1"><a href="grafica.html#cb602-1" tabindex="-1"></a><span class="co"># resetla palette</span></span>
<span id="cb602-2"><a href="grafica.html#cb602-2" tabindex="-1"></a><span class="fu">palette</span>(<span class="st">&quot;default&quot;</span>)</span>
<span id="cb602-3"><a href="grafica.html#cb602-3" tabindex="-1"></a><span class="co"># resetta i parametri grafici</span></span>
<span id="cb602-4"><a href="grafica.html#cb602-4" tabindex="-1"></a><span class="fu">par</span>(opar)</span></code></pre></div>
<hr />
<p>Prova ad eseguire lo stesso codice con palette diverse.</p>
<p><code>RColorBrewer</code> è un pacchetto che fornisce diverse palette ottimizzate per dati qualitativi e quantitativi (sequenziali o divergenti).
Per saperne di più scrivi nella console:</p>
<pre><code>?RColorBrewer</code></pre>
<p>RColorBrewer fornisce molte palette ben fatte, ottimizzate anche per i diversi tipi di daltonismo.</p>
<hr />
<div class="sourceCode" id="cb604"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb604-1"><a href="grafica.html#cb604-1" tabindex="-1"></a><span class="fu">display.brewer.all</span>(<span class="at">n=</span><span class="cn">NULL</span>, <span class="at">type=</span><span class="st">&quot;all&quot;</span>, <span class="at">select=</span><span class="cn">NULL</span>, <span class="at">exact.n=</span><span class="cn">TRUE</span>, </span>
<span id="cb604-2"><a href="grafica.html#cb604-2" tabindex="-1"></a><span class="at">colorblindFriendly=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:lepalettercolorbrewer"></span>
<img src="_main_files/figure-html/lepalettercolorbrewer-1.png" alt="Le palette di RColorBrewer." width="1050" />
<p class="caption">
Figura 6.8: Le palette di RColorBrewer.
</p>
</div>
<hr />
</div>
<div id="graficaggplot2" class="section level2 hasAnchor" number="6.6">
<h2><span class="header-section-number">6.6</span> La grammatica della grafica con ggplot2.<a href="grafica.html#graficaggplot2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><code>ggplot2</code> è sicuramente il sistema migliore, più flessibile e, probabilmente, più potente per produrre grafici scientifici in R. In più, il suo apprendimento è reso (relativamente) facile dall’organizzazione concettuale (creazione dei grafici in strati, usando i concetti della grammatica della grafica) e da un insieme di comandi dai nomi coerenti. Il materiale di riferimento per <code>ggplot2</code> è disponibile <a href="http://ggplot2.tidyverse.org/reference/">qui</a> e molti dei libri citati nella sezione <a href="grafica.html#altrerisgraf">6.10</a> descrivono principalmente o esclusivamente la grafica con <code>ggplot2</code>.<br />
La realizzazione di un grafico con <code>ggplot2</code> inizia sempre con il comando <code>ggplot</code> ed è seguita da uno o più strati, separati dal segno <code>+</code><a href="#fn137" class="footnote-ref" id="fnref137"><sup>137</sup></a>, che definiscono gli altri elementi del grafico. Il risultato è una lista, che può essere assegnata ad un nome. Se non lo si fa, il comando genera immediatamente il grafico nel <code>device</code> attivo (in RStudio il <code>plot pane</code>). Se il grafico viene assegnato ad un nome è possibile continuare a modificarlo, aggiungendo ulteriori strati. In entrambi i casi, è possibile salvare facilmente il grafico con <code>ggsave</code> (vai al paragrafo <a href="grafica.html#ggsave">6.4.2</a> per dettagli).<br />
La funzione <code>qplot</code>, che consentiva di produrre grafici molto rapidamente usando una sintassi vicina alla grafica di base, è ormai deprecata<a href="#fn138" class="footnote-ref" id="fnref138"><sup>138</sup></a>, anche se è ancora possibile usare questo <a href="https://ggplot2.tidyverse.org/reference/qplot.html">comando</a>; qualche elemento lo trovi nel paragrafo <a href="grafica.html#qplot">6.8.7</a>.<br />
La grammatica della grafica è una rappresentazione strutturata degli elementi che compongono un grafico (scientifico) e delle loro relazioni:</p>
<ul>
<li><p>i <strong>dati</strong>: devono essere necessariamente sotto forma di <code>data frame</code> o <code>tibble</code>, vedi sezione <a href="datioggetti.html#strutturedati">4.4</a>, e possono essere “passati” tramite una <code>pipe</code> (%&gt;%) o inseriti nella funzione <code>ggplot</code><a href="#fn139" class="footnote-ref" id="fnref139"><sup>139</sup></a>;</p></li>
<li><p>gli <strong>“estetici”</strong> (aesthetics in inglese) definiscono quali variabili dei dati verranno assegnate a posizioni in un sistema di coordinate (x, y), ad altri elementi quantitativi (dimensione, trasparenza), ad elementi qualitativi come la forma dei simboli o la tipologia delle linee, ad elementi qualitativi o quantitativi come il colore;</p></li>
<li><p>i <strong>“geomi”</strong> (geoms in inglese) definiscono in che modo uno o più estetici vengono rappresentati (come grafico a barre, a dispersione, etc.) in uno strato (layer in inglese); lo strato eredita gli estetici dalla funzione <code>ggplot</code> o da uno strato precedente e, in alcuni casi, può utilizzare una trasformazione statistica o un aggiustamento di posizione (disposizione di elementi diversi che altrimenti si sovrapporrebbero nel grafico);</p></li>
<li><p>le <strong>“annotazioni”</strong> (annotations in inglese) aggiungono uno strato con elementi fissi, come linee verticali, diagonali o orizzontali, mappe, etc.;</p></li>
<li><p>le <strong>“scale”</strong> (sia quelle quantitative che qualitative) possono essere generate automaticamente o personalizzate in maniera molto fine;</p></li>
<li><p>le <strong>“guide”</strong> di assi e legende servono al lettore ad interpretare correttamente un grafico; vengono generate automaticamente ma possono essere personalizzate in dettaglio (intervalli degli assi, trattini principali o secondari, etc.);</p></li>
<li><p>le <strong>“facet”</strong> servono per suddividere, sulla base di una o più variabili, il grafico in sub-grafici;</p></li>
<li><p>i <strong>“temi”</strong> (themes in inglese) consentono una personalizzazione molto fine di aspetti diversi del grafico (sfondo, colori delle guide, font, allineamento, etc.); esiste un gran numero di temi predefiniti e un certo numero di temi aggiuntivi forniti da pacchetti addizionali (come <code>ggthemes</code>).</p></li>
</ul>
<p>Descritto così, l’apprendimento di <code>ggplot2</code> sembra un’impresa disperata. In realtà, nella maggior parte dei casi è possibile produrre grafici piacevoli ed efficaci con un minimo di opzioni: i default di <code>ggplot2</code> sono “intelligenti” e spesso <code>ggplot2</code> impedisce attivamente di fare cose sbagliate dal punto di vista della presentazione scientifica di dati (come per esempio produrre diagrammi a torte).</p>
<p>La figura <a href="grafica.html#fig:mpgggplotaes">6.9</a> mostra un piccolo esempio che ci permette di individuare facilmente i diversi elementi.</p>
<hr />
<div class="sourceCode" id="cb605"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb605-1"><a href="grafica.html#cb605-1" tabindex="-1"></a><span class="co"># library(ggplot2)</span></span>
<span id="cb605-2"><a href="grafica.html#cb605-2" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span></span>
<span id="cb605-3"><a href="grafica.html#cb605-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(class <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;compact&quot;</span>, <span class="st">&quot;suv&quot;</span>, <span class="st">&quot;pickup&quot;</span>, <span class="st">&quot;subcompact&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb605-4"><a href="grafica.html#cb605-4" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> hwy)) <span class="sc">+</span></span>
<span id="cb605-5"><a href="grafica.html#cb605-5" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> F) <span class="sc">+</span></span>
<span id="cb605-6"><a href="grafica.html#cb605-6" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">formula =</span> y<span class="sc">~</span>x, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">se =</span> F) <span class="sc">+</span></span>
<span id="cb605-7"><a href="grafica.html#cb605-7" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">size =</span> cyl, <span class="at">shape =</span> class)) <span class="sc">+</span></span>
<span id="cb605-8"><a href="grafica.html#cb605-8" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb605-9"><a href="grafica.html#cb605-9" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Consumi in autostrada di alcuni modelli di autovetture, 1999 - 2008&quot;</span>,</span>
<span id="cb605-10"><a href="grafica.html#cb605-10" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;https://fueleconomy.gov/&quot;</span>,</span>
<span id="cb605-11"><a href="grafica.html#cb605-11" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;cilindrata, litri&quot;</span>,</span>
<span id="cb605-12"><a href="grafica.html#cb605-12" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;consumo in autostrada, km per gallone&quot;</span>,</span>
<span id="cb605-13"><a href="grafica.html#cb605-13" tabindex="-1"></a>    <span class="at">size =</span> <span class="st">&quot; n. cil.&quot;</span>,</span>
<span id="cb605-14"><a href="grafica.html#cb605-14" tabindex="-1"></a>    <span class="at">shape =</span> <span class="st">&quot;classe&quot;</span></span>
<span id="cb605-15"><a href="grafica.html#cb605-15" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb605-16"><a href="grafica.html#cb605-16" tabindex="-1"></a>  <span class="fu">scale_size</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">2.5</span>)) <span class="sc">+</span></span>
<span id="cb605-17"><a href="grafica.html#cb605-17" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span> (<span class="dv">1</span>,<span class="dv">7</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">7</span>), <span class="at">minor_breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">7</span>,<span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb605-18"><a href="grafica.html#cb605-18" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">50</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">10</span>,<span class="dv">50</span>,<span class="dv">10</span>), <span class="at">minor_breaks =</span> <span class="fu">seq</span>(<span class="dv">10</span>,<span class="dv">50</span>,<span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb605-19"><a href="grafica.html#cb605-19" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>( <span class="at">values =</span> <span class="fu">c</span>(<span class="dv">15</span>, <span class="dv">16</span>, <span class="dv">17</span>, <span class="dv">18</span>)) <span class="sc">+</span></span>
<span id="cb605-20"><a href="grafica.html#cb605-20" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:mpgggplotaes"></span>
<img src="_main_files/figure-html/mpgggplotaes-1.png" alt="Gli elementi della grammatica della grafica in un grafico generato da ggplot" width="1050" />
<p class="caption">
Figura 6.9: Gli elementi della grammatica della grafica in un grafico generato da ggplot
</p>
</div>
<hr />
<p>In questa figura:</p>
<ul>
<li><p>i <strong>dati</strong> sono forniti dal database <code>mpg</code> (filtrato), che viene “passato” al comando <code>ggplot()</code> con una pipe (<code>%&gt;%</code>)</p></li>
<li><p>gli <strong>estetici</strong> sono:</p>
<ul>
<li><p>x = displ, y = hwy (indicati nella funzione <code>ggplot</code> ed ereditati dagli strati successivi, rappresentano le coordinate nello spazio cartesiano)</p></li>
<li><p>size = cyl (influenza la dimensione dei punti)</p></li>
<li><p>shape = class (influenza il tipo di simbolo utilizzato)</p></li>
</ul></li>
<li><p>i <strong>geomi</strong> sono:</p>
<ul>
<li><p><code>geom_smooth</code> (passato due volte, con la creazione di uno strato con uno smoother non parametrico, in blu, e una regressione lineare, in rosso, con una linea tratteggiata)</p></li>
<li><p><code>geom_point</code> (che crea il grafico a dispersione)</p></li>
</ul></li>
<li><p>alcune etichette sono modificate rispetto ai default con il comando <code>labs</code></p></li>
<li><p>le scale sono modificate rispetto ai defaults con i comandi <code>scale_</code></p></li>
<li><p>il tema utilizzato è quello di default, con una piccola modifica (allineamento del titolo al centro) ottenuta con il comando <code>theme</code></p></li>
</ul>
<p><code>ggplot2</code> offre geomi adatti alla grande maggioranza dei grafici scientifici. In più, grafici più complessi e specializzati sono resi disponibili da altri pacchetti (le estensioni di <code>ggplot2</code>, vedi paragrafo <a href="grafica.html#estensionigg">6.8.6</a>). Imparare ad usarli tutti non è probabilmente necessario, anche se avere un’idea delle possibilità è utile e stimolante (vedi la sezione #ref(altrerisgraf)). Qui userò un approccio adatto a chi parte praticamente da 0, dividendo i comandi per generare grafici in due gruppi: quelli adatti alle sole variabili qualitative e quelli adatti alle variabili quantitative (se non ricordi cosa sono vai al paragrafo <a href="datioggetti.html#premessa2">4.1.2</a>). In realtà, nel secondo caso si finisce spesso per usare combinazioni dei due tipi di variabili. Per semplicità, trascurerò alcuni tipi di grafici importanti, che saranno presentati in altri capitoli di questo testo (o di testi successivi, non ho ancora deciso).</p>
</div>
<div id="grafqual" class="section level2 hasAnchor" number="6.7">
<h2><span class="header-section-number">6.7</span> Grafici per variabili qualitative.<a href="grafica.html#grafqual" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Le variabili qualitative, e in particolare le variabili qualitative nominali, possono assumere solo valori discreti: per questo è possibile solo classificare i valori nei diversi gruppi e contarli. Le variabili qualitative sono spesso usate per individuare gruppi e per questo sono molto utilizzate nei grafici per variabili quantitative (vedi sezione <a href="grafica.html#grafquant">6.8</a>). Di fatto, il tipo di grafico più comune per sole variabili qualitative è il grafico a barre<a href="#fn140" class="footnote-ref" id="fnref140"><sup>140</sup></a>.</p>
<div id="diagrammi-a-barre." class="section level3 hasAnchor" number="6.7.1">
<h3><span class="header-section-number">6.7.1</span> Diagrammi a barre.<a href="grafica.html#diagrammi-a-barre." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In un grafico a barre si rappresentano tipicamente le conte o le proporzioni dei diversi livelli di una o più variabili qualitative. Come esempio, userò in set di dati <code>Arthritis</code>, disponibile nel pacchetto <code>vcd</code>. E’ un set di dati molto semplice, relativo ad un esperimento in cui, a gruppi diversi di pazienti, vengono somministrati un farmaco per il trattamento dell’artrite reumatoide o un placebo. Il set di dati ha 3 variabili qualitative (o fattori, <code>Treatment</code>, <code>Sex</code>, <code>Improved</code>, vedi paragrafo <a href="datioggetti.html#premessa2">4.1.2</a>), una variabile quantitativa (<code>Age</code>) e un variabile (<code>ID</code>) che serve unicamente da identificativo del singolo paziente. Prima di procedere oltre, dovresti:</p>
<ul>
<li><p>leggere l’aiuto del set di dati (prova con <code>?Arthritis</code>)</p></li>
<li><p>esplorare brevemente il set di dati usando le funzioni e i menu di RStudio o i comandi illustrati nel capitolo <a href="datioggetti.html#datioggetti">4</a></p></li>
<li><p>cercare di capire cosa potrebbe essere interessante visualizzare in un grafico<a href="#fn141" class="footnote-ref" id="fnref141"><sup>141</sup></a></p></li>
</ul>
<p>Prima di tutto, creerò un nuovo set di dati, con alcune piccole modifiche:</p>
<div class="sourceCode" id="cb606"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb606-1"><a href="grafica.html#cb606-1" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;Arthritis&quot;</span>)</span>
<span id="cb606-2"><a href="grafica.html#cb606-2" tabindex="-1"></a></span>
<span id="cb606-3"><a href="grafica.html#cb606-3" tabindex="-1"></a><span class="co"># creo un fattore che divide in pazienti in tre gruppi usando la variabile Age, </span></span>
<span id="cb606-4"><a href="grafica.html#cb606-4" tabindex="-1"></a><span class="co"># usando cut()</span></span>
<span id="cb606-5"><a href="grafica.html#cb606-5" tabindex="-1"></a><span class="co"># i gruppi, arbitrariamente, sono con Age&lt;=22, 22&lt;Age≤40, 40&lt;Age≤59, Age&gt;59</span></span>
<span id="cb606-6"><a href="grafica.html#cb606-6" tabindex="-1"></a>Arthritis2 <span class="ot">&lt;-</span> Arthritis</span>
<span id="cb606-7"><a href="grafica.html#cb606-7" tabindex="-1"></a>Arthritis2<span class="sc">$</span>ageClass <span class="ot">&lt;-</span> <span class="fu">cut</span>(Arthritis2<span class="sc">$</span>Age, </span>
<span id="cb606-8"><a href="grafica.html#cb606-8" tabindex="-1"></a>                           <span class="fu">c</span>(<span class="dv">22</span>, <span class="dv">40</span>, <span class="dv">59</span>, <span class="fu">max</span>(Arthritis<span class="sc">$</span>Age)), </span>
<span id="cb606-9"><a href="grafica.html#cb606-9" tabindex="-1"></a>                           <span class="at">right =</span> T, </span>
<span id="cb606-10"><a href="grafica.html#cb606-10" tabindex="-1"></a>                           <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;young&quot;</span>,<span class="st">&quot;middle aged&quot;</span>, <span class="st">&quot;elder&quot;</span>))</span></code></pre></div>
<p>Qui e altrove, quando compare un comando che non conosci sarebbe prudente che tu ne leggessi, almeno superficialmente, l’aiuto. Non si sa mai, ti potrebbe essere utile in futuro…<br />
Ora creo un semplice grafico a barre impilate (le conte dei gruppi definiti dalla variabile assegnata a <code>fill</code> sono impilati), che mostra l’effetto del trattamento sui sintomi. Nota come i dati rappresentino le conte dei diversi gruppi o combinazioni di gruppi (<code>Treated</code> x <code>Improved</code>). Dietro le quinte, <code>geom_bar()</code> usa la trasformazione <code>stat_count()</code> che tabula i valori delle diverse combinazioni.</p>
<hr />
<div class="sourceCode" id="cb607"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb607-1"><a href="grafica.html#cb607-1" tabindex="-1"></a><span class="co"># prima di tutto, creo una lista che può essere facilmente riciclata e che </span></span>
<span id="cb607-2"><a href="grafica.html#cb607-2" tabindex="-1"></a><span class="co"># contiene i dati e solo un estetico, quello che andrà sull&#39;asse delle x </span></span>
<span id="cb607-3"><a href="grafica.html#cb607-3" tabindex="-1"></a></span>
<span id="cb607-4"><a href="grafica.html#cb607-4" tabindex="-1"></a>artbar1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> Arthritis2, <span class="fu">aes</span>(<span class="at">x=</span> Treatment))</span>
<span id="cb607-5"><a href="grafica.html#cb607-5" tabindex="-1"></a></span>
<span id="cb607-6"><a href="grafica.html#cb607-6" tabindex="-1"></a><span class="co"># aggiungo il secondo strato con in geoma gem_bar, in cui passo un ulteriore</span></span>
<span id="cb607-7"><a href="grafica.html#cb607-7" tabindex="-1"></a><span class="co"># estetico, Improved, che verrà mappato sul colore </span></span>
<span id="cb607-8"><a href="grafica.html#cb607-8" tabindex="-1"></a></span>
<span id="cb607-9"><a href="grafica.html#cb607-9" tabindex="-1"></a>artbar1 <span class="sc">+</span></span>
<span id="cb607-10"><a href="grafica.html#cb607-10" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> Improved))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:barchartminimo"></span>
<img src="_main_files/figure-html/barchartminimo-1.png" alt="Un grafico a barre minimo." width="1050" />
<p class="caption">
Figura 6.10: Un grafico a barre minimo.
</p>
</div>
<hr />
<p>Bene, semplice, no? La stessa cosa poteva essere realizzata con i seguenti comandi, che puoi copiare e incollare nella console:</p>
<pre><code>ggplot(data = Arthritis2, aes(x= Treatment, fill = Improved)) +
geom_bar()</code></pre>
<p>Nota come il secondo strato, quello del geoma, “eredita” gli estetici dallo strato precedente.<br />
Ora “migliorerò” un po’ il grafico, agendo su scale, colori, etichette, etc. Per farlo, parto comunque dal grafico creato in precedenza, che è nell’oggetto <code>artbar1</code>.</p>
<hr />
<div class="sourceCode" id="cb609"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb609-1"><a href="grafica.html#cb609-1" tabindex="-1"></a>artbar_semplice <span class="ot">&lt;-</span> artbar1 <span class="sc">+</span></span>
<span id="cb609-2"><a href="grafica.html#cb609-2" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> Improved))</span>
<span id="cb609-3"><a href="grafica.html#cb609-3" tabindex="-1"></a></span>
<span id="cb609-4"><a href="grafica.html#cb609-4" tabindex="-1"></a><span class="co"># uso il comando labs per cambiare l&#39;etichetta dell&#39;asse y,  aggiungere un </span></span>
<span id="cb609-5"><a href="grafica.html#cb609-5" tabindex="-1"></a><span class="co"># titolo, sottotitolo e una legenda</span></span>
<span id="cb609-6"><a href="grafica.html#cb609-6" tabindex="-1"></a>artbar_semplice <span class="ot">&lt;-</span> artbar_semplice <span class="sc">+</span></span>
<span id="cb609-7"><a href="grafica.html#cb609-7" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Numero di pazienti&quot;</span>,</span>
<span id="cb609-8"><a href="grafica.html#cb609-8" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Effetto del farmaco x sui sintomi dell&#39;artrite reumatoide&quot;</span>,</span>
<span id="cb609-9"><a href="grafica.html#cb609-9" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Un esperimento randomizzato, con placebo e doppio cieco&quot;</span>,</span>
<span id="cb609-10"><a href="grafica.html#cb609-10" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">&quot;Koch &amp; Edwards, 1988&quot;</span>)</span>
<span id="cb609-11"><a href="grafica.html#cb609-11" tabindex="-1"></a></span>
<span id="cb609-12"><a href="grafica.html#cb609-12" tabindex="-1"></a><span class="co"># cambio le scale, per usare termini in Italiano, aggiungere dei trattini </span></span>
<span id="cb609-13"><a href="grafica.html#cb609-13" tabindex="-1"></a><span class="co"># diversi per l&#39;asse y e cambiare la palette dei colori</span></span>
<span id="cb609-14"><a href="grafica.html#cb609-14" tabindex="-1"></a>artbar_semplice <span class="ot">&lt;-</span> artbar_semplice <span class="sc">+</span></span>
<span id="cb609-15"><a href="grafica.html#cb609-15" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="st">&quot;Trattamento&quot;</span>, </span>
<span id="cb609-16"><a href="grafica.html#cb609-16" tabindex="-1"></a>                   <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Placebo&quot;</span> <span class="ot">=</span> <span class="st">&quot;Placebo&quot;</span>, <span class="st">&quot;Treated&quot;</span> <span class="ot">=</span> <span class="st">&quot;Farmaco x&quot;</span>)) <span class="sc">+</span></span>
<span id="cb609-17"><a href="grafica.html#cb609-17" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">50</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">50</span>,<span class="dv">10</span>), </span>
<span id="cb609-18"><a href="grafica.html#cb609-18" tabindex="-1"></a>                     <span class="at">minor_breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">50</span>,<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb609-19"><a href="grafica.html#cb609-19" tabindex="-1"></a>    <span class="fu">scale_fill_brewer</span>(<span class="st">&quot;Miglioramenti&quot;</span>, </span>
<span id="cb609-20"><a href="grafica.html#cb609-20" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;None&quot;</span> <span class="ot">=</span> <span class="st">&quot;0&quot;</span>,<span class="st">&quot;Some&quot;</span><span class="ot">=</span><span class="st">&quot;+&quot;</span>, <span class="st">&quot;Marked&quot;</span> <span class="ot">=</span> <span class="st">&quot;+++&quot;</span>), </span>
<span id="cb609-21"><a href="grafica.html#cb609-21" tabindex="-1"></a>                    <span class="at">type =</span> <span class="st">&quot;qual&quot;</span>, <span class="at">palette =</span> <span class="st">&quot;Paired&quot;</span>)</span>
<span id="cb609-22"><a href="grafica.html#cb609-22" tabindex="-1"></a><span class="co"># cambio il tema, e centro i titoli, cambiandone font e dimensione</span></span>
<span id="cb609-23"><a href="grafica.html#cb609-23" tabindex="-1"></a>artbar_semplice <span class="ot">&lt;-</span> artbar_semplice <span class="sc">+</span></span>
<span id="cb609-24"><a href="grafica.html#cb609-24" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb609-25"><a href="grafica.html#cb609-25" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>), </span>
<span id="cb609-26"><a href="grafica.html#cb609-26" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">&quot;italic&quot;</span>, <span class="at">size =</span> <span class="dv">12</span>))</span>
<span id="cb609-27"><a href="grafica.html#cb609-27" tabindex="-1"></a></span>
<span id="cb609-28"><a href="grafica.html#cb609-28" tabindex="-1"></a>artbar_semplice</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:barchartsemplice"></span>
<img src="_main_files/figure-html/barchartsemplice-1.png" alt="Un grafico a barre semplice." width="1050" />
<p class="caption">
Figura 6.11: Un grafico a barre semplice.
</p>
</div>
<hr />
<p>Nota come:</p>
<ul>
<li><p>avrei potuto produrre il grafico aggiungendo i vari strati in un solo comando multilinea, oppure tenere uno strato di base, con gli elementi minimi cui aggiungere le personalizzazioni</p></li>
<li><p>tutti gli elementi passati ai comandi <code>labs</code> e <code>scale</code> potevano essere definiti “esternamente” al comando, p.es. usando dei vettori con (nell’opzione labels di <code>scale_x_discrete</code>) o senza nomi (negli altri casi); ciascuno di questi elementi poteva essere persino il risultato di una funzione</p></li>
<li><p>benché si possa personalizzare praticamente tutto, con pochissimi comandi è possibile usare un grafico accettabile e gradevole</p></li>
</ul>
<p>Prova tu stess*!</p>
<p>Ora, consentimi una piccola digressione. Dirai tu, se posso ottenere un buon risultato con pochi comandi o, meglio ancora, usando un software con un’interfaccia “punta e clicca”, perché devo fare tutta questa fatica ad imparare ad usare R e <code>ggplot2</code>? È un’ottima domanda, ma ti consiglio di rileggere bene l’introduzione a questo testo (capitolo <a href="intro.html#intro">1</a>). Inoltre, i grafici realizzati con R hanno due caratteristiche fondamentali per la scienza moderna: la trasparenza (è sempre molto chiaro cosa hai fatto per ottenere un grafico) e la riproducibilità (chiunque, anche su un’altra piattaforma, può riprodurre esattamente lo stesso grafico). Infine (e questo credo sia un buon argomento), se un revisore maligno ti chiede di modificare un grafico è molto più facile farlo se lo hai realizzato con R.</p>
<p>Per cambiare la disposizione del grafico a barre è possibile usare l’argomento <code>position</code> in geom_bar: Nella figura <a href="grafica.html#fig:posizionebarplot">6.12</a> ho usato i tre possibili valori:</p>
<ul>
<li><p><code>stack</code>, il default, produce diagrammi a barre impilate: hanno il vantaggio di permettere di confrontare facilmente i valori delle categorie definite dalla variabile cui è stato attribuito il riempimento (<code>fill</code>)<a href="#fn142" class="footnote-ref" id="fnref142"><sup>142</sup></a> come <code>aesthetic</code>, ma, quando la conta dei valori per le categorie definite dall’asse delle x è molto diversa diventa difficile confrontare l’effetto della variabile assegnata all’asse delle x su quella assegnata al <code>fill</code></p></li>
<li><p><code>dodge</code>: produce diagrammi a barre affiancate: anche in questo caso, mentre è facile il confronto delle diverse categorie all’interno di uno stesso gruppo definito da un valore sull’asse delle x, non è altrettanto facile confrontare l’effetto della variabile sull’asse delle x sulla distribuzione della variabile assegnata al riempimento; rispetto a <code>stack</code> è possinbile ottenere con maggiore precisione i singoli valori per le diverse categorie definite dal <code>fill</code>;</p></li>
<li><p><code>fill</code>: come <code>stack</code>, ma i valori della variabile assegnata al riempimento sono visualizzati come proporzioni (tutte le barre hanno altezza uguale e, se non lo si aggiunge come etichetta, è impossibile conoscere il valore della conta per ogni dato valore di x); utile quando l’enfasi è sul confronto di proporzioni;</p></li>
</ul>
<p>Nota inoltre come questa figura sia in realtà costruita affiancando 3 diversi elementi grafici usando la funzione <code>plot_grid()</code> del pacchetto <code>cowplot</code><a href="#fn143" class="footnote-ref" id="fnref143"><sup>143</sup></a>. Questo è molto diverso dal creare pannelli in un grafico usando un’altra variabile, come vedremo dopo per l’uso di <code>facet_wrap</code> e <code>facet_grid</code>. Inoltre, in tutti e tre i grafici la legenda è stata spostata sul fondo del grafico. Prova a esplorare altre posizioni della legenda. Nota anche come la legenda sia stata soppressa in due grafici e personalizzata in quello centrale.</p>
<hr />
<div class="sourceCode" id="cb610"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb610-1"><a href="grafica.html#cb610-1" tabindex="-1"></a>barre_impilate <span class="ot">&lt;-</span> artbar1 <span class="sc">+</span></span>
<span id="cb610-2"><a href="grafica.html#cb610-2" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> Improved)) <span class="sc">+</span></span>
<span id="cb610-3"><a href="grafica.html#cb610-3" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Numero di pazienti&quot;</span>) <span class="sc">+</span></span>
<span id="cb610-4"><a href="grafica.html#cb610-4" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="st">&quot;Trattamento&quot;</span>, </span>
<span id="cb610-5"><a href="grafica.html#cb610-5" tabindex="-1"></a>                   <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Placebo&quot;</span> <span class="ot">=</span> <span class="st">&quot;Placebo&quot;</span>, <span class="st">&quot;Treated&quot;</span> <span class="ot">=</span> <span class="st">&quot;Farmaco x&quot;</span>)) <span class="sc">+</span></span>
<span id="cb610-6"><a href="grafica.html#cb610-6" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="st">&quot;Miglioramenti&quot;</span>, </span>
<span id="cb610-7"><a href="grafica.html#cb610-7" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;None&quot;</span> <span class="ot">=</span> <span class="st">&quot;0&quot;</span>,<span class="st">&quot;Some&quot;</span><span class="ot">=</span><span class="st">&quot;+&quot;</span>, <span class="st">&quot;Marked&quot;</span> <span class="ot">=</span> <span class="st">&quot;+++&quot;</span>), </span>
<span id="cb610-8"><a href="grafica.html#cb610-8" tabindex="-1"></a>                    <span class="at">type =</span> <span class="st">&quot;qual&quot;</span>, <span class="at">palette =</span> <span class="st">&quot;Paired&quot;</span>) <span class="sc">+</span></span>
<span id="cb610-9"><a href="grafica.html#cb610-9" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>), </span>
<span id="cb610-10"><a href="grafica.html#cb610-10" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">&quot;italic&quot;</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb610-11"><a href="grafica.html#cb610-11" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb610-12"><a href="grafica.html#cb610-12" tabindex="-1"></a>barre_raggruppate <span class="ot">&lt;-</span> artbar1 <span class="sc">+</span></span>
<span id="cb610-13"><a href="grafica.html#cb610-13" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> Improved), <span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>) <span class="sc">+</span></span>
<span id="cb610-14"><a href="grafica.html#cb610-14" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Numero di pazienti&quot;</span>) <span class="sc">+</span></span>
<span id="cb610-15"><a href="grafica.html#cb610-15" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="st">&quot;Trattamento&quot;</span>, </span>
<span id="cb610-16"><a href="grafica.html#cb610-16" tabindex="-1"></a>                   <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Placebo&quot;</span> <span class="ot">=</span> <span class="st">&quot;Placebo&quot;</span>, <span class="st">&quot;Treated&quot;</span> <span class="ot">=</span> <span class="st">&quot;Farmaco x&quot;</span>)) <span class="sc">+</span></span>
<span id="cb610-17"><a href="grafica.html#cb610-17" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="st">&quot;Miglioramenti&quot;</span>, </span>
<span id="cb610-18"><a href="grafica.html#cb610-18" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;None&quot;</span> <span class="ot">=</span> <span class="st">&quot;0&quot;</span>,<span class="st">&quot;Some&quot;</span><span class="ot">=</span><span class="st">&quot;+&quot;</span>, <span class="st">&quot;Marked&quot;</span> <span class="ot">=</span> <span class="st">&quot;+++&quot;</span>), </span>
<span id="cb610-19"><a href="grafica.html#cb610-19" tabindex="-1"></a>                    <span class="at">type =</span> <span class="st">&quot;qual&quot;</span>, <span class="at">palette =</span> <span class="st">&quot;Paired&quot;</span>) <span class="sc">+</span></span>
<span id="cb610-20"><a href="grafica.html#cb610-20" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>), </span>
<span id="cb610-21"><a href="grafica.html#cb610-21" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">&quot;italic&quot;</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb610-22"><a href="grafica.html#cb610-22" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.50</span>,<span class="fl">0.85</span>), <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>))</span>
<span id="cb610-23"><a href="grafica.html#cb610-23" tabindex="-1"></a>barre_proporzioni <span class="ot">&lt;-</span> artbar1 <span class="sc">+</span></span>
<span id="cb610-24"><a href="grafica.html#cb610-24" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> Improved), <span class="at">position =</span> <span class="st">&quot;fill&quot;</span>) <span class="sc">+</span></span>
<span id="cb610-25"><a href="grafica.html#cb610-25" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Frazione dei pazienti&quot;</span>) <span class="sc">+</span></span>
<span id="cb610-26"><a href="grafica.html#cb610-26" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="st">&quot;Trattamento&quot;</span>, </span>
<span id="cb610-27"><a href="grafica.html#cb610-27" tabindex="-1"></a>                   <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Placebo&quot;</span> <span class="ot">=</span> <span class="st">&quot;Placebo&quot;</span>, <span class="st">&quot;Treated&quot;</span> <span class="ot">=</span> <span class="st">&quot;Farmaco x&quot;</span>)) <span class="sc">+</span></span>
<span id="cb610-28"><a href="grafica.html#cb610-28" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="st">&quot;Miglioramenti&quot;</span>, </span>
<span id="cb610-29"><a href="grafica.html#cb610-29" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;None&quot;</span> <span class="ot">=</span> <span class="st">&quot;0&quot;</span>,<span class="st">&quot;Some&quot;</span><span class="ot">=</span><span class="st">&quot;+&quot;</span>, <span class="st">&quot;Marked&quot;</span> <span class="ot">=</span> <span class="st">&quot;+++&quot;</span>), </span>
<span id="cb610-30"><a href="grafica.html#cb610-30" tabindex="-1"></a>                    <span class="at">type =</span> <span class="st">&quot;qual&quot;</span>, <span class="at">palette =</span> <span class="st">&quot;Paired&quot;</span>) <span class="sc">+</span></span>
<span id="cb610-31"><a href="grafica.html#cb610-31" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>), </span>
<span id="cb610-32"><a href="grafica.html#cb610-32" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">&quot;italic&quot;</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb610-33"><a href="grafica.html#cb610-33" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb610-34"><a href="grafica.html#cb610-34" tabindex="-1"></a><span class="fu">plot_grid</span>(barre_impilate, barre_raggruppate, barre_proporzioni, </span>
<span id="cb610-35"><a href="grafica.html#cb610-35" tabindex="-1"></a>          <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>),</span>
<span id="cb610-36"><a href="grafica.html#cb610-36" tabindex="-1"></a>          <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">nrow =</span> <span class="dv">1</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:posizionebarplot"></span>
<img src="_main_files/figure-html/posizionebarplot-1.png" alt="L'uso dell'argomento _position_ nei diagrammi a barre." width="1050" />
<p class="caption">
Figura 6.12: L’uso dell’argomento <em>position</em> nei diagrammi a barre.
</p>
</div>
<hr />
<p>In tutti e tre i grafici è evidente come l’uso del farmaco x, rispetto al placebo, incrementi il numero dei casi con un marcato miglioramento dei sintomi e diminuisca il numero dei casi con sintomi gravi, anche se questo effetto è molto più evidente nel grafico C, dove l’altezza delle colonne è standardizzata.
Nota come il codice sia molto verboso (moltissime linee di codice per ottenere il grafico desiderato) e come i grafici B e C siano stati ottenuti, di fatto, facendo un copia e incolla del codice del primo grafico e modificando due elementi (l’argomento <code>position</code> di <code>geom_bar</code> e la legenda dell’asse delle y). Questa pratica, oltre che essere inelegante, è soggetta ad errore. Una soluzione più elegante è definire una funzione (vedi capitolo <a href="datioggetti.html#datioggetti">4</a>, paragrafo <a href="datioggetti.html#userdeffunc">4.10.4</a>).<br />
Prova tu stesso con il codice che segue: è sufficiente cambiare gli argomenti <code>bpos</code>, <code>yl</code> e <code>lpos</code> della funzione per ottenere l’effetto desiderato:</p>
<pre><code>Genera_bar_plot &lt;- function(bpos = &quot;stack&quot;, 
                            yl = &quot;Numero di pazienti&quot;, 
                            lpos = &quot;right&quot;){
  artbar1 +
    geom_bar(mapping = aes(fill = Improved), position = bpos) +
    labs(y = yl) +
    scale_x_discrete(&quot;Trattamento&quot;, 
                     labels = c(&quot;Placebo&quot; = &quot;Placebo&quot;, &quot;Treated&quot; = &quot;Farmaco x&quot;)) +
    scale_fill_brewer(&quot;Miglioramenti&quot;, 
                      labels = c(&quot;None&quot; = &quot;0&quot;,&quot;Some&quot;=&quot;+&quot;, &quot;Marked&quot; = &quot;+++&quot;), 
                      type = &quot;qual&quot;, palette = &quot;Paired&quot;) +
    theme(plot.title = element_text(hjust = 0.5, face = &quot;bold&quot;), 
          plot.subtitle = element_text(hjust = 0.5, face = &quot;italic&quot;, size = 12),
          legend.position = lpos)
}
# cambia gli argomenti della funzione fra parentesi; 
# yl può essere qualsiasi testo, 
# bpos può essere &quot;stack&quot;, &quot;dodge&quot; o &quot;fill&quot;
# lpos può essere &quot;bottom&quot;, &quot;top&quot;, &quot;right&quot;, &quot;left&quot; 
# o un vettore numerico di lunghezza 2
# che definisce la posizione della legenda
# qui vengono usati gli argomenti di default
il_mio_bar_plot &lt;- Genera_bar_plot()
il_mio_bar_plot
# qui invece viene generato l&#39;equivalente del grafico C nella figura precedente,
il_mio_bar_plot &lt;- Genera_bar_plot(bpos = &quot;fill&quot;, 
                                   yl = &quot;frazione dei pazienti&quot;, 
                                   lpos = &quot;bottom&quot;)
il_mio_bar_plot</code></pre>
<p>Dividere i grafici in subplot usando un’ulteriore variabile qualitativa può essere utile. Nella Figura <a href="grafica.html#fig:barefacet">6.13</a> è possibile apprezzare come pazienti di sesso femminile o maschile reagiscano diversamente al trattamento farmacologico.<br />
Il grafico include anche le seguenti personalizzazioni:</p>
<ul>
<li><p>le etichette dei pannelli, che dovrebbero corrispondere ai livelli della variabile <code>Sex</code> sono state cambiate;</p></li>
<li><p>il numero totale di casi per ciascuna barra impilata a proporzioni è stato aggiunto con <code>geom_text</code></p></li>
</ul>
<hr />
<div class="sourceCode" id="cb612"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb612-1"><a href="grafica.html#cb612-1" tabindex="-1"></a>i_nomi_dei_sessi <span class="ot">&lt;-</span> <span class="fu">as_labeller</span>(</span>
<span id="cb612-2"><a href="grafica.html#cb612-2" tabindex="-1"></a>     <span class="fu">c</span>(<span class="st">&quot;Female&quot;</span> <span class="ot">=</span> <span class="st">&quot;Femmine&quot;</span>, <span class="st">&quot;Male&quot;</span> <span class="ot">=</span> <span class="st">&quot;Maschi&quot;</span>))</span>
<span id="cb612-3"><a href="grafica.html#cb612-3" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> Arthritis2, <span class="fu">aes</span>(<span class="at">x=</span> Treatment)) <span class="sc">+</span></span>
<span id="cb612-4"><a href="grafica.html#cb612-4" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> Improved), <span class="at">position =</span> <span class="st">&quot;fill&quot;</span>) <span class="sc">+</span></span>
<span id="cb612-5"><a href="grafica.html#cb612-5" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">after_stat</span>(count)), <span class="at">stat =</span> <span class="st">&quot;count&quot;</span>, </span>
<span id="cb612-6"><a href="grafica.html#cb612-6" tabindex="-1"></a>            <span class="at">position =</span> <span class="st">&quot;fill&quot;</span>, <span class="at">colour =</span> <span class="st">&quot;white&quot;</span>, <span class="at">vjust =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb612-7"><a href="grafica.html#cb612-7" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Sex, <span class="at">labeller =</span> i_nomi_dei_sessi) <span class="sc">+</span></span>
<span id="cb612-8"><a href="grafica.html#cb612-8" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Frazione dei pazienti&quot;</span>) <span class="sc">+</span></span>
<span id="cb612-9"><a href="grafica.html#cb612-9" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="st">&quot;Trattamento&quot;</span>, </span>
<span id="cb612-10"><a href="grafica.html#cb612-10" tabindex="-1"></a>                   <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Placebo&quot;</span> <span class="ot">=</span> <span class="st">&quot;Placebo&quot;</span>, <span class="st">&quot;Treated&quot;</span> <span class="ot">=</span> <span class="st">&quot;Farmaco x&quot;</span>)) <span class="sc">+</span></span>
<span id="cb612-11"><a href="grafica.html#cb612-11" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="st">&quot;Miglioramenti&quot;</span>, </span>
<span id="cb612-12"><a href="grafica.html#cb612-12" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;None&quot;</span> <span class="ot">=</span> <span class="st">&quot;0&quot;</span>,<span class="st">&quot;Some&quot;</span><span class="ot">=</span><span class="st">&quot;+&quot;</span>, <span class="st">&quot;Marked&quot;</span> <span class="ot">=</span> <span class="st">&quot;+++&quot;</span>), </span>
<span id="cb612-13"><a href="grafica.html#cb612-13" tabindex="-1"></a>                    <span class="at">type =</span> <span class="st">&quot;qual&quot;</span>, <span class="at">palette =</span> <span class="st">&quot;Paired&quot;</span>) <span class="sc">+</span></span>
<span id="cb612-14"><a href="grafica.html#cb612-14" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>), </span>
<span id="cb612-15"><a href="grafica.html#cb612-15" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">&quot;italic&quot;</span>, <span class="at">size =</span> <span class="dv">12</span>))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:barefacet"></span>
<img src="_main_files/figure-html/barefacet-1.png" alt="Un grafico a barre con facet" width="1050" />
<p class="caption">
Figura 6.13: Un grafico a barre con facet
</p>
</div>
<hr />
<p>La presenza dei numeri indica abbastanza chiaramente che l’esperimento è sbilanciato, con un numero di pazienti di sesso femminile molto più alto. E’ anche abbastanza chiaro perché sia necessario un esperimento con doppio cieco e placebo per testare un farmaco ;-)
Incidentalmente, potrebbe essere interessante l’età dei pazienti come ulteriore variabile. Prova tu stess* a creare un grafico con il dataset <code>Arthritis2</code> usando <code>facet_grid(Sex ~ ageClass)</code>.</p>
<pre><code>Arthritis2 %&gt;% ggplot(mapping = aes(x=Treatment, fill = Improved)) +
  facet_grid(Sex ~ ageClass) +
  geom_bar()</code></pre>
</div>
<div id="fare-di-più-con-i-grafici-per-variabili-qualitative." class="section level3 hasAnchor" number="6.7.2">
<h3><span class="header-section-number">6.7.2</span> <em>Fare di più con i grafici per variabili qualitative.</em><a href="grafica.html#fare-di-più-con-i-grafici-per-variabili-qualitative." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Il grafico a barre è sicuramente il grafico più efficace per rappresentare conte di variabili qualitative. I blocchi di codice successivo, che devi eseguire in uno script o nella console, ti permettono di sperimentare con alcune personalizzazioni utili.<br />
Trasporre gli assi può essere utile quando le etichette dell’asse delle x sono piuttosto lunghe:</p>
<pre><code>artbar1 + geom_bar(aes(fill = Improved)) + coord_flip()</code></pre>
<p>Esplora l’aiuto di <code>theme</code> per vedere come, con <code>axis.text.x</code> (o le funzioni equivalenti con gli altri elementi di testo del grafico) e <code>element_text()</code> è possibile personalizzare posizione, angolo, giustificazione delle etichette. Grafici trasposti possono essere ottenuti con il pacchetto estensione <a href="https://github.com/lionel-/ggstance">ggstance</a>.</p>
<p><code>ggplot2</code> non consente in maniera semplice di creare diagrammi a torta (pie charts), probabilmente perché sono uno dei tipi peggiori di rappresentazione dei dati. E’ possibile creare qualcosa di simile usando le coordinate polari:</p>
<pre><code>artbar1 + geom_bar(aes(fill= Improved), show.legend = F) + coord_polar()</code></pre>
<p>Oppure, se veramente sei testard*, prova i suggerimenti forniti da “R graphical cookbook” (vedi in altre risorse ***) o il pacchetto <a href="https://github.com/showteeth/ggpie">ggpie</a>. O, ancora potresti provare i fan plot (<code>plotrix::fan.plot()</code>) o provare qualche alternativa, come i doughnut plot (grafici a ciambella), per esempio usando i pacchetti <code>ggsector</code> o <code>ggpie.</code></p>
<p>Altri tipi di grafici per variabili qualitative interessanti sono:</p>
<ul>
<li><p>i diagrammi a mosaico (clicca <a href="https://r-graphics.org/recipe-miscgraph-mosaic">qui</a> per qualche esempio o prova con <a href="https://github.com/haleyjeppson/ggmosaic">ggmosaic</a>)</p></li>
<li><p>i treemaps con il pacchetto specializzato <code>treemap</code> o con <a href="https://wilkox.org/treemapify/">treemapify</a></p></li>
</ul>
</div>
</div>
<div id="grafquant" class="section level2 hasAnchor" number="6.8">
<h2><span class="header-section-number">6.8</span> Grafici per variabili quantitative.<a href="grafica.html#grafquant" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Spesso ci interessa rappresentare la distribuzione o le relazioni fra una o più variabili quantitative, magari anche in funzione dei gruppi determinati dai livelli di una o più variabili qualitative.<br />
Le rappresentazioni grafiche per queste situazioni sono varie, e possono essere combinate:</p>
<ul>
<li><p><strong>rappresentazioni della distribuzione o densità</strong></p>
<ul>
<li><p>gli <strong>istogrammi</strong> (histogram) sono una versione continua dei diagrammi a barre: l’intervallo di valori di una singola variabile quantitativa viene diviso in un certo numero di intervalli più piccoli, di solito di uguali dimensioni; l’altezza delle barre per ciascun intervallo mostra la conta dei valori di ciascun gruppo. In questo caso (<code>geom_histogram</code>) è sufficiente una sola variabile x quantitativa (l’asse delle y mostra le conte), mentre altre variabili qualitative possono essere utilizzate per il colore dei bordi o il riempimento delle barre; è anche possibile ottenere equivalenti bi- o tridimensionali per 2 variabili quantitative (<code>geom_bin2d</code> o <code>geom_hex</code>) in cui l’intensità o la gradazione del colore rappresenta il numero di osservazioni per ciascuna combinazione di intervalli x e y;</p></li>
<li><p>i <strong>poligoni di frequenza</strong> (frequency polygon, <code>geom_freqpoly</code>) o i diagrammi ad area (area plot, <code>geom_area</code>) sono due buone alternative agli istogrammi per la stessa tipologia dei dati, e usano rispettivamente una linea spezzata o un’area per rappresentare la distribuzione; analogamente agli istogrammi, colori dei bordi o riempimenti possono essere usati per mostrare l’effetto di variabili qualitative;</p></li>
<li><p>i <strong>grafici a densità</strong> (<code>geom_density</code>) usano qualche sorta di approssimazione continua (smoother) per rappresentare la densità; anche per questi esistono equivalenti a due dimensioni;</p></li>
<li><p>i <strong>box plot</strong>, ottenuti con <code>geom_boxplot</code>, e il loro analogo continuo, i violin plot (<code>geom_violin</code>) sono utili a rappresentare, in modo non parametrico (cioé senza fare ipotesi particolari sui parametri della distribuzione), la distribuzione di una variabile quantitativa (y) in funzione di uno o più valori di una variabile qualitativa (x)</p></li>
<li><p>con qualche accorgimento, alcuni altri geomi (<code>geom_point</code>, <code>geom_jitter</code>, <code>geom_rug</code>) possono essere utilizzati, spesso in combinazione con altri geomi, per rappresentare densità e distribuzione di variabili quantitative</p></li>
</ul></li>
<li><p><strong>rappresentazioni</strong> di indicatori di tendenza centrale e della relativa incertezza o variabilità: in molti casi è interessante riassumere una distribuzione unimodale rappresentandone qualche indicatore di tendenza centrale (media, mediana) con qualche indicatore di variabilià o incertrezza (deviazione standard, range interquartile, intervalli di confidenza). In genere, questi grafici hanno un’asse delle x qualitativo (diverse categorie di una variabile qualitativa) e una y quantitativa. Oltre ai boxplot, già descritti in precedenza, è possibile usare:</p>
<ul>
<li><p><strong>diagrammi a rettangoli con barre di confidenza</strong> (<code>geom_col</code> combinato con <code>geom_errorbar</code> o <code>geom_linerange</code>)</p></li>
<li><p><strong>diagrammi a punti e barre di errore</strong> (<code>geom_pointrange</code>, o una combinazione di <code>geom_point</code> e <code>geom_linerange</code>), eventualmente rappresentati come rettangoli (<code>geom_crossbar</code>)</p></li>
</ul></li>
<li><p><strong>rappresentazione delle relazioni quantitative fra 2 o più variabili quantitative</strong> (correlazione, relazione funzionale) o qualitative (distribuzione in gruppi):</p>
<ul>
<li><p><strong>grafici a dispersione</strong> (<strong>scatterplot</strong>, <code>geom_point</code>), arricchiti con una varietà di altri elementi (colore, dimensione e forma dei punti) sono letteralmente il cavallo da lavoro della grafica scientifica e possono essere combinati con altre rappresentazioni (come le curve di interpolazione, gli smoothers, le curve di regressione)</p></li>
<li><p>annotazioni rappresentanti l’andamento della relazione fra due variabili possono essere ottenute con geom_smooth che permette di usare smoothers parametrici e non parametrici o linee di regressione</p></li>
<li><p>annotazioni rappresentanti la distribuzione bivariata possono essere ottenute con <code>stat_ellipse</code> (che permette di ottenere ellissi di confidenza) e <code>stat_density2d</code></p></li>
</ul></li>
</ul>
<div id="istogrammi-e-altre-rappresentazioni-della-densità." class="section level3 hasAnchor" number="6.8.1">
<h3><span class="header-section-number">6.8.1</span> Istogrammi e altre rappresentazioni della densità.<a href="grafica.html#istogrammi-e-altre-rappresentazioni-della-densità." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In molti casi, quello che ci interessa è mostrare la distribuzione di una singola variabile continua, per mostrarne i valori più frequenti, il range e, in qualche caso, per verificare se, in realtà si tratti di una distribuzione di valori estratti da più di una popolazione. Per costruire un istogramma l’intervallo dei valori viene diviso in tanti piccoli contenitori (<code>bin</code>), delimitanti intervalli più piccoli, di solito di dimensioni uguali, e si contano le osservazioni che ricadono in ogni singolo contenitore. Ovviamente, ha poco senso farlo quando si dispone di poche osservazioni (diciamo &lt;20). D’altra parte, quando si dispone di moltissime osservazioni potrebbe essere opportuno usare approssimazioni a distribuzioni continue, che potrebbero mostrare meglio la forma della distribuzione. Per questa piccola dimostrazione (e per altre relative alle distribuzioni di densità) userò alcuni data set:</p>
<ul>
<li><p><code>ggplot2::mpg</code></p></li>
<li><p><code>ggplot1::diamonds</code></p></li>
<li><p><code>datasets::iris</code></p></li>
<li><p><code>MASS::survey</code></p></li>
</ul>
<p>Puoi usare l’aiuto per saperne di più.<br />
Cominciamo con i diamanti (i migliori amici delle ragazze). Prova, da sol*, a leggere l’aiuto di questo data set. Nel frattempo ecco la distribuzione del peso di circa 50.000 diamanti in carati. Nota come nella Figura <a href="grafica.html#fig:carathisto">6.14</a> ho cambiato il valore di default del numero di <code>bin</code> (da 30 a 1000)</p>
<hr />
<div class="sourceCode" id="cb616"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb616-1"><a href="grafica.html#cb616-1" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;diamonds&quot;</span>)</span>
<span id="cb616-2"><a href="grafica.html#cb616-2" tabindex="-1"></a>dfpoly <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> diamonds, <span class="fu">aes</span>(<span class="at">x=</span>carat))</span>
<span id="cb616-3"><a href="grafica.html#cb616-3" tabindex="-1"></a>dfpoly <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">100</span>) <span class="sc">+</span> </span>
<span id="cb616-4"><a href="grafica.html#cb616-4" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;peso in carati&quot;</span>,</span>
<span id="cb616-5"><a href="grafica.html#cb616-5" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;conta&quot;</span>,</span>
<span id="cb616-6"><a href="grafica.html#cb616-6" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;distribuzione del peso in carati di diamanti&quot;</span>) <span class="sc">+</span></span>
<span id="cb616-7"><a href="grafica.html#cb616-7" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:carathisto"></span>
<img src="_main_files/figure-html/carathisto-1.png" alt="Un istogramma mostrante la distribuzione del peso in carati di oltre 50000 diamanti" width="1050" />
<p class="caption">
Figura 6.14: Un istogramma mostrante la distribuzione del peso in carati di oltre 50000 diamanti
</p>
</div>
<hr />
<p>La figura non è molto informativa: la scala dell’asse delle x è molto lunga ma, dato il numero ridottissimo di diamandi di grandi dimensioni è difficile apprezzare bene la distribuzione, anche se è chiaro che ci sono diverse sottopopolazioni. Una soluzione, in questo caso, potrebbe essere quella di trasformare uno degli assi. Prova questo piccolo trucco, che ti consente di usare una scala logaritmica per l’asse delle y e, contemporaneamente di usare dei tickmark appropriati<a href="#fn144" class="footnote-ref" id="fnref144"><sup>144</sup></a>.</p>
<hr />
<pre><code>dfpoly + geom_histogram(bins = 100) + 
  labs(x = &quot;peso in carati&quot;,
       y = &quot;conta&quot;,
       title = &quot;distribuzione del peso in carati di diamanti&quot;) +
  scale_y_log10() +
  theme(plot.title = element_text(hjust = 0.5, face = &quot;bold&quot;))</code></pre>
<hr />
<p>Noterai come il risultato è po’ meglio e un po’ peggio: trasformare le scale può rendere più difficile l’interpretazione, ma almeno qui si vedono i valori delle conte dei diamanti più grandi (una gran bella soddisfazione). Ovviamente, si può fare di meglio: possiamo annotare meglio le scale, cambiarne lo stile e usare un tema diverso (così iniziamo a fare pratica con le annotazioni).</p>
<hr />
<div class="sourceCode" id="cb618"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb618-1"><a href="grafica.html#cb618-1" tabindex="-1"></a>dfpoly <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">100</span>) <span class="sc">+</span> </span>
<span id="cb618-2"><a href="grafica.html#cb618-2" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;peso in carati&quot;</span>,</span>
<span id="cb618-3"><a href="grafica.html#cb618-3" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;conta&quot;</span>,</span>
<span id="cb618-4"><a href="grafica.html#cb618-4" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;distribuzione del peso in carati di diamanti&quot;</span>) <span class="sc">+</span></span>
<span id="cb618-5"><a href="grafica.html#cb618-5" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">10</span><span class="sc">^</span><span class="dv">4</span>), <span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">trans_breaks</span>(<span class="st">&quot;log10&quot;</span>, <span class="cf">function</span>(x) <span class="dv">10</span><span class="sc">^</span>x),</span>
<span id="cb618-6"><a href="grafica.html#cb618-6" tabindex="-1"></a>   <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">trans_format</span>(<span class="st">&quot;log10&quot;</span>, scales<span class="sc">::</span><span class="fu">math_format</span>(<span class="dv">10</span><span class="sc">^</span>.x))) <span class="sc">+</span></span>
<span id="cb618-7"><a href="grafica.html#cb618-7" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="fl">0.5</span>), <span class="at">minor_breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">5</span>,<span class="fl">0.1</span>)) <span class="sc">+</span></span>
<span id="cb618-8"><a href="grafica.html#cb618-8" tabindex="-1"></a>  <span class="fu">annotation_logticks</span>(<span class="at">sides =</span> <span class="st">&quot;l&quot;</span>) <span class="sc">+</span></span>
<span id="cb618-9"><a href="grafica.html#cb618-9" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb618-10"><a href="grafica.html#cb618-10" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>))</span></code></pre></div>
<div class="figure">
<img src="_main_files/figure-html/log_carat_histo_2-1.png" alt="Uso di scale logaritmiche: un'istogramma della dimensione di diamanti in carati." width="1050" />
<p class="caption">
(#fig:log_carat_histo_2)Uso di scale logaritmiche: un’istogramma della dimensione di diamanti in carati.
</p>
</div>
<hr />
<p>Prova <a href="https://ggplot2.tidyverse.org/reference/annotation_logticks.html">qui</a> per saperne molto di più sulle annotazioni di scale trasformate.<br />
Naturalmente, <code>geom_histogram()</code> <code>capisce</code> molti altri estetici, come <code>fill</code> e <code>alpha</code>. Prova questo codice che vedere anche la distribuzione del taglio (<code>cut</code>):</p>
<pre><code>dfpoly + geom_histogram(aes(fill = cut), bins = 100) + 
  labs(x = &quot;peso in carati&quot;,
       y = &quot;conta&quot;,
       fill = &quot;taglio&quot;,
       title = &quot;distribuzione del peso in carati di diamanti&quot;) +
  scale_y_continuous(limits = c(0,6000), minor_breaks = seq(0,6000,200)) +
  scale_x_continuous(breaks = seq(0,5,0.5), minor_breaks = seq(0,5,0.1)) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5, face = &quot;bold&quot;))</code></pre>
<p>Oppure, prova ad aggiungere delle facet</p>
<pre><code>dfpoly + geom_histogram(bins = 100) + 
  facet_grid(cut ~ clarity) +
  labs(x = &quot;peso in carati&quot;,
       y = &quot;conta&quot;,
       fill = &quot;taglio&quot;,
       title = &quot;distribuzione del peso in carati di diamanti, in funzione di taglio e chiarezza&quot;) +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5, face = &quot;bold&quot;))</code></pre>
<p>Un’applicazione interessante è aggiungere una funzione di densità teorica di probabilità all’istogramma. Proviamo con dei dati biologici, come l’altezza di studenti (che è più probabile siano normalmente distribuita). Qui usiamo <code>MASS::survey</code>. Qui ho anche aggiunto linee che mostrano la media (linea verticale continua) e ±sd (deviazione standard, linee tratteggiate).</p>
<hr />
<div class="sourceCode" id="cb621"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb621-1"><a href="grafica.html#cb621-1" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;survey&quot;</span>)</span>
<span id="cb621-2"><a href="grafica.html#cb621-2" tabindex="-1"></a>male_students <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(survey, Sex <span class="sc">==</span> <span class="st">&quot;Male&quot;</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(Height))</span>
<span id="cb621-3"><a href="grafica.html#cb621-3" tabindex="-1"></a><span class="fu">ggplot</span>(male_students) <span class="sc">+</span></span>
<span id="cb621-4"><a href="grafica.html#cb621-4" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> Height, <span class="at">y =</span> <span class="fu">after_stat</span>(density)), <span class="at">bins =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb621-5"><a href="grafica.html#cb621-5" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> dnorm,</span>
<span id="cb621-6"><a href="grafica.html#cb621-6" tabindex="-1"></a>                <span class="at">args =</span> <span class="fu">list</span>(<span class="at">mean =</span> <span class="fu">mean</span>(male_students<span class="sc">$</span>Height),</span>
<span id="cb621-7"><a href="grafica.html#cb621-7" tabindex="-1"></a>                            <span class="at">sd =</span> <span class="fu">sd</span>(male_students<span class="sc">$</span>Height))) <span class="sc">+</span></span>
<span id="cb621-8"><a href="grafica.html#cb621-8" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">mean</span>(male_students<span class="sc">$</span>Height)) <span class="sc">+</span></span>
<span id="cb621-9"><a href="grafica.html#cb621-9" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="fu">mean</span>(male_students<span class="sc">$</span>Height)<span class="sc">-</span><span class="fu">sd</span>(male_students<span class="sc">$</span>Height),</span>
<span id="cb621-10"><a href="grafica.html#cb621-10" tabindex="-1"></a>                           <span class="fu">mean</span>(male_students<span class="sc">$</span>Height)<span class="sc">+</span><span class="fu">sd</span>(male_students<span class="sc">$</span>Height)), </span>
<span id="cb621-11"><a href="grafica.html#cb621-11" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="fu">I</span>(<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb621-12"><a href="grafica.html#cb621-12" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;altezza, cm&quot;</span>,</span>
<span id="cb621-13"><a href="grafica.html#cb621-13" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;densità&quot;</span>) <span class="sc">+</span></span>
<span id="cb621-14"><a href="grafica.html#cb621-14" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="figure">
<img src="_main_files/figure-html/isto_norm-1.png" alt="Istogramma e funzione di densità di probabilità per l'altezza di studenti universitari di sesso maschile" width="1050" />
<p class="caption">
(#fig:isto_norm)Istogramma e funzione di densità di probabilità per l’altezza di studenti universitari di sesso maschile
</p>
</div>
<hr />
<p>Un’alternativa agli istogrammi sono i poligoni di frequenza. Il principio è lo stesso ma, invece di avere una serie di barre, una linea spezzata collega i punti corrispondenti alla conta delle osservazioni per ogni <code>bin</code>. Un vantaggio rispetto agli istogrammi è che è più facile sovrapporre diversi gruppi, magari usando colori diversi.</p>
<hr />
<div class="sourceCode" id="cb622"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb622-1"><a href="grafica.html#cb622-1" tabindex="-1"></a>dfpoly <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> diamonds, <span class="fu">aes</span>(<span class="at">x=</span>carat))</span>
<span id="cb622-2"><a href="grafica.html#cb622-2" tabindex="-1"></a>dfpoly <span class="sc">+</span> <span class="fu">geom_freqpoly</span>(<span class="fu">aes</span>(<span class="at">colour =</span> cut)) <span class="sc">+</span> </span>
<span id="cb622-3"><a href="grafica.html#cb622-3" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Distribuzione del peso di diamandi, carati, per diamanti con qualità di taglio diverso&quot;</span>) <span class="sc">+</span></span>
<span id="cb622-4"><a href="grafica.html#cb622-4" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;carati&quot;</span>, <span class="at">y =</span> <span class="st">&quot;conta&quot;</span>) <span class="sc">+</span></span>
<span id="cb622-5"><a href="grafica.html#cb622-5" tabindex="-1"></a>  <span class="fu">scale_colour_brewer</span>(<span class="at">type =</span> <span class="st">&quot;qual&quot;</span>, <span class="at">palette =</span> <span class="st">&quot;Dark2&quot;</span>) <span class="sc">+</span></span>
<span id="cb622-6"><a href="grafica.html#cb622-6" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb622-7"><a href="grafica.html#cb622-7" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:poligonidifrequenza"></span>
<img src="_main_files/figure-html/poligonidifrequenza-1.png" alt="Un esempio di poligoni di frequenza (la distribuzione del peso di diamanti di tagli diversi)" width="1050" />
<p class="caption">
Figura 6.15: Un esempio di poligoni di frequenza (la distribuzione del peso di diamanti di tagli diversi)
</p>
</div>
<hr />
<p>Invece dei poligoni di frequenza (che al massimo possono usare linee di diverso colore, spessore o stile) è possibile usare grafici ad area (che possono usare riempimenti diversi). Nota che in questo caso <code>stat = "bin"</code> è usato per ottenere conte corrispondenti ai vari <code>bin</code> e <code>position="stack"</code> è usato per impilare le conte. Prova a chiederti come è stato ottenuto l’ordine dei diversi livelli del taglio (cut). Prova anche, che non guasta mai, ad interpretare il grafico.</p>
<hr />
<div class="sourceCode" id="cb623"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb623-1"><a href="grafica.html#cb623-1" tabindex="-1"></a>dfpoly <span class="sc">+</span> <span class="fu">geom_area</span>(<span class="fu">aes</span>(<span class="at">fill=</span> cut), <span class="at">stat =</span> <span class="st">&quot;bin&quot;</span>, <span class="at">position =</span> <span class="st">&quot;stack&quot;</span>) <span class="sc">+</span></span>
<span id="cb623-2"><a href="grafica.html#cb623-2" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">&quot;Distribuzione del peso di diamandi, carati, in funzione del taglio&quot;</span>) <span class="sc">+</span></span>
<span id="cb623-3"><a href="grafica.html#cb623-3" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;carati&quot;</span>, <span class="at">y =</span> <span class="st">&quot;conta&quot;</span>) <span class="sc">+</span></span>
<span id="cb623-4"><a href="grafica.html#cb623-4" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">type =</span> <span class="st">&quot;qual&quot;</span>, <span class="at">palette =</span> <span class="st">&quot;Dark2&quot;</span>) <span class="sc">+</span></span>
<span id="cb623-5"><a href="grafica.html#cb623-5" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb623-6"><a href="grafica.html#cb623-6" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:diagrammiadarea"></span>
<img src="_main_files/figure-html/diagrammiadarea-1.png" alt="Un diagramma ad area impilata della distribuzione del peso di diamanti di taglio diverso in carati." width="1050" />
<p class="caption">
Figura 6.16: Un diagramma ad area impilata della distribuzione del peso di diamanti di taglio diverso in carati.
</p>
</div>
<hr />
<p>Un equivalente 2D degli istogrammi sono le heatmap, che usano una gradazione di colore per rappresentare conte o densità diverse. Qui approfitto per mostrare come applicare una facet per taglio e usare una scala logaritmica per le conte. Vale appena la pena di ricordare che le gradazioni di colore non sono il modo migliore per fare confronti quantitativi.</p>
<hr />
<div class="sourceCode" id="cb624"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb624-1"><a href="grafica.html#cb624-1" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(<span class="at">x=</span> carat, <span class="at">y =</span> price)) <span class="sc">+</span> </span>
<span id="cb624-2"><a href="grafica.html#cb624-2" tabindex="-1"></a>  <span class="fu">geom_bin2d</span>(<span class="at">bins =</span> <span class="fu">c</span>(<span class="dv">20</span>,<span class="dv">20</span>)) <span class="sc">+</span> </span>
<span id="cb624-3"><a href="grafica.html#cb624-3" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span> cut) <span class="sc">+</span></span>
<span id="cb624-4"><a href="grafica.html#cb624-4" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;distribuzione dei diamanti, per prezzo e peso in carati&quot;</span>) <span class="sc">+</span></span>
<span id="cb624-5"><a href="grafica.html#cb624-5" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">colours =</span> <span class="fu">heat.colors</span>(<span class="dv">10</span>), <span class="at">trans =</span> <span class="st">&quot;log1p&quot;</span>,</span>
<span id="cb624-6"><a href="grafica.html#cb624-6" tabindex="-1"></a>                       <span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">trans_breaks</span>(<span class="st">&quot;log10&quot;</span>, <span class="cf">function</span>(x) <span class="dv">10</span><span class="sc">^</span>x)) <span class="sc">+</span>  </span>
<span id="cb624-7"><a href="grafica.html#cb624-7" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;distribuzione dei diamanti, per prezzo e peso in carati&quot;</span>,</span>
<span id="cb624-8"><a href="grafica.html#cb624-8" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Prezzo, US$&quot;</span>,</span>
<span id="cb624-9"><a href="grafica.html#cb624-9" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Peso, carati&quot;</span>) <span class="sc">+</span></span>
<span id="cb624-10"><a href="grafica.html#cb624-10" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb624-11"><a href="grafica.html#cb624-11" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:binnedheatmap"></span>
<img src="_main_files/figure-html/binnedheatmap-1.png" alt="Un esempio di heatmap (mappa di calore)." width="1050" />
<p class="caption">
Figura 6.17: Un esempio di heatmap (mappa di calore).
</p>
</div>
<hr />
<p>Approssimazioni continue della densità (in una o due dimensioni) possono essere ottenute utilizzando delle stime kernel della densità, con metodi parametrici o non parametrici: si tratta di funzioni che utilizzano la densità locale dei punti per ottenere una linea continua che approssima la densità<a href="#fn145" class="footnote-ref" id="fnref145"><sup>145</sup></a>. <code>ggplot2</code> consente di usare diversi kernel; il kernel di default è “gaussian”, ma altre opzioni sono, per esempio “epanechnikov”, “rectangular”, “triangular”. Confronta la figura successiva con l’istogramma o il poligono di frequenza delle figure <a href="grafica.html#fig:carathisto">6.14</a> e <a href="grafica.html#fig:poligonidifrequenza">6.15</a>.</p>
<hr />
<div class="sourceCode" id="cb625"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb625-1"><a href="grafica.html#cb625-1" tabindex="-1"></a>dfpoly <span class="sc">+</span> </span>
<span id="cb625-2"><a href="grafica.html#cb625-2" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">colour =</span> cut), <span class="at">kernel =</span> <span class="st">&quot;e&quot;</span>) <span class="sc">+</span></span>
<span id="cb625-3"><a href="grafica.html#cb625-3" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;peso in carati&quot;</span>, <span class="at">y =</span> <span class="st">&quot;densità&quot;</span>, <span class="at">colour =</span> <span class="st">&quot;taglio&quot;</span>) <span class="sc">+</span></span>
<span id="cb625-4"><a href="grafica.html#cb625-4" tabindex="-1"></a>  <span class="fu">scale_colour_brewer</span>(<span class="at">type =</span> <span class="st">&quot;qual&quot;</span>, <span class="at">palette =</span> <span class="st">&quot;Dark2&quot;</span>) <span class="sc">+</span></span>
<span id="cb625-5"><a href="grafica.html#cb625-5" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<div class="figure">
<img src="_main_files/figure-html/densita_continua-1.png" alt="Un grafico a desità della dimensione in carati di diamanti, per diamanti di taglio diverso." width="1050" />
<p class="caption">
(#fig:densita_continua)Un grafico a desità della dimensione in carati di diamanti, per diamanti di taglio diverso.
</p>
</div>
<hr />
<p>Prova in uno script o nella console il codice successivo per ottenere delle rappresentazioni in 2D e pensa a come migliorarle (p.es. cambiando le scale come mostrato negli esempi precedenti). Nota anche come qui ho usato un valore di trasparenza molto basso e una dimensione dei simboli molto piccola: questa pratica può essere conveniente quando ci sono moltissimi punti e si vuole mantenere una sensazione della densità senza rendere il grafico troppo “pesante”.</p>
<pre><code># un grafico a dispersione con due rappresentazioni della densità:
# dei rug plot sugli assi e un contour plot
# prova a sperimentare con vari valori di n in geom_density_2d
ggplot(dplyr::filter(diamonds, carat&lt;3), aes(x= carat, y = price)) + 
  geom_point(size = I(0.05), alpha = 0.1) + 
  geom_rug(sides = &quot;bl&quot;, alpha = 0.005) +
  geom_density_2d(n = 100, colour = &quot;red&quot;) +
  labs(x = &quot;peso in carati&quot;, y = &quot;densità&quot;) +
  theme_bw()

# qui escludo i diamanti più grandi che sono pochissimi
ggplot(dplyr::filter(diamonds, carat&lt;1.5, price &lt;5000), aes(x= carat, y = price)) + 
  geom_density_2d_filled(alpha = 0.5, contour_var = &quot;count&quot;) + 
  scale_x_continuous(limits = c(0,1.5), breaks = seq(0,1.5,0.1), 
                     minor_breaks = seq(0,3, 0.1))+
  labs(x = &quot;peso in carati&quot;, y = &quot;prezzo, US$&quot;) +
  theme_bw()
  
# un&#39;altra possibilità è usare una scala continua
ggplot(dplyr::filter(diamonds, carat&lt;1.5, price &lt;5000), aes(x= carat, y = price)) + 
  stat_density_2d_filled(geom = &quot;raster&quot;,
                         aes(fill = after_stat(density)),
                         contour = FALSE,
                         n=200
  ) + 
  scale_fill_viridis_b(direction = -1, option = &quot;C&quot;)+ 
  scale_x_continuous(limits = c(0,1.5), breaks = seq(0,1.5,0.1), 
                     minor_breaks = seq(0,3, 0.1))+
  labs(x = &quot;peso in carati&quot;, y = &quot;prezzo, US$&quot;) +
  theme_bw()</code></pre>
</div>
<div id="boxplot" class="section level3 hasAnchor" number="6.8.2">
<h3><span class="header-section-number">6.8.2</span> Boxplot.<a href="grafica.html#boxplot" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>I boxplot (o più propriamente, box and whiskers plots, che in italiano si traduce grafico a scatole e baffi) e le loro variazioni sono un altro modo per rappresentare la distribuzione delle osservazioni, oltre che per mostrare alcuni utili indicatori non parametrici (la mediana, il range interquartile vedi capitolo <a href="statdesc.html#statdesc">7</a>). Boxplot assolutamente dignitosi possono essere ottenuti usando la funzione <code>boxplot()</code> della grafica di base. La funzione <code>geom_boxplot()</code> fornisce flessibilità addizionale ma ha anche alcune particolarità noiose (richiede sia una variabile x, di solito qualitativa, che una variabile y, quantitativa, quella per la quale interessa analizzare la distribuzione).</p>
<hr />
<div class="sourceCode" id="cb627"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb627-1"><a href="grafica.html#cb627-1" tabindex="-1"></a>survey_dati_completi <span class="ot">&lt;-</span> survey <span class="sc">%&gt;%</span> tidyr<span class="sc">::</span><span class="fu">drop_na</span>()</span>
<span id="cb627-2"><a href="grafica.html#cb627-2" tabindex="-1"></a><span class="fu">ggplot</span>(survey_dati_completi, <span class="fu">aes</span>(<span class="at">x=</span>Sex, <span class="at">y=</span>Height)) <span class="sc">+</span></span>
<span id="cb627-3"><a href="grafica.html#cb627-3" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb627-4"><a href="grafica.html#cb627-4" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb627-5"><a href="grafica.html#cb627-5" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Altezza in cm di studenti della Univ. Adelaide&quot;</span>,</span>
<span id="cb627-6"><a href="grafica.html#cb627-6" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;Venables, W. N. and Ripley, B. D. (2002) Modern Applied Statistics with S-PLUS. Fourth Edition. Springer.&quot;</span>,</span>
<span id="cb627-7"><a href="grafica.html#cb627-7" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Sesso&quot;</span>,</span>
<span id="cb627-8"><a href="grafica.html#cb627-8" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Altezza, cm&quot;</span>) <span class="sc">+</span></span>
<span id="cb627-9"><a href="grafica.html#cb627-9" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="st">&quot;Sesso&quot;</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Female&quot;</span> <span class="ot">=</span> <span class="st">&quot;Femmine&quot;</span>, <span class="st">&quot;Male&quot;</span> <span class="ot">=</span> <span class="st">&quot;Maschi&quot;</span>)) <span class="sc">+</span></span>
<span id="cb627-10"><a href="grafica.html#cb627-10" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:boxplotsurvey"></span>
<img src="_main_files/figure-html/boxplotsurvey-1.png" alt="Distribuzione dell'altezza di studenti di psicologia dell'Università di Adelaide." width="1050" />
<p class="caption">
Figura 6.18: Distribuzione dell’altezza di studenti di psicologia dell’Università di Adelaide.
</p>
</div>
<hr />
<p>La Figura <a href="grafica.html#fig:boxplotsurvey">6.18</a> mostra un piccolo esempio creato usando il dataset <code>MASS::survey</code>.
Sono evidenti gli elementi principali del box plot:</p>
<ul>
<li><p>la linea spessa orizzontale centrale mostra la mediana delle osservazioni (il secondo quartile, <code>Q2</code>)</p></li>
<li><p>il box è delimitato dal 25° e 75° percentile (quantili <code>Q1</code> e <code>Q3</code>); il range interquartile (<code>IQR</code>) si calcola facilmente come <code>Q3-Q1</code> e, ovviamente, contiene il 50% delle osservazioni</p></li>
<li><p>i “baffi” (le due linee che partono dal box) sono lunghi al più 1,5*IQR</p></li>
<li><p>eventuali osservazioni che eccedono l’intervallo delimitato dai baffi sono rappresentate come cerchi neri pieni e, tendenzialmente, indicano dei valori estremi o outlier</p></li>
</ul>
<p>In sostanza, il box plot è ottenuto usando le statistiche che si possono ricavare dalla funzione <code>fivenum()</code>.<br />
Vale appena la pena di aggiungere che non ha molto senso usare un box plot con un numero ridotto di osservazioni (diciamo che già 10 possono essere pochine).<br />
Come esercizio mentale prova a pensare quali informazioni puoi ricavare da un box plot (e da questo in particolare) e in che modo ti possono servire a confrontare distribuzioni di un singolo gruppo di osservazioni o di più gruppi di osservazioni.</p>
<p>Prova ora le seguenti opzioni (copiando il codice usato per generare la figura in uno script e cambiando i comandi):</p>
<ul>
<li><p>trasponi il grafico aggiungendo <code>coord_flip()</code> (può essere utile quando le etichette dell’asse delle x sono lunghe, anche se è possibile lavorare su questo aspetto usanto <code>theme()</code>)<a href="#fn146" class="footnote-ref" id="fnref146"><sup>146</sup></a>;</p></li>
<li><p>prova ad aggiungere l’opzione <code>geom_boxplot(notch = T)</code> per aggiungere un intervallo di confidenza alla mediana (delimitato dalla zona a clessidra o da “spine” triangolari che si estendono oltre il range interquartile</p></li>
<li><p>prova ad aggiungere colori dei bordi e riempimenti (in questo caso sono assolutamente inutili, ma potrebbero essere di qualche utilità se si desidera confrontare gruppi diversi delimitati da una seconda variabile qualitativa all’interno dei gruppi delimitati dalla variabile x)</p></li>
</ul>
<p>Un box plot può essere arricchito di molti altri elementi:</p>
<ul>
<li><p>le singole osservazioni, con una bassa trasparenza, in modo da poter avere una rappresentazione fedele della loro distribuzione</p></li>
<li><p>un violin plot (che, in pratica, usa <code>geom_density</code> per ottenere una rappresentazione non parametrica della densità), in modo da poter evidenziare eventuali distribuzioni multimodali ed esaltare la presenza di asimmetrie nella distribuzione</p></li>
</ul>
<hr />
<div class="sourceCode" id="cb628"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb628-1"><a href="grafica.html#cb628-1" tabindex="-1"></a><span class="fu">ggplot</span>(survey_dati_completi, <span class="fu">aes</span>(<span class="at">x=</span>Sex, <span class="at">y=</span>Height)) <span class="sc">+</span></span>
<span id="cb628-2"><a href="grafica.html#cb628-2" tabindex="-1"></a>  <span class="fu">geom_violin</span>() <span class="sc">+</span></span>
<span id="cb628-3"><a href="grafica.html#cb628-3" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">width =</span> <span class="fl">0.4</span>, <span class="at">colour =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">notch =</span> T) <span class="sc">+</span></span>
<span id="cb628-4"><a href="grafica.html#cb628-4" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">colour =</span> <span class="fu">I</span>(<span class="st">&quot;blue&quot;</span>), <span class="at">alpha =</span> <span class="fu">I</span>(<span class="fl">0.2</span>), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb628-5"><a href="grafica.html#cb628-5" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb628-6"><a href="grafica.html#cb628-6" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Altezza in cm di studenti della Univ. Adelaide&quot;</span>,</span>
<span id="cb628-7"><a href="grafica.html#cb628-7" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;Venables, W. N. and Ripley, B. D. (2002) Modern Applied Statistics with S-PLUS. Fourth Edition. Springer.&quot;</span>,</span>
<span id="cb628-8"><a href="grafica.html#cb628-8" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Sesso&quot;</span>,</span>
<span id="cb628-9"><a href="grafica.html#cb628-9" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;Altezza, cm&quot;</span>) <span class="sc">+</span></span>
<span id="cb628-10"><a href="grafica.html#cb628-10" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="st">&quot;Sesso&quot;</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Female&quot;</span> <span class="ot">=</span> <span class="st">&quot;Femmine&quot;</span>, <span class="st">&quot;Male&quot;</span> <span class="ot">=</span> <span class="st">&quot;Maschi&quot;</span>)) <span class="sc">+</span></span>
<span id="cb628-11"><a href="grafica.html#cb628-11" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:boxplotcombinato"></span>
<img src="_main_files/figure-html/boxplotcombinato-1.png" alt="Combinazione di box plot, violin plot e jitter plot." width="1050" />
<p class="caption">
Figura 6.19: Combinazione di box plot, violin plot e jitter plot.
</p>
</div>
<hr />
<p>Ulteriori effetti “speciali” possono essere ottenuti con diverse estensioni di <code>ggplot2</code>; <a href="https://github.com/IndrajeetPatil/ggstatsplot">ggstatsplot</a>, <a href="https://rpkgs.datanovia.com/ggpubr/">ggpubr</a>, <a href="https://github.com/eclarke/ggbeeswarm">ggbeeswarm</a> sono solo tre esempi.<br />
Per finire, questa cosa di cambiare le etichette per fare tutto in italiano sta diventando noiosa. Da adesso in poi, visto che hai sicuramente capito come si fa, lascerò tutto in inglese.</p>
</div>
<div id="rappresentazioni-di-indicatori-di-tendenza-centrale-e-di-variabilità." class="section level3 hasAnchor" number="6.8.3">
<h3><span class="header-section-number">6.8.3</span> Rappresentazioni di indicatori di tendenza centrale e di variabilità.<a href="grafica.html#rappresentazioni-di-indicatori-di-tendenza-centrale-e-di-variabilità." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In diversi casi lo scopo di chi costruisce la visualizzazione dei dati è mostrare qualche indice di tendenza centrale (tipicamente la media o la mediana) accompagnato da un indice di dispersione, che mostri la variabilità o l’incertezza, spesso per più gruppi di osservazioni. <code>ggplot2</code> offre una varietà di alternative che richiedono in genere una variabile x qualitativa, una variabile y quantitativa e dei valori di ymin e ymax che indicano i limiti inferiore e superiore dell’intervallo che rappresenta incertezza o variabilità. Per questo esempio userò ancora <code>iris</code>, anticipando alcune funzioni per calcolare statistiche riassuntive su gruppi di dati (vedi <a href="statdesc.html#statdesc">7</a>). Approfitto per mostrare l’uso di <code>str_wrap</code>, una funzione del pacchetto <code>stringr</code>, incluso nel <code>tidyverse</code>, utile per mandare a capo del testo molto lungo:</p>
<hr />
<div class="sourceCode" id="cb629"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb629-1"><a href="grafica.html#cb629-1" tabindex="-1"></a><span class="co"># uso funzioni di `dplyr` per calcolare statistiche per gruppi con `summarise`</span></span>
<span id="cb629-2"><a href="grafica.html#cb629-2" tabindex="-1"></a><span class="co"># devst è la deviazione standard, IQR il range interquartile e n_oss il</span></span>
<span id="cb629-3"><a href="grafica.html#cb629-3" tabindex="-1"></a><span class="co"># numero di osservazioni, q25 e q75 il 25° e 75° quantile</span></span>
<span id="cb629-4"><a href="grafica.html#cb629-4" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;iris&quot;</span>)</span>
<span id="cb629-5"><a href="grafica.html#cb629-5" tabindex="-1"></a>iris_stat <span class="ot">&lt;-</span> iris <span class="sc">%&gt;%</span></span>
<span id="cb629-6"><a href="grafica.html#cb629-6" tabindex="-1"></a>  <span class="fu">group_by</span>(Species) <span class="sc">%&gt;%</span></span>
<span id="cb629-7"><a href="grafica.html#cb629-7" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">mediaPW =</span> <span class="fu">mean</span>(Petal.Width),</span>
<span id="cb629-8"><a href="grafica.html#cb629-8" tabindex="-1"></a>            <span class="at">medianaPW =</span> <span class="fu">median</span>(Petal.Width),</span>
<span id="cb629-9"><a href="grafica.html#cb629-9" tabindex="-1"></a>            <span class="at">devstPW =</span> <span class="fu">sd</span>(Petal.Width),</span>
<span id="cb629-10"><a href="grafica.html#cb629-10" tabindex="-1"></a>            <span class="at">q25 =</span> <span class="fu">quantile</span>(Petal.Width, <span class="fl">0.25</span>),</span>
<span id="cb629-11"><a href="grafica.html#cb629-11" tabindex="-1"></a>            <span class="at">q75 =</span> <span class="fu">quantile</span>(Petal.Width, <span class="fl">0.75</span>),</span>
<span id="cb629-12"><a href="grafica.html#cb629-12" tabindex="-1"></a>            <span class="at">n_oss =</span> <span class="fu">n</span>())</span>
<span id="cb629-13"><a href="grafica.html#cb629-13" tabindex="-1"></a><span class="co"># calcolo errore standard e limiti inferiori e superiori dell&#39;intervallo di </span></span>
<span id="cb629-14"><a href="grafica.html#cb629-14" tabindex="-1"></a><span class="co"># confidenza usando alpha = 0.05</span></span>
<span id="cb629-15"><a href="grafica.html#cb629-15" tabindex="-1"></a><span class="co"># con gdl = n_oss-1 gradi di libertà</span></span>
<span id="cb629-16"><a href="grafica.html#cb629-16" tabindex="-1"></a>alpha <span class="ot">=</span> <span class="fl">0.05</span></span>
<span id="cb629-17"><a href="grafica.html#cb629-17" tabindex="-1"></a>iris_stat <span class="ot">&lt;-</span> iris_stat <span class="sc">%&gt;%</span></span>
<span id="cb629-18"><a href="grafica.html#cb629-18" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">errstPW =</span> devstPW<span class="sc">/</span><span class="fu">sqrt</span>(n_oss),</span>
<span id="cb629-19"><a href="grafica.html#cb629-19" tabindex="-1"></a>         <span class="at">gdl =</span> n_oss<span class="dv">-1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb629-20"><a href="grafica.html#cb629-20" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">conf_min =</span> mediaPW<span class="sc">-</span><span class="fu">qt</span>(alpha<span class="sc">/</span><span class="dv">2</span>, <span class="at">df =</span> gdl, <span class="at">lower.tail =</span> F)<span class="sc">*</span>errstPW,</span>
<span id="cb629-21"><a href="grafica.html#cb629-21" tabindex="-1"></a>         <span class="at">conf_max =</span> mediaPW<span class="sc">+</span><span class="fu">qt</span>(alpha<span class="sc">/</span><span class="dv">2</span>, <span class="at">df =</span> gdl, <span class="at">lower.tail =</span> F)<span class="sc">*</span>errstPW</span>
<span id="cb629-22"><a href="grafica.html#cb629-22" tabindex="-1"></a>         )</span>
<span id="cb629-23"><a href="grafica.html#cb629-23" tabindex="-1"></a><span class="co"># nota come è possibile anche ottenere l&#39;intervallo di confidenza della media </span></span>
<span id="cb629-24"><a href="grafica.html#cb629-24" tabindex="-1"></a><span class="co"># con t.test() ma occorre estrarre i risultati dalla lista ottenuta con il test</span></span>
<span id="cb629-25"><a href="grafica.html#cb629-25" tabindex="-1"></a></span>
<span id="cb629-26"><a href="grafica.html#cb629-26" tabindex="-1"></a><span class="co"># uso geom_point range con l&#39;intervallo di confidenza</span></span>
<span id="cb629-27"><a href="grafica.html#cb629-27" tabindex="-1"></a><span class="fu">ggplot</span>(iris_stat, <span class="fu">aes</span>(<span class="at">x =</span> Species)) <span class="sc">+</span></span>
<span id="cb629-28"><a href="grafica.html#cb629-28" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">y =</span> mediaPW, <span class="at">ymin =</span> conf_min, <span class="at">ymax =</span> conf_max), <span class="at">size =</span> <span class="fu">I</span>(<span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb629-29"><a href="grafica.html#cb629-29" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Specie&quot;</span>, </span>
<span id="cb629-30"><a href="grafica.html#cb629-30" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">str_wrap</span>(<span class="st">&quot;Larghezza dei petali, media con intervallo di confidenza, alpha = 0.05&quot;</span>, <span class="dv">50</span>))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:irisrange"></span>
<img src="_main_files/figure-html/irisrange-1.png" alt="Rappresentazioni di indicatori di tendenza centrale e variabilità" width="1050" />
<p class="caption">
Figura 6.20: Rappresentazioni di indicatori di tendenza centrale e variabilità
</p>
</div>
<hr />
<p>Prova ora a sostituire <code>geom_pointrange</code> con <code>geom_crossbar</code>, <code>geom_linerange</code>, <code>geom_errobar</code> (dopo aver dato uno sguardo all’aiuto, naturalmente). Prova anche a sostituire altri valori di y (mediana invece di media, per esempio) o dell’intervallo mostrante la variabilità (media ± deviazione standard, etc.)
Un modo comune per fare la stessa cosa e sprecare molto inchiostro (virtuale) è usare una versione del grafico a barre che non usa conte, ma il valore fornito dalla variabile y, <code>geom_col</code>. Prova questo codice:</p>
<pre><code># qui uso il colore ma sopprimo la legenda, perché inutile
ggplot(iris_stat, aes(x = Species, y = mediaPW)) +
  geom_linerange(aes(ymin = conf_min, ymax = conf_max)) +
  geom_col(aes(fill = Species), alpha = 0.5, show.legend = F) + 
  labs(x = &quot;Specie&quot;, 
       y = str_wrap(&quot;Larghezza dei petali, media con intervallo di confidenza, alpha = 0.05&quot;, 50))</code></pre>
</div>
<div id="scatterplots" class="section level3 hasAnchor" number="6.8.4">
<h3><span class="header-section-number">6.8.4</span> Grafici a dispersione.<a href="grafica.html#scatterplots" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>I grafici a dispersione (<code>scatterplot</code> in inglese) sono il cavallo da tiro della visualizzazione scientifica dei dati. Sono usati principalmente per mostrare le relazioni fra due variabili continue. Variabili qualitative possono essere attribuite a vari elementi del grafico, come forme, colori (di bordo o riempimento), tipi di linea, facets. Altre variabili quantitative possono essere attribuite a colori e dimensioni (inclusi gli spessori delle linee). Linee di tendenza parametriche o non parametriche possono essere aggiunte con <code>geom_smooth()</code>.<br />
Per gli esempi userò alcuni dei data set già utilizzati in questo capitolo, ma potresti provare a usare dati dal pacchetto <code>gapminder</code> o uno dei numerosi data set di R o dei pacchetti.<br />
In <code>ggplot2</code> il geoma che genera grafici a dispersione è <code>geom_point()</code>. Cominciamo con un esempio semplice semplice usando il classico data set <code>Iris</code>. Qui viene mostrata la relazione fra lunghezza e larghezza dei sepali per tre specie di Iris. Nota l’uso della pipe, %&gt;%, un’operatore creato dal pacchetto <code>magrittr</code> che viene caricato con il <code>tidyverse</code>, per passare i dati alla funzione <code>ggplot()</code> .</p>
<hr />
<div class="sourceCode" id="cb631"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb631-1"><a href="grafica.html#cb631-1" tabindex="-1"></a>irisggplot <span class="ot">&lt;-</span> iris <span class="sc">%&gt;%</span> </span>
<span id="cb631-2"><a href="grafica.html#cb631-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>Sepal.Length, <span class="at">y=</span>Sepal.Width, <span class="at">shape =</span> Species, <span class="at">colour =</span> Species)) <span class="sc">+</span></span>
<span id="cb631-3"><a href="grafica.html#cb631-3" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span>
<span id="cb631-4"><a href="grafica.html#cb631-4" tabindex="-1"></a>irisggplot</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:irissplots"></span>
<img src="_main_files/figure-html/irissplots-1.png" alt="Un semplice grafico a dispersione" width="1050" />
<p class="caption">
Figura 6.21: Un semplice grafico a dispersione
</p>
</div>
<hr />
<p>Semplice e senza fronzoli, no? Prova a pensare come potresti abbellire questo grafico usando i comandi presentati nelle sezioni precedenti. Prova anche a pensare come potresti rendere più evidenti (ricordati che una rappresentazione grafica di dati scientifici racconta una storia) alcuni aspetti biologicamente interessanti:</p>
<ul>
<li><p>la divisione in gruppi</p></li>
<li><p>la relazione fra le due variabili</p></li>
</ul>
<p>Cominciamo ad aggiungere cose: prova questo codice (devi aver fatto girare quello di prima, se no non funziona: perché?):</p>
<pre><code># un rugplot
irisggplot + geom_rug(sides = &quot;tr&quot;)
# uno smoother non parametrico diverso per ciascuno dei gruppi
irisggplot + 
  geom_rug(sides = &quot;tr&quot;) +
  geom_smooth()
</code></pre>
<p><code>geom_smooth()</code>è una delle funzioni più utili di ggplot2 quando si voglia evidenziare il trend dei dati. Ti consiglio vivamente di approfondire leggendo l’aiuto e studiando gli esempi.<br />
Qui ripropongo lo più o meno lo stesso codice aggiungendo un ulteriore strato con una regressione lineare e rimuovendo gli intervalli di confidenza e il rug plot:</p>
<pre><code>irisggplot + 
  geom_smooth(se = F, linewidth = I(0.5)) +
  geom_smooth(method = &quot;lm&quot;, formula = y ~ x, se = F, linetype = I(2), linewidth = I(0.5))</code></pre>
<p>Anche qui: prova ad interpretare il grafico: in che cosa questa rappresentazione dei dati migliora la tua comprensione del fenomeno biologico? Per esempio:</p>
<ul>
<li><p>i gruppi corrispondenti alle diverse specie sono ben separati?</p></li>
<li><p>esiste una relazione fra le due variabili? É credibile che si tratti di una relazione lineare (anche se quest’ipotesi potrebbe essere dimostrata in maniera più efficace con un test inferenziale)</p></li>
</ul>
<p>Bene, ora proviamo a fare le cose per bene: aggiungo anche una rappresentazione della densità parametrica, le ellissi di confidenza.</p>
<hr />
<div class="sourceCode" id="cb634"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb634-1"><a href="grafica.html#cb634-1" tabindex="-1"></a>irisggplot  <span class="sc">+</span> </span>
<span id="cb634-2"><a href="grafica.html#cb634-2" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> F, <span class="at">linewidth =</span> <span class="fu">I</span>(<span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb634-3"><a href="grafica.html#cb634-3" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">se =</span> F, <span class="at">linetype =</span> <span class="fu">I</span>(<span class="dv">2</span>), </span>
<span id="cb634-4"><a href="grafica.html#cb634-4" tabindex="-1"></a>              <span class="at">linewidth =</span> <span class="fu">I</span>(<span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb634-5"><a href="grafica.html#cb634-5" tabindex="-1"></a>  <span class="fu">stat_ellipse</span>(</span>
<span id="cb634-6"><a href="grafica.html#cb634-6" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">&quot;t&quot;</span>,</span>
<span id="cb634-7"><a href="grafica.html#cb634-7" tabindex="-1"></a>    <span class="at">level =</span> <span class="fl">0.95</span>,</span>
<span id="cb634-8"><a href="grafica.html#cb634-8" tabindex="-1"></a>    <span class="at">linewidth =</span> <span class="fu">I</span>(<span class="fl">0.5</span>)</span>
<span id="cb634-9"><a href="grafica.html#cb634-9" tabindex="-1"></a>  )</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:irissplots2"></span>
<img src="_main_files/figure-html/irissplots2-1.png" alt="Un grafico a dispersione con smoother nn parametrico (loess) linee di regressione e ellissi di confidenza" width="1050" />
<p class="caption">
Figura 6.22: Un grafico a dispersione con smoother nn parametrico (loess) linee di regressione e ellissi di confidenza
</p>
</div>
<hr />
<p>I parametri di default di <code>stat_ellipse</code> generano l’ellisse usando una distribuzione t di Student bivariata; è possibile usare <code>type = "norm"</code> per ottenere una distribuzione bivariata normale. C’è un po’ di dibattito sul fatto che il metodo scelto da <code>ggplot2</code> generi effettivamente un’ellisse di confidenza. In ogni caso le cose che dovresti guardare sono:</p>
<ul>
<li><p>la dimensione dell’ellisse è in relazione con la variabilità dei dati (varianza della media o del campione); guardando la dimensione relativa ai due assi è possibile vedere quale delle due variabili ha una varianza maggiore</p></li>
<li><p>l’inclinazione dell’ellisse è in relazione con la covarianza o la correlazione fra le variabili (se l’asse maggiore è molto inclinato la correlazione o la covarianza sono maggiori; se l’ellisse si approssima ad un cerchio le due variabili non sono correlate)</p></li>
</ul>
<p>Ora cambiamo data set per dimostrare alcune altri aspetti interessanti dei grafici a dispersione. <code>ggplot2::mpg</code> è un buon punto di partenza per la combinazione di variabili qualitative e quantitative. Userò una versione filtrata del data set perché, come richiamato nella sezione <a href="grafica.html#igraficifattibene">6.2</a> non è opportuno usare troppe combinazioni diverse di colori e simboli. Cominciamo per dimostrare come una terza variabile quantitativa possa essere attribuita al colore (deve essere una variabile continua!) o alla dimensione del simbolo). In questo caso forzeremo un po’ la scelta dei simboli. Ah dimenticavo, R ti permette di usare 25 simboli grafici diversi, oltre alle lettere dell’alfabeto: se vuoi una lista cerca sul web o, meglio ancora, usa questi comandi</p>
<pre><code>install.packages(&quot;ggpubr&quot;) # necessario solo se non è già presente nella libreria
library(ggpubr)
ggpubr::show_point_shapes()</code></pre>
<p>Nota anche qui l’uso della funzione <code>filter</code> del pacchetto <code>dplyr</code> per selezionare in modo facile solo una parte delle osservazioni del data frame (le 6 classi di veicoli più numerose). Ricorda anche come gli estetici possono essere passati nel primo strato (quello con <code>ggplot</code>), e in questo caso sono ereditati dai geomi successivi, oppure direttamente nei geomi. Visto che ci siamo, mostro come si possa cambiare la posizione della legenda e il numero di colonne di alcuni elementi della legenda.
Nel primo grafico in cui la dimensione del simbolo è in funzione della cilindrata e il colore in funzione del tipo di carburante, una variabile qualitativa; cambio i simboli con <code>scale_shape_manual()</code>, creando un vettore con nomi con le forme che voglio usare (cerchi, triangoli, quadrati, rombi).</p>
<hr />
<div class="sourceCode" id="cb636"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb636-1"><a href="grafica.html#cb636-1" tabindex="-1"></a>mpg_ridotto <span class="ot">&lt;-</span> mpg <span class="sc">%&gt;%</span></span>
<span id="cb636-2"><a href="grafica.html#cb636-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(class <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;compact&quot;</span>, <span class="st">&quot;midsize&quot;</span>, <span class="st">&quot;subcompact&quot;</span>, <span class="st">&quot;suv&quot;</span>))</span>
<span id="cb636-3"><a href="grafica.html#cb636-3" tabindex="-1"></a></span>
<span id="cb636-4"><a href="grafica.html#cb636-4" tabindex="-1"></a>mpg_layer_base <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mpg_ridotto, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x=</span>cty, <span class="at">y =</span> hwy))</span>
<span id="cb636-5"><a href="grafica.html#cb636-5" tabindex="-1"></a></span>
<span id="cb636-6"><a href="grafica.html#cb636-6" tabindex="-1"></a></span>
<span id="cb636-7"><a href="grafica.html#cb636-7" tabindex="-1"></a>my_shapes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;compact&quot;</span> <span class="ot">=</span> <span class="dv">16</span>, <span class="st">&quot;midsize&quot;</span> <span class="ot">=</span> <span class="dv">17</span>, <span class="st">&quot;subcompact&quot;</span> <span class="ot">=</span> <span class="dv">15</span>, <span class="st">&quot;suv&quot;</span> <span class="ot">=</span> <span class="dv">18</span>)</span>
<span id="cb636-8"><a href="grafica.html#cb636-8" tabindex="-1"></a></span>
<span id="cb636-9"><a href="grafica.html#cb636-9" tabindex="-1"></a>mpg_cty_hwy_displ <span class="ot">&lt;-</span> mpg_layer_base <span class="sc">+</span></span>
<span id="cb636-10"><a href="grafica.html#cb636-10" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape =</span> class, <span class="at">size =</span> displ, <span class="at">colour =</span> fl)) <span class="sc">+</span></span>
<span id="cb636-11"><a href="grafica.html#cb636-11" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> my_shapes) <span class="sc">+</span></span>
<span id="cb636-12"><a href="grafica.html#cb636-12" tabindex="-1"></a>  <span class="fu">scale_colour_brewer</span>(<span class="at">type =</span> <span class="st">&quot;qual&quot;</span>, <span class="at">palette =</span> <span class="st">&quot;Paired&quot;</span>) <span class="sc">+</span></span>
<span id="cb636-13"><a href="grafica.html#cb636-13" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;geom_point&quot;</span>) <span class="sc">+</span></span>
<span id="cb636-14"><a href="grafica.html#cb636-14" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">size =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">2</span>), </span>
<span id="cb636-15"><a href="grafica.html#cb636-15" tabindex="-1"></a>         <span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb636-16"><a href="grafica.html#cb636-16" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb636-17"><a href="grafica.html#cb636-17" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb636-18"><a href="grafica.html#cb636-18" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;right&quot;</span>)</span>
<span id="cb636-19"><a href="grafica.html#cb636-19" tabindex="-1"></a></span>
<span id="cb636-20"><a href="grafica.html#cb636-20" tabindex="-1"></a>mpg_cty_hwy_displ</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:laterzavariabile"></span>
<img src="_main_files/figure-html/laterzavariabile-1.png" alt="Un bubble plot" width="1050" />
<p class="caption">
Figura 6.23: Un bubble plot
</p>
</div>
<hr />
<p>Semplice, no? Questo grafico si chiama <code>bubble plot</code> ed è molto utilizzato, anche se la nostra capacità di comparare aree non è proprio il massimo. La relazione fra il consumo di carburante in città e in autostrada è praticamente lineare. Sapresti come aggiungere <strong>un’unica</strong> linea di regressione?<br />
Nota anche come ci sia un problema di “overplotting” (molti punti si sovrappongono), per risolvere il quale uso <code>geom_jitter()</code>, che aggiunge un piccolo spostamento casuale sulle x e sulle y (rischiando ovviamente di perdere un po’ di precisione). Infine, uso le scale del pacchetto <code>viridis</code> che forniscono gradienti ottimizzati per il daltonismo.</p>
<hr />
<div class="sourceCode" id="cb637"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb637-1"><a href="grafica.html#cb637-1" tabindex="-1"></a>mpg_cty_hwy_displ_2 <span class="ot">&lt;-</span> mpg_layer_base <span class="sc">+</span></span>
<span id="cb637-2"><a href="grafica.html#cb637-2" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">shape =</span> class, <span class="at">colour =</span> displ)) <span class="sc">+</span></span>
<span id="cb637-3"><a href="grafica.html#cb637-3" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> my_shapes) <span class="sc">+</span></span>
<span id="cb637-4"><a href="grafica.html#cb637-4" tabindex="-1"></a>  <span class="fu">scale_colour_viridis</span>(<span class="at">option =</span> <span class="st">&quot;B&quot;</span>) <span class="sc">+</span></span>
<span id="cb637-5"><a href="grafica.html#cb637-5" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;geom_jitter&quot;</span>) <span class="sc">+</span></span>
<span id="cb637-6"><a href="grafica.html#cb637-6" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb637-7"><a href="grafica.html#cb637-7" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb637-8"><a href="grafica.html#cb637-8" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span>
<span id="cb637-9"><a href="grafica.html#cb637-9" tabindex="-1"></a>mpg_cty_hwy_displ_2</span></code></pre></div>
<p><img src="_main_files/figure-html/jitterplot-1.png" width="1050" />
***</p>
<p>Beh, nel frattempo ti starai chiedendo: e i grafici a dispersione in 3 dimensioni? Dimenticali, per molte ragioni è difficile estrarre informazioni quantitative affidabili da un grafico in 3D, specialmente se aggiungi colori, gradazioni, dimensioni, superfici etc. Ovviamente, se proprio insisti a volerli realizzare puoi cercare in una delle risorse che ti propongo nella sezione <a href="grafica.html#altrerisgraf">6.10</a>.</p>
<p>Proviamo ora a spostare la variabile <code>class</code> sulle facet e usare il numero di cilindri per la forma dei simboli: prova a chiederti perché devo trasformare questa variabile in un fattore.</p>
<hr />
<div class="sourceCode" id="cb638"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb638-1"><a href="grafica.html#cb638-1" tabindex="-1"></a>mpg_cty_hwy_displ_3 <span class="ot">&lt;-</span> mpg_layer_base <span class="sc">+</span></span>
<span id="cb638-2"><a href="grafica.html#cb638-2" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>class) <span class="sc">+</span></span>
<span id="cb638-3"><a href="grafica.html#cb638-3" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">colour =</span> displ, <span class="at">shape =</span> <span class="fu">as.factor</span>(cyl))) <span class="sc">+</span></span>
<span id="cb638-4"><a href="grafica.html#cb638-4" tabindex="-1"></a>  <span class="fu">scale_colour_viridis</span>(<span class="at">option =</span> <span class="st">&quot;B&quot;</span>) <span class="sc">+</span></span>
<span id="cb638-5"><a href="grafica.html#cb638-5" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;geom_jitter e facets&quot;</span>, <span class="at">shape =</span> <span class="st">&quot;cyl&quot;</span>) <span class="sc">+</span></span>
<span id="cb638-6"><a href="grafica.html#cb638-6" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">16</span>,<span class="dv">17</span>,<span class="dv">15</span>,<span class="dv">18</span>)) <span class="sc">+</span></span>
<span id="cb638-7"><a href="grafica.html#cb638-7" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb638-8"><a href="grafica.html#cb638-8" tabindex="-1"></a>mpg_cty_hwy_displ_3</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:facetsplots"></span>
<img src="_main_files/figure-html/facetsplots-1.png" alt="Grafico a dispersione con facets." width="1050" />
<p class="caption">
Figura 6.24: Grafico a dispersione con facets.
</p>
</div>
<hr />
<p>Insomma, ci sarebbe ancora molto da vedere, soprattutto in termini di geomi e annotazioni ma credo sia più semplilce e meno stancante mostrare nuovi esempi man mano che andiamo avanti. Incidentalmente, prova ad esplorare <code>geom_text</code> e <code>geom_label</code>, due interessanti alternative per etichettare i punti in un grafico a dispersione (che purtroppo possono rendere i grafici piuttosto ingarbugliati).<br />
Se hai fretta puoi cercare in una delle molte eccellenti risorse che ti propongo nella sezione <a href="grafica.html#altrerisgraf">6.10</a>.</p>
</div>
<div id="personalizzare-i-grafici-con-ggplot2." class="section level3 hasAnchor" number="6.8.5">
<h3><span class="header-section-number">6.8.5</span> <em>Personalizzare i grafici con ggplot2.</em><a href="grafica.html#personalizzare-i-grafici-con-ggplot2." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>ggplot2</code> e le sue estensioni (vedi dopo) permettono un livello di personalizzazione veramente eccezionale dei grafici. Il modo più semplice per cambiare in gruppo una serie di elementi (assi, sfondo, etc.), è usare i temi. Prova per esempio a personalizzare l’ultimo grafico variando i temi:</p>
<pre><code>mpg_cty_hwy_displ_3 + theme_bw()
mpg_cty_hwy_displ_3 + theme_classic()
mpg_cty_hwy_displ_3 + theme_dark()
mpg_cty_hwy_displ_3 + theme_light()
mpg_cty_hwy_displ_3 + theme_minimal()</code></pre>
<p>Altri temi sono resi disponibili dall’estensione <a href="https://yutannihilation.github.io/allYourFigureAreBelongToUs/ggthemes/">ggthemes</a>. Inoltre, il comando <code>theme()</code> permette, come hai già visto, di cambiare praticamente tutti gli elementi (inclusi, fra le altre cose, orientazione e font delle etichette degli assi).<br />
I pacchetti addizionali come <code>scales</code> (che viene caricato con <code>ggplot2</code>) permettono di personalizzare in molti modi le scale come visto in alcuni esempi, e il comando <code>annotate()</code> permette di aggiungere uno strato con annotazioni (testo, segmenti, persino geomi). Insomma, tanta roba e qui non abbiamo spazio-tempo e, forse, non ne vale la pena: potrai sempre cercare fra le risorse che ti propongo (<a href="grafica.html#altrerisgraf">6.10</a>) o semplicemente sfruttare una delle strategie per cercare aiuto in rete proposte nel <a href="aiuto.html#aiuto">3</a>.</p>
</div>
<div id="estensionigg" class="section level3 hasAnchor" number="6.8.6">
<h3><span class="header-section-number">6.8.6</span> <em>Estensioni per ggplot2.</em><a href="grafica.html#estensionigg" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Molti altri pacchetti forniscono funzionalità aggiuntive a ggplot2 o permettono di usare come input oggetti diversi dai dataframe (come alcune classi di oggetti prodotti da analisi statistiche). Una lista completa delle estenisoni è disponbile <a href="https://www.ggplot2-exts.org">qui</a>. Alcune estensioni sono state citate nei paragrafi precedenti.</p>
</div>
<div id="qplot" class="section level3 hasAnchor" number="6.8.7">
<h3><span class="header-section-number">6.8.7</span> <em>Veloce veloce: qplot()</em><a href="grafica.html#qplot" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Il comando <code>qplot</code> forniva, nelle versioni di <code>ggplot2</code> precedenti alla 3.4, un’interfaccia rapida per la produzione di grafici in un solo comando. Nonostante questo comando sia deprecato (cioé non verrà più sviluppato a partire da questa versione) è ancora attivo, anche se genera degli avvisi (<code>warning</code>). La struttura generica dei comandi qplot è:</p>
<pre><code>qplot(x, y, ..., data, facets,margins, geom, xlim, ylim, log, main, xlab, ylab, asp)</code></pre>
<p>Molti di questi parametri hanno dei default e, tecnicamente, <code>qplot</code> è in grado di proporre il geom più adatto ad una data tipologia di dati, in base alla presenza/assenza delle variabili x e y e alla loro natura (qualitativa o quantitativa).</p>
<p>Prova ad eseguire, nella console o in uno script, questi comandi</p>
<pre><code># uno scatterplot (generato in automatico perché x e y sono quantitative)
data(mpg)
qplot(x = displ, y = hwy, data = mpg)
# con qualche personalizzazione in più
qplot(x = displ, y = hwy, shape = factor(cyl), data = mpg)
# un barplot (il default per una sola variabile x qualitativa)
qplot(x = class, data = mpg)
# un istogramma (il default per una sola variabile x quantitativa)
qplot(x = displ, data = mpg)
# diventa un density plot se si indica il geoma
qplot(x = displ, data = mpg, geom = &quot;density&quot;)
# con facets
qplot(x = displ, data = mpg, geom = &quot;density&quot;, facets = ~factor(cyl))
# altri estetici e etichette e titoli, 
qplot(displ, hwy, data = mpg, colour = factor(cyl),  
      main = &quot;cilindrata e consumo in autostrada&quot;, 
      xlab = &quot;cilindrata&quot;,
      ylab = &quot;miglia per gallone in autostrada&quot;)
# un bubble plot
qplot(displ, hwy, data = mpg, colour = factor(cyl), size = cty)
# una combinazione di grafici
qplot(class, hwy, data = mpg, geom = c(&quot;jitter&quot;, &quot;boxplot&quot;), alpha = I(0.6))
qplot(displ, hwy, data = mpg, geom = c(&quot;point&quot;, &quot;smooth&quot;))
</code></pre>
<p>Prova ad esplorare tu stess* con altre opzioni e combinazioni o a realizzare i grafici ottenuti nei paragrafi precedenti con <code>ggplot.</code> Ti renderai conto che <code>qplot</code> permette di ottenere scrivendo molto meno codice dei grafici accettabili per la fase esplorativa, ma che la flessibilità di <code>ggplot</code> è molto superiore.</p>
</div>
</div>
<div id="graficabase" class="section level2 hasAnchor" number="6.9">
<h2><span class="header-section-number">6.9</span> <em>La grafica di base in R: un salvagente?</em><a href="grafica.html#graficabase" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>La grafica di base di R usa un numero limitato di funzioni per costruire visualizzazioni di dati. Esempi di queste funzioni sono:</p>
<ul>
<li><p><code>barplot()</code>, costruisce barplot</p></li>
<li><p><code>boxplot()</code>, costruisce boxplot</p></li>
<li><p><code>histogram()</code>, costruisce istogrammi</p></li>
<li><p><code>plot()</code>, costruisce grafici a dispersione (e molto altro)</p></li>
<li><p><code>pairs()</code>, costruisce matrici di grafici a dispersione</p></li>
<li><p><code>mosaicplot()</code> grafici a mosaico</p></li>
</ul>
<p>Mentre i nomi delle funzioni possono essere intuitivi, i loro parametri sono molto difficili da memorizzare, anche se, come per <code>ggplot2</code>, consentono una personalizzazione molto fine della visualizzazione. Inoltre, realizzare grafici con diversi gruppi è spesso laborioso, perché occorre sovrapporre grafici diversi che usano ciascuno i punti del gruppo da plottare. Mostro qui solo due esempi. La figura <a href="grafica.html#fig:barplotbase">6.25</a> è un diagramma a barre che mostra i dati del data set <code>Arthritis</code>. E’ l’equivalente della Figura <a href="grafica.html#fig:barchartminimo">6.10</a>:</p>
<hr />
<div class="sourceCode" id="cb642"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb642-1"><a href="grafica.html#cb642-1" tabindex="-1"></a><span class="co"># bisogna prima ricavare la tabella delle conte</span></span>
<span id="cb642-2"><a href="grafica.html#cb642-2" tabindex="-1"></a>Arthritis_tabulazione <span class="ot">&lt;-</span> <span class="fu">xtabs</span>( <span class="sc">~</span> Improved <span class="sc">+</span> Treatment, <span class="at">data =</span> Arthritis)</span>
<span id="cb642-3"><a href="grafica.html#cb642-3" tabindex="-1"></a><span class="co"># poi lo strato ocn il barplot</span></span>
<span id="cb642-4"><a href="grafica.html#cb642-4" tabindex="-1"></a><span class="fu">barplot</span>(Arthritis_tabulazione, <span class="at">col =</span> <span class="fu">rainbow</span>(<span class="dv">3</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">50</span>))</span>
<span id="cb642-5"><a href="grafica.html#cb642-5" tabindex="-1"></a><span class="co"># poi la legenda</span></span>
<span id="cb642-6"><a href="grafica.html#cb642-6" tabindex="-1"></a><span class="fu">legend</span>(<span class="at">x =</span> <span class="st">&quot;top&quot;</span>, <span class="at">legend =</span> <span class="fu">levels</span>(Arthritis<span class="sc">$</span>Improved), <span class="at">pch =</span> <span class="dv">15</span>, <span class="at">col =</span> <span class="fu">rainbow</span>(<span class="dv">3</span>), <span class="at">ncol =</span> <span class="dv">3</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:barplotbase"></span>
<img src="_main_files/figure-html/barplotbase-1.png" alt="Un grafico a barre realizzato con la grafica di base" width="1050" />
<p class="caption">
Figura 6.25: Un grafico a barre realizzato con la grafica di base
</p>
</div>
<hr />
<p>La figura <a href="grafica.html#fig:scatterplotbase">6.26</a> è invece analoga alla figura <a href="grafica.html#fig:irissplots2">6.22</a>. Nota come qui i diversi gruppi sono aggiunti uno dopo l’altro allo strato di base:</p>
<hr />
<div class="sourceCode" id="cb643"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb643-1"><a href="grafica.html#cb643-1" tabindex="-1"></a><span class="co"># puoi farti un&#39;idea del range ideale con</span></span>
<span id="cb643-2"><a href="grafica.html#cb643-2" tabindex="-1"></a><span class="co"># range(iris$Sepal.Length)</span></span>
<span id="cb643-3"><a href="grafica.html#cb643-3" tabindex="-1"></a><span class="co"># range(iris$Sepal.Width)</span></span>
<span id="cb643-4"><a href="grafica.html#cb643-4" tabindex="-1"></a><span class="fu">plot</span>(Sepal.Length <span class="sc">~</span> Sepal.Width, <span class="at">data =</span> <span class="fu">subset</span>(iris, Species <span class="sc">==</span> <span class="st">&quot;setosa&quot;</span>), </span>
<span id="cb643-5"><a href="grafica.html#cb643-5" tabindex="-1"></a>     <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">las =</span> <span class="dv">1</span>,</span>
<span id="cb643-6"><a href="grafica.html#cb643-6" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;larghezza dei sepali&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;lunghezza dei sepali&quot;</span>,  </span>
<span id="cb643-7"><a href="grafica.html#cb643-7" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;relazione fra larghezza e lunghezza dei sepali in tre specie di Iris&quot;</span>,</span>
<span id="cb643-8"><a href="grafica.html#cb643-8" tabindex="-1"></a>     <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">5</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">8</span>))</span>
<span id="cb643-9"><a href="grafica.html#cb643-9" tabindex="-1"></a><span class="fu">abline</span>(<span class="fu">lm</span>(Sepal.Length <span class="sc">~</span> Sepal.Width, <span class="at">data =</span> <span class="fu">subset</span>(iris, Species <span class="sc">==</span> <span class="st">&quot;setosa&quot;</span>)), </span>
<span id="cb643-10"><a href="grafica.html#cb643-10" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lty =</span> <span class="dv">1</span>)</span>
<span id="cb643-11"><a href="grafica.html#cb643-11" tabindex="-1"></a><span class="fu">points</span>(Sepal.Length <span class="sc">~</span> Sepal.Width, <span class="at">data =</span> <span class="fu">subset</span>(iris, Species <span class="sc">==</span> <span class="st">&quot;versicolor&quot;</span>), </span>
<span id="cb643-12"><a href="grafica.html#cb643-12" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">17</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">xlab=</span><span class="st">&quot;&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;&quot;</span>, <span class="at">las =</span> <span class="dv">1</span>)</span>
<span id="cb643-13"><a href="grafica.html#cb643-13" tabindex="-1"></a><span class="fu">abline</span>(<span class="fu">lm</span>(Sepal.Length <span class="sc">~</span> Sepal.Width, <span class="at">data =</span> <span class="fu">subset</span>(iris, Species <span class="sc">==</span> <span class="st">&quot;versicolor&quot;</span>)), </span>
<span id="cb643-14"><a href="grafica.html#cb643-14" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb643-15"><a href="grafica.html#cb643-15" tabindex="-1"></a><span class="fu">points</span>(Sepal.Length <span class="sc">~</span> Sepal.Width, <span class="at">data =</span> <span class="fu">subset</span>(iris, Species <span class="sc">==</span> <span class="st">&quot;virginica&quot;</span>), </span>
<span id="cb643-16"><a href="grafica.html#cb643-16" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">15</span>, <span class="at">col =</span> <span class="st">&quot;cyan&quot;</span>, <span class="at">xlab=</span><span class="st">&quot;&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;&quot;</span>, <span class="at">las =</span> <span class="dv">1</span>)</span>
<span id="cb643-17"><a href="grafica.html#cb643-17" tabindex="-1"></a><span class="fu">abline</span>(<span class="fu">lm</span>(Sepal.Length <span class="sc">~</span> Sepal.Width, <span class="at">data =</span> <span class="fu">subset</span>(iris, Species <span class="sc">==</span> <span class="st">&quot;virginica&quot;</span>)), </span>
<span id="cb643-18"><a href="grafica.html#cb643-18" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">&quot;cyan&quot;</span>, <span class="at">lty =</span> <span class="dv">3</span>)</span>
<span id="cb643-19"><a href="grafica.html#cb643-19" tabindex="-1"></a><span class="fu">legend</span>(<span class="at">x =</span> <span class="st">&quot;bottomright&quot;</span>, </span>
<span id="cb643-20"><a href="grafica.html#cb643-20" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">levels</span>(iris<span class="sc">$</span>Species), <span class="at">pch =</span> <span class="fu">c</span>(<span class="dv">16</span>,<span class="dv">17</span>,<span class="dv">15</span>), <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;cyan&quot;</span>))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:scatterplotbase"></span>
<img src="_main_files/figure-html/scatterplotbase-1.png" alt="Un grafico a dispersione realizzato con la grafica di base" width="1050" />
<p class="caption">
Figura 6.26: Un grafico a dispersione realizzato con la grafica di base
</p>
</div>
<hr />
<p>Perché fare tutta questa fatica per un risultato francamente bruttino? Beh, in molti casi i comandi della grafica di base di R consentono di ottenere delle visualizzazioni decenti con poco codice. Poi, e soprattutto, <code>plot()</code> è una funzione generica e serve a ottenere grafici specializzati da molti oggetti ottenuti da analisi statistiche. Prova il codice successivo, che permette di ottenere una in automatico i grafici che rappresentano i diagnostici dell’analisi della varianza per la lunghezza dei petali in <code>iris</code>:</p>
<pre><code>par(mfrow=c(2,2))
plot(aov(Petal.Length ~ Species, data = iris))
par(opar)</code></pre>
<p>Inoltre, molti pacchetti hanno funzioni che restituiscono grafici costruiti con la grafica di base (o, se è per questo, con <code>lattice</code>) e può tornare utile saperne qualcosina per poterli personalizzare al meglio (anche se, pian pianino, le estensioni di <code>ggplot2</code> stanno rendendo più semplice il lavoro di rappresentare graficamente oggetti anche complessi derivanti da analisi statistiche). Comunque, vedremo diversi esempi più avanti.</p>
</div>
<div id="altrerisgraf" class="section level2 hasAnchor" number="6.10">
<h2><span class="header-section-number">6.10</span> Altre risorse.<a href="grafica.html#altrerisgraf" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Il materiale in questo capitolo è presentato in molte delle risorse citate nel capitolo <a href="datioggetti.html#datioggetti">4</a>. In Italiano non c’è granché, se non la wiki <a href="https://www.agnesevardanega.eu/wiki/r/start">Ricerca sociale con R</a>.</p>
<div id="risorse-in-inglese.-4" class="section level3 hasAnchor" number="6.10.1">
<h3><span class="header-section-number">6.10.1</span> Risorse in inglese.<a href="grafica.html#risorse-in-inglese.-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Di risorse sulla grafica (scientifica e per la data science) con R è pieno il mondo. In effetti, c’è solo da scegliere, e non è per niente facile. Riporto qui una selezione delle risorse che io ho trovato più utili. Un post interessante e visualmente molto ben organizzato sulla grammatica della grafica è <a href="https://towardsdatascience.com/a-comprehensive-guide-to-the-grammar-of-graphics-for-effective-visualization-of-multi-dimensional-1f92b4ed4149">qui</a>.</p>
<p><strong>Documenti e pagine web.</strong></p>
<ul>
<li><p>Libri: provate questi</p>
<ul>
<li><p>come sempre <a href="https://r4ds.had.co.nz/data-import.html">R for data science</a> fornisce esempi ed esercizi interessanti</p></li>
<li><p>i soliti libri introduttivi alla statistica e grafica con R (<a href="https://bookdown.org/ndphillips/YaRrr/">YaRrr!</a>, <a href="https://benwhalley.github.io/just-enough-r/">Just enough R</a>, etc.)</p></li>
<li><p>un bel manuale dedicato a <a href="https://ggplot2-book.org">ggplot2</a></p></li>
<li><p>un libro molto completo sulla <a href="https://clauswilke.com/dataviz/">visualizzazione dei dati</a></p></li>
<li><p>un libro di <a href="https://r-graphics.org">ricette per la grafica con R</a> di R. Kabacoff: può essere un po’ noioso ma è ricchissmo di esempi e la sua organizzazione per tipologie di dati e grafici è utile per trovare rapidamente il tipo di grafico che fa per te;</p></li>
<li><p>se te la senti, i molti libri di <a href="https://www.edwardtufte.com/">Edward Tufte</a>, che spesso sono delle vere e proprie opere d’arte, o di <a href="https://albertocairo.com">Alberto Cairo</a>.</p></li>
</ul></li>
<li><p>documenti e siti web:</p>
<ul>
<li><p>ovviamente, il sito di <a href="https://ggplot2.tidyverse.org">ggplot2</a> con link a tutto quello che vi può servire</p></li>
<li><p>un <a href="https://flowingdata.com">interessante blog</a> sulla grafica scientifica e non</p></li>
<li><p>una bella <a href="https://www.r-graph-gallery.com">gallery</a> di grafici con R, forse con un po’ troppa pubblicità (ma è una buona fonte di ispirazione). Non dimenticate di dare uno sguardo alla pagina sui <a href="https://www.r-graph-gallery.com/interactive-charts.html">grafici interattivi</a></p></li>
<li><p>la <a href="https://plotly.com/r/">pagina di plotly</a>, una library per grafici interattivi molto potente</p></li>
<li><p>una <a href="https://www.nceas.ucsb.edu/sites/default/files/2020-04/colorPaletteCheatsheet.pdf">cheatsheet interessante</a> sull’uso dei colori in R <a href="http://www.stat.columbia.edu/~tzheng/files/Rcolor.pdf" class="uri">http://www.stat.columbia.edu/~tzheng/files/Rcolor.pdf</a></p></li>
</ul></li>
<li><p>Video:</p>
<ul>
<li><p>un video grazioso sull’<a href="https://www.youtube.com/watch?v=2RCy5hTxuYA">uso di grafici nella ricerca biologica</a></p></li>
<li><p>un tutorial su ggplot2, <a href="https://www.youtube.com/watch?v=HeqHMM4ziXA">parte 1</a> e <a href="https://www.youtube.com/watch?v=n8kYa9vu1l8">parte 2</a></p></li>
</ul></li>
</ul>

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="124">
<li id="fn124"><p>e d’altra parte, se sei un* student* di dottorato avrai sicuramente già letto qualche buon manuale di stile per la scrittura di articoli scientifici<a href="grafica.html#fnref124" class="footnote-back">↩︎</a></p></li>
<li id="fn125"><p>in Italiano, al solito c’è poco, ma io trovo belli i libri di Emilio Matricciani, cercatelo in libreria o sulle principali piattaforme di vendita online.<a href="grafica.html#fnref125" class="footnote-back">↩︎</a></p></li>
<li id="fn126"><p>in qualche modo, quando scriviamo o facciamo una presentazione vogliamo “intrattenere” il nostro pubblico e mantenerlo interessato, piuttosto che annoiarlo a morte<a href="grafica.html#fnref126" class="footnote-back">↩︎</a></p></li>
<li id="fn127"><p>si veda Alberto Cairo, L’arte funzionale, Pearson<a href="grafica.html#fnref127" class="footnote-back">↩︎</a></p></li>
<li id="fn128"><p>questa è una delle ragioni per cui usare troppi simboli diversi o troppi colori in un grafico scientifico, specialmente se deve essere mostrato per un tempo breve, non ha senso<a href="grafica.html#fnref128" class="footnote-back">↩︎</a></p></li>
<li id="fn129"><p>Cleveland, W.S., McGill, R., 2012. Graphical Perception: Theory, Experimentation, and Application to the Development of Graphical Methods. J Am Stat Assoc 79, 531–554. <a href="https://doi.org/10.1080/01621459.1984.10478080" class="uri">https://doi.org/10.1080/01621459.1984.10478080</a><a href="grafica.html#fnref129" class="footnote-back">↩︎</a></p></li>
<li id="fn130"><p>in RStudio i grafici compariranno nel riquadro Plots<a href="grafica.html#fnref130" class="footnote-back">↩︎</a></p></li>
<li id="fn131"><p>viene installato come dependency da molti altri pacchetti importanti<a href="grafica.html#fnref131" class="footnote-back">↩︎</a></p></li>
<li id="fn132"><p>oppure ad un file, vedi dopo<a href="grafica.html#fnref132" class="footnote-back">↩︎</a></p></li>
<li id="fn133"><p>vedremo dopo che puoi agire con una certa precisione sulle dimensioni del device e, se lo desideri, dividerlo<a href="grafica.html#fnref133" class="footnote-back">↩︎</a></p></li>
<li id="fn134"><p>una discussione molto chiara ed estensiva dei diversi formati è <a href="https://clauswilke.com/dataviz/image-file-formats.html">qui</a><a href="grafica.html#fnref134" class="footnote-back">↩︎</a></p></li>
<li id="fn135"><p>però una descrizione dettagliata delle aree del device grafico è <a href="https://www.rstudio.com/wp-content/uploads/2016/10/how-big-is-your-graph.pdf">qui</a><a href="grafica.html#fnref135" class="footnote-back">↩︎</a></p></li>
<li id="fn136"><p>prova a eseguire <code>dev.size()</code> e poi ridimensionare il <code>plot pane</code> ed eseguire di nuovo il comando<a href="grafica.html#fnref136" class="footnote-back">↩︎</a></p></li>
<li id="fn137"><p>il segno + deve essere alla fine di ogni comando e non all’inizio della riga del comando successivo! Provare per credere!<a href="grafica.html#fnref137" class="footnote-back">↩︎</a></p></li>
<li id="fn138"><p>deprecato significa che la funzione non viene più sviluppata negli aggiornamenti del pacchetto; tuttavia, le funzioni deprecate restano spesso disponibili, anche se possono generare dei messaggi di avviso (warning).<a href="grafica.html#fnref138" class="footnote-back">↩︎</a></p></li>
<li id="fn139"><p>nota come i dati possono essere generati al volo, usando filtri, selezioni o applicando funzioni<a href="grafica.html#fnref139" class="footnote-back">↩︎</a></p></li>
<li id="fn140"><p>altre possibilità, presenti nella grafica di base ma non in <code>ggplot2</code>, sono i diagrammi a torta e quelli a mosaico, vedi paragrafo <a href="statdesc.html#gmosaico">7.7.2</a><a href="grafica.html#fnref140" class="footnote-back">↩︎</a></p></li>
<li id="fn141"><p>se proprio sei pigr*, alcune domande interessanti potrebbero essere: che tipo di miglioramento (variabile <code>Improved</code>) mostrano i due gruppi definiti dalla variabile <code>Treatment</code>? Il sesso e l’età dei pazienti hanno un effetto?<a href="grafica.html#fnref141" class="footnote-back">↩︎</a></p></li>
<li id="fn142"><p>nota come in altri casi quando viene usato <code>color</code>, o <code>colour</code>, o <code>fill</code> da soli il colore viene attribuito al riempimento dell’elemento, p.es. il colore di un simbolo in un grafico a dispersione; se però si usano entrambi gli estetici, <code>colour</code> definisce il colore del bordo e <code>fill</code> il riempimento; nei diagrammi a barre bisogna esplicitamente indicare <code>fill</code> per il riempimento<a href="grafica.html#fnref142" class="footnote-back">↩︎</a></p></li>
<li id="fn143"><p>per maggiori dettagli su cowplot <a href="https://wilkelab.org/cowplot/articles/plot_grid.html">clicca qui</a><a href="grafica.html#fnref143" class="footnote-back">↩︎</a></p></li>
<li id="fn144"><p>potresti anche trasformare una delle variabili, come i carati, in log(carat), ma è sconsigliabile<a href="grafica.html#fnref144" class="footnote-back">↩︎</a></p></li>
<li id="fn145"><p>se vuoi saperne di più leggi la relativa <a href="https://en.wikipedia.org/wiki/Kernel_density_estimation">voce di Wikipedia</a> in inglese<a href="grafica.html#fnref145" class="footnote-back">↩︎</a></p></li>
<li id="fn146"><p>inoltre, è possibile ottenere versioni orizzontali di molti grafici generati con <code>ggplot2</code> usando <a href="https://github.com/lionel-/ggstance">ggstance</a><a href="grafica.html#fnref146" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="dentroefuoriR.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="statdesc.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
